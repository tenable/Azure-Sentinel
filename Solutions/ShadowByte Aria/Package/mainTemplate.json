{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Shadowbyte",
    "comments": "Solution template for ShadowByte Aria"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "solutionId": "shadowbyte1641237427416.ariasent1",
    "_solutionId": "[variables('solutionId')]",
	"location": "eastus",
	"_location": "[variables('location')]",
    "ShadowByte_Aria_Custom_Connector": "ShadowByte_Aria_Custom_Connector",
    "_ShadowByte_Aria_Custom_Connector": "[variables('ShadowByte_Aria_Custom_Connector')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "ShadowByte_Aria_Custom_Connector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "ShadowByte_Aria_Enrich_Incidents": "ShadowByte_Aria_Enrich_Incidents",
    "_ShadowByte_Aria_Enrich_Incidents": "[variables('ShadowByte_Aria_Enrich_Incidents')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "ShadowByte_Aria_Enrich_Incidents",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "ShadowByte_Aria_Search_for_Breaches": "ShadowByte_Aria_Search_for_Breaches",
    "_ShadowByte_Aria_Search_for_Breaches": "[variables('ShadowByte_Aria_Search_for_Breaches')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "ShadowByte_Aria_Search_for_Breaches",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "properties": {
        "description": "ShadowByte_Aria_Custom_Connector",
        "displayName": "ShadowByte_Aria_Custom_Connector"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "ShadowByte_Aria_Custom_Connector Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "ConnectorName": {
              "defaultValue": "ShadowByteAriaConnector",
              "type": "String"
            }
          },
          "variables": {
            "Api Endpoint": "https://api.ariaintel.io",
            "operationId-getBreachSearch": "getBreachSearch",
            "_operationId-getBreachSearch": "[[variables('operationId-getBreachSearch')]",
            "operationId-getForumSearch": "getForumSearch",
            "_operationId-getForumSearch": "[[variables('operationId-getForumSearch')]",
            "operationId-getNosqlSearch": "getNosqlSearch",
            "_operationId-getNosqlSearch": "[[variables('operationId-getNosqlSearch')]",
            "operationId-getPasteSearch": "getPasteSearch",
            "_operationId-getPasteSearch": "[[variables('operationId-getPasteSearch')]",
            "operationId-getReleaseSearch": "getReleaseSearch",
            "_operationId-getReleaseSearch": "[[variables('operationId-getReleaseSearch')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId": "ShadowByte_Aria_Custom_Connector",
            "playbookId": "[[resourceId('Microsoft.Web/customApis', parameters('ConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('ConnectorName')]",
              "location": "[variables('_location')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring"
                  }
                },
                "backendService": {
                  "serviceUrl": "[[variables('Api Endpoint')]"
                },
                "brandColor": "#ffffff",
                "description": "Shadow Byte's Aria Custom Connector",
                "displayName": "[[parameters('ConnectorName')]",
                "iconUri": "data:image/png;base64,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ZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICB4bXBNTTpEb2N1bWVudElEPSJnaW1wOmRvY2lkOmdpbXA6NmRiZDdhZmMtZDk0MS00NjhhLWJlMDMtM2I5MjQ1MmFhNTVhIgogICB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjdkMzM2NjBmLWY2ODYtNDhiMS04ZDdmLTRhOTJhOGUyNjkwOCIKICAgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjFjZTE3YzFhLWFhYmEtNDJhNC04OTFkLTkzNDJkNmQ1NGFmNiIKICAgR0lNUDpBUEk9IjIuMCIKICAgR0lNUDpQbGF0Zm9ybT0iTGludXgiCiAgIEdJTVA6VGltZVN0YW1wPSIxNjMzOTQ0ODI2NTExOTkxIgogICBHSU1QOlZlcnNpb249IjIuMTAuMjIiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICB0aWZmOk9yaWVudGF0aW9uPSIxIgogICB4bXA6Q3JlYXRvclRvb2w9IkdJTVAgMi4xMCI+CiAgIDxpcHRjRXh0OkxvY2F0aW9uQ3JlYXRlZD4KICAgIDxyZGY6QmFnLz4KICAgPC9pcHRjRXh0OkxvY2F0aW9uQ3JlYXRlZD4KICAgPGlwdGNFeHQ6TG9jYXRpb25TaG93bj4KICAgIDxyZGY6QmFnLz4KICAgPC9pcHRjRXh0OkxvY2F0aW9uU2hvd24+CiAgIDxpcHRjRXh0OkFydHdvcmtPck9iamVjdD4KICAgIDxyZGY6QmFnLz4KICAgPC9pcHRjRXh0OkFydHdvcmtPck9iamVjdD4KICAgPGlwdGNFeHQ6UmVnaXN0cnlJZD4KICAgIDxyZGY6QmFnLz4KICAgPC9pcHRjRXh0OlJlZ2lzdHJ5SWQ+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmI0YWVlMjMyLWNjODktNDYxZi04MGEzLTVmN2YyMWQ2OGI1MyIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChMaW51eCkiCiAgICAgIHN0RXZ0OndoZW49IiswMjowMCIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgIDxwbHVzOkltYWdlU3VwcGxpZXI+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpJbWFnZVN1cHBsaWVyPgogICA8cGx1czpJbWFnZUNyZWF0b3I+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpJbWFnZUNyZWF0b3I+CiAgIDxwbHVzOkNvcHlyaWdodE93bmVyPgogICAgPHJkZjpTZXEvPgogICA8L3BsdXM6Q29weXJpZ2h0T3duZXI+CiAgIDxwbHVzOkxpY2Vuc29yPgogICAgPHJkZjpTZXEvPgogICA8L3BsdXM6TGljZW5zb3I+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz75myotAAAC8VBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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",
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "description": "Shadow Byte's Aria",
                    "title": "ARIA API",
                    "version": "2.0.14"
                  },
                  "host": "[[substring(variables('Api Endpoint'),8)]",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "paths": {
                    "/v2/breach/search": {
                      "get": {
                        "produces": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "description": "Search criteria",
                            "enum": [
                              "username",
                              "password",
                              "email",
                              "name",
                              "phone",
                              "hash",
                              "domain",
                              "ipaddress",
                              "netblock",
                              "address",
                              "crypto",
                              "social",
                              "all"
                            ],
                            "in": "query",
                            "name": "searchType",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Search term for querying the database",
                            "in": "query",
                            "name": "search",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "collectionFormat": "multi",
                            "description": "Breaches not to include in the search results",
                            "in": "query",
                            "items": {
                              "type": "string"
                            },
                            "name": "excludedBreaches",
                            "required": false,
                            "type": "array"
                          },
                          {
                            "default": false,
                            "description": "Include marketing data",
                            "in": "query",
                            "name": "marketingData",
                            "required": false,
                            "type": "boolean"
                          },
                          {
                            "default": false,
                            "description": "Perform a fuzzy search",
                            "in": "query",
                            "name": "fuzzySearch",
                            "required": false,
                            "type": "boolean"
                          },
                          {
                            "description": "Return results created after a given date in YYYY:MM:DD HH:MM:SS format",
                            "format": "date",
                            "in": "query",
                            "name": "dateFrom",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "description": "Return results created before a given date in YYYY:MM:DD HH:MM:SS format",
                            "format": "date",
                            "in": "query",
                            "name": "dateTo",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": 0,
                            "description": "Search results offset. Only the results after the given number (position) will be returned.",
                            "in": "query",
                            "name": "start",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": 100,
                            "description": "Search results length. How many results to return.",
                            "in": "query",
                            "name": "length",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": "breach",
                            "description": "Sort criteria",
                            "enum": [
                              "amazon",
                              "breach",
                              "btc",
                              "company",
                              "device",
                              "deviceid",
                              "dob",
                              "domain",
                              "email",
                              "hash",
                              "importdate",
                              "ip",
                              "phone",
                              "mobile",
                              "name",
                              "other",
                              "password",
                              "salt",
                              "url",
                              "userid",
                              "username",
                              "wallet",
                              "fbid",
                              "fb_user",
                              "tdid",
                              "twitter",
                              "liid",
                              "linkedin",
                              "instaid",
                              "insta"
                            ],
                            "in": "query",
                            "name": "sortBy",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": "asc",
                            "description": "Sort direction",
                            "enum": [
                              "asc",
                              "desc"
                            ],
                            "in": "query",
                            "name": "sortType",
                            "required": false,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "A list of search results",
                            "schema": {
                              "$ref": "#/definitions/breach_success_response"
                            }
                          },
                          "422": {
                            "description": "Validation failure",
                            "schema": {
                              "$ref": "#/definitions/validation_response"
                            }
                          }
                        },
                        "tags": [
                          "Breach"
                        ],
                        "description": "Search for credentials.",
                        "operationId": "[[variables('_operationId-getBreachSearch')]",
                        "summary": "Breach Search"
                      }
                    },
                    "/v2/forums/search": {
                      "get": {
                        "produces": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "description": "Search criteria",
                            "enum": [
                              "all",
                              "content",
                              "author"
                            ],
                            "in": "query",
                            "name": "searchType",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Search term. Searches author name to get forum list for that author. You can also search like `data AND aria` to search 2 words.",
                            "in": "query",
                            "name": "search",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": false,
                            "description": "Search provided author forum list with fuzzy data",
                            "in": "query",
                            "name": "fuzzySearch",
                            "required": false,
                            "type": "boolean"
                          },
                          {
                            "description": "Return results created after a given date in YYYY:MM:DD HH:MM:SS format",
                            "format": "date",
                            "in": "query",
                            "name": "dateFrom",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "description": "Return results created before a given date in YYYY:MM:DD HH:MM:SS format",
                            "format": "date",
                            "in": "query",
                            "name": "dateTo",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": 0,
                            "description": "It will start the result after provided counts",
                            "format": "int32",
                            "in": "query",
                            "name": "start",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": 100,
                            "description": "Returns given number of results",
                            "format": "int32",
                            "in": "query",
                            "name": "length",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "description": "Sort criteria",
                            "enum": [
                              "pid",
                              "author",
                              "date"
                            ],
                            "in": "query",
                            "name": "sortBy",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": "asc",
                            "description": "Sort direction",
                            "enum": [
                              "asc",
                              "desc"
                            ],
                            "in": "query",
                            "name": "sortType",
                            "required": false,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "A list of search results",
                            "schema": {
                              "$ref": "#/definitions/forums_search_success_response"
                            }
                          },
                          "422": {
                            "description": "Validation failure",
                            "schema": {
                              "$ref": "#/definitions/validation_response"
                            }
                          }
                        },
                        "tags": [
                          "Forum Search"
                        ],
                        "description": "Search for forum messages.",
                        "operationId": "[[variables('_operationId-getForumSearch')]",
                        "summary": "Forums Search"
                      }
                    },
                    "/v2/nosql/search": {
                      "get": {
                        "produces": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "description": "Search term",
                            "in": "query",
                            "name": "search",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": false,
                            "description": "Search provided NoSQL list with fuzzy data",
                            "in": "query",
                            "name": "fuzzySearch",
                            "required": false,
                            "type": "boolean"
                          },
                          {
                            "description": "Database type",
                            "enum": [
                              "elastic",
                              "mongodb",
                              "cassandra"
                            ],
                            "in": "query",
                            "name": "databaseType",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "description": "Return results created after a given date in YYYY:MM:DD HH:MM:SS format",
                            "format": "date",
                            "in": "query",
                            "name": "dateFrom",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "description": "Return results created before a given date in YYYY:MM:DD HH:MM:SS format",
                            "format": "date",
                            "in": "query",
                            "name": "dateTo",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": 0,
                            "description": "It will start the result after provided counts",
                            "format": "int32",
                            "in": "query",
                            "name": "start",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": 100,
                            "description": "Returns given number of results",
                            "format": "int32",
                            "in": "query",
                            "name": "length",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": "ip",
                            "description": "Sort criteria",
                            "enum": [
                              "date",
                              "ip",
                              "type",
                              "totalSize",
                              "recordsCount",
                              "indexesCount"
                            ],
                            "in": "query",
                            "name": "sortBy",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": "asc",
                            "description": "Sort direction",
                            "enum": [
                              "asc",
                              "desc"
                            ],
                            "in": "query",
                            "name": "sortType",
                            "required": false,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "A list of search results",
                            "schema": {
                              "$ref": "#/definitions/nosql_success_response"
                            }
                          },
                          "422": {
                            "description": "Validation failure",
                            "schema": {
                              "$ref": "#/definitions/validation_response"
                            }
                          }
                        },
                        "tags": [
                          "NoSQL"
                        ],
                        "description": "Search through NoSQL metadata.",
                        "operationId": "[[variables('_operationId-getNosqlSearch')]",
                        "summary": "NoSQL Search"
                      }
                    },
                    "/v2/pastes/search": {
                      "get": {
                        "produces": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "description": "Search criteria",
                            "enum": [
                              "content",
                              "pid"
                            ],
                            "in": "query",
                            "name": "searchType",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Search provided keyword in the whole paste database",
                            "in": "query",
                            "name": "search",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": false,
                            "description": "Search provided pastes list with fuzzy data",
                            "in": "query",
                            "name": "fuzzySearch",
                            "required": false,
                            "type": "boolean"
                          },
                          {
                            "default": 0,
                            "description": "It will start the result after provided counts",
                            "format": "int32",
                            "in": "query",
                            "name": "start",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": 100,
                            "description": "Returns given number of results",
                            "format": "int32",
                            "in": "query",
                            "name": "length",
                            "required": false,
                            "type": "number"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "A list of search results",
                            "schema": {
                              "$ref": "#/definitions/paste_success_response"
                            }
                          },
                          "422": {
                            "description": "Validation failure",
                            "schema": {
                              "$ref": "#/definitions/validation_response"
                            }
                          }
                        },
                        "tags": [
                          "Paste Search"
                        ],
                        "description": "Search for matching pastes.",
                        "operationId": "[[variables('_operationId-getPasteSearch')]",
                        "summary": "Paste Search"
                      }
                    },
                    "/v2/release/search": {
                      "get": {
                        "produces": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "in": "query",
                            "name": "search",
                            "type": "string"
                          },
                          {
                            "default": 0,
                            "in": "query",
                            "name": "start",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "default": 100,
                            "in": "query",
                            "name": "length",
                            "required": false,
                            "type": "number"
                          },
                          {
                            "enum": [
                              "name",
                              "size",
                              "breachDate",
                              "importDate"
                            ],
                            "in": "query",
                            "name": "sortBy",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": "asc",
                            "enum": [
                              "asc",
                              "desc"
                            ],
                            "in": "query",
                            "name": "sortType",
                            "required": false,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "A list",
                            "schema": {
                              "$ref": "#/definitions/release_success_response"
                            }
                          },
                          "422": {
                            "description": "Validation failure",
                            "schema": {
                              "$ref": "#/definitions/validation_response"
                            }
                          }
                        },
                        "tags": [
                          "Release"
                        ],
                        "description": "Search through breach releases.",
                        "operationId": "[[variables('_operationId-getReleaseSearch')]",
                        "summary": "Breach Release Search"
                      }
                    }
                  },
                  "definitions": {
                    "breach": {
                      "properties": {
                        "address": {
                          "type": "string"
                        },
                        "amazon": {
                          "type": "string"
                        },
                        "breach": {
                          "type": "string"
                        },
                        "btc": {
                          "type": "string"
                        },
                        "company": {
                          "type": "string"
                        },
                        "device": {
                          "type": "string"
                        },
                        "deviceid": {
                          "type": "string"
                        },
                        "dob": {
                          "type": "string"
                        },
                        "domain": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "fb_user": {
                          "type": "string"
                        },
                        "fbid": {
                          "type": "string"
                        },
                        "hash": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        },
                        "importdate": {
                          "type": "string"
                        },
                        "insta": {
                          "type": "string"
                        },
                        "instaid": {
                          "type": "string"
                        },
                        "ip": {
                          "type": "string"
                        },
                        "liid": {
                          "type": "string"
                        },
                        "linkedin": {
                          "type": "string"
                        },
                        "mobile": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "other": {
                          "type": "string"
                        },
                        "password": {
                          "type": "string"
                        },
                        "phone": {
                          "type": "string"
                        },
                        "salt": {
                          "type": "string"
                        },
                        "tdid": {
                          "type": "string"
                        },
                        "twitter": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        },
                        "userid": {
                          "type": "string"
                        },
                        "username": {
                          "type": "string"
                        },
                        "wallet": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "breach_field": {
                      "enum": [
                        "username",
                        "password",
                        "email",
                        "name",
                        "phone",
                        "hash",
                        "domain",
                        "ipaddress",
                        "netblock",
                        "address",
                        "crypto",
                        "social",
                        "all"
                      ],
                      "type": "string"
                    },
                    "breach_sort_field": {
                      "default": "breach",
                      "enum": [
                        "amazon",
                        "breach",
                        "btc",
                        "company",
                        "device",
                        "deviceid",
                        "dob",
                        "domain",
                        "email",
                        "hash",
                        "importdate",
                        "ip",
                        "phone",
                        "mobile",
                        "name",
                        "other",
                        "password",
                        "salt",
                        "url",
                        "userid",
                        "username",
                        "wallet",
                        "fbid",
                        "fb_user",
                        "tdid",
                        "twitter",
                        "liid",
                        "linkedin",
                        "instaid",
                        "insta"
                      ],
                      "type": "string"
                    },
                    "breach_success_response": {
                      "properties": {
                        "data": {
                          "items": {
                            "$ref": "#/definitions/breach"
                          },
                          "type": "array"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pagination": {
                          "$ref": "#/definitions/pagination"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "forum": {
                      "properties": {
                        "author": {
                          "type": "string"
                        },
                        "dateTime": {
                          "example": "March 29, 2019, 05:00:00",
                          "type": "string"
                        },
                        "forum": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pid": {
                          "type": "string"
                        },
                        "subject": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "forum_details": {
                      "properties": {
                        "author": {
                          "type": "string"
                        },
                        "cid": {
                          "type": "string"
                        },
                        "dateTime": {
                          "example": "March 29, 2019, 05:00:00",
                          "type": "string"
                        },
                        "forum": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        },
                        "img": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pid": {
                          "type": "string"
                        },
                        "subject": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "forum_field": {
                      "enum": [
                        "all",
                        "content",
                        "author"
                      ],
                      "type": "string"
                    },
                    "forum_sort_field": {
                      "enum": [
                        "pid",
                        "author",
                        "date"
                      ],
                      "type": "string"
                    },
                    "forums_search_details_success_response": {
                      "properties": {
                        "data": {
                          "items": {
                            "$ref": "#/definitions/forum_details"
                          },
                          "type": "array"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pagination": {
                          "$ref": "#/definitions/pagination"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "forums_search_success_response": {
                      "properties": {
                        "data": {
                          "items": {
                            "$ref": "#/definitions/forum"
                          },
                          "type": "array"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pagination": {
                          "$ref": "#/definitions/pagination"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "nosql": {
                      "properties": {
                        "date": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        },
                        "indexes": {
                          "items": {
                            "$ref": "#/definitions/nosql_index"
                          },
                          "type": "array"
                        },
                        "indexesCount": {
                          "type": "string"
                        },
                        "ip": {
                          "type": "string"
                        },
                        "recordsCount": {
                          "type": "string"
                        },
                        "totalSize": {
                          "type": "string"
                        },
                        "type": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "nosql_database_type": {
                      "enum": [
                        "elastic",
                        "mongodb",
                        "cassandra"
                      ],
                      "type": "string"
                    },
                    "nosql_index": {
                      "properties": {
                        "count": {
                          "type": "number"
                        },
                        "fields": {
                          "items": {
                            "type": "string"
                          },
                          "type": "array"
                        },
                        "name": {
                          "type": "string"
                        },
                        "size": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "nosql_sort_field": {
                      "default": "ip",
                      "enum": [
                        "date",
                        "ip",
                        "type",
                        "totalSize",
                        "recordsCount",
                        "indexesCount"
                      ],
                      "type": "string"
                    },
                    "nosql_success_response": {
                      "properties": {
                        "data": {
                          "items": {
                            "$ref": "#/definitions/nosql"
                          },
                          "type": "array"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pagination": {
                          "$ref": "#/definitions/pagination"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "pagination": {
                      "properties": {
                        "count": {
                          "type": "number"
                        },
                        "length": {
                          "type": "number"
                        },
                        "start": {
                          "type": "number"
                        },
                        "total": {
                          "type": "number"
                        }
                      },
                      "type": "object"
                    },
                    "paste": {
                      "properties": {
                        "date": {
                          "type": "string"
                        },
                        "pasteid": {
                          "type": "string"
                        },
                        "size": {
                          "type": "string"
                        },
                        "source": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "paste_details": {
                      "properties": {
                        "content": {
                          "type": "string"
                        },
                        "date": {
                          "type": "string"
                        },
                        "highlight": {
                          "additionalProperties": {
                            "items": {
                              "type": "string"
                            },
                            "title": "field",
                            "type": "array"
                          },
                          "example": {
                            "pasteid": [
                              "<em class='highlight'>0V18DJSI4</em>"
                            ]
                          },
                          "type": "object"
                        },
                        "pasteid": {
                          "type": "string"
                        },
                        "size": {
                          "type": "string"
                        },
                        "source": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "paste_details_success_response": {
                      "properties": {
                        "data": {
                          "$ref": "#/definitions/paste_details"
                        },
                        "message": {
                          "type": "string"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "paste_field": {
                      "enum": [
                        "pid",
                        "content"
                      ],
                      "type": "string"
                    },
                    "paste_success_response": {
                      "properties": {
                        "data": {
                          "items": {
                            "$ref": "#/definitions/paste"
                          },
                          "type": "array"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pagination": {
                          "$ref": "#/definitions/pagination"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "release_record": {
                      "properties": {
                        "breachDate": {
                          "type": "string"
                        },
                        "code": {
                          "type": "string"
                        },
                        "id": {
                          "type": "number"
                        },
                        "importDate": {
                          "type": "string"
                        },
                        "media": {
                          "type": "object"
                        },
                        "name": {
                          "type": "string"
                        },
                        "totalRecords": {
                          "type": "number"
                        },
                        "types": {
                          "type": "object"
                        }
                      },
                      "type": "object"
                    },
                    "release_record_sort_field": {
                      "enum": [
                        "name",
                        "size",
                        "breachDate",
                        "importDate"
                      ],
                      "type": "string"
                    },
                    "release_success_response": {
                      "properties": {
                        "data": {
                          "items": {
                            "$ref": "#/definitions/release_record"
                          },
                          "type": "array"
                        },
                        "message": {
                          "type": "string"
                        },
                        "pagination": {
                          "$ref": "#/definitions/pagination"
                        },
                        "success": {
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    },
                    "sort_direction": {
                      "default": "asc",
                      "enum": [
                        "asc",
                        "desc"
                      ],
                      "type": "string"
                    },
                    "validation_response": {
                      "properties": {
                        "errors": {
                          "additionalProperties": {
                            "items": {
                              "type": "string"
                            },
                            "title": "field",
                            "type": "array"
                          },
                          "example": {
                            "field": [
                              "string"
                            ]
                          },
                          "type": "object"
                        },
                        "message": {
                          "type": "string"
                        },
                        "success": {
                          "example": false,
                          "type": "boolean"
                        }
                      },
                      "type": "object"
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "apiKey"
                    }
                  },
                  "security": [
                    {}
                  ],
                  "tags": [
                    {
                      "name": "Breach"
                    },
                    {
                      "name": "Forum Search"
                    },
                    {
                      "name": "NoSQL"
                    },
                    {
                      "name": "Paste Search"
                    },
                    {
                      "name": "Release"
                    }
                  ],
                  "x-components": {
                    "responses": {
                      "validation_failure": {
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/definitions/validation_response"
                            }
                          }
                        },
                        "description": "Validation failure"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "ShadowByte Aria",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Shadowbyte"
                },
                "support": {
                  "name": "Shadowbyte",
                  "tier": "Partner",
                  "link": "https://shadowbyte.com/products/aria/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Custom Logic Apps Connector - ShadowByte Aria",
            "description": "Exposes a few operations allowing to connect to ShadowByte's Aria API.",
            "prerequisites": [
              "1. Generate an API key by going into [ShadowByte Aria's Settings](https://app.ariaintel.io/user-preferences/settings)."
            ],
            "lastUpdateTime": "2021-11-26T00:00:00Z",
            "tags": [
              "CustomConnector"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "shadowbyte-aria-enrich-alerts playbook",
        "displayName": "shadowbyte-aria-enrich-alerts playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "shadowbyte-aria-enrich-alerts Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "shadowbyte-aria-enrich-alerts",
              "type": "String"
            },
            "ShadowByteAriaConnectorName": {
              "defaultValue": "ShadowByteAriaConnector",
              "type": "String"
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "ShadowByteAriaConnectionName": "[[concat('shadowbyteariaconnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('ShadowByteAriaConnectorName'))]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('ShadowByteAriaConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('ShadowByteAriaConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "tags": {
                "LogicAppsCategory": "security",
                "hidden-SentinelTemplateName": "EnrichIncidentsShadowByteAria",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "Compose": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>The following breaches were found to be associated with the affected accounts:<br>\n@{outputs('Compose')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Compose": {
                      "runAfter": {
                        "For_each": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose",
                      "inputs": "@variables('Breaches')"
                    },
                    "Entities_-_Get_Accounts": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/account"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_Accounts')?['Accounts']",
                      "actions": {
                        "If_the_Account_Name_is_not_an_empty_string": {
                          "actions": {
                            "Breach_Search": {
                              "type": "ApiConnection",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['ShadowByteAriaConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/v2/breach/search",
                                "queries": {
                                  "fuzzySearch": false,
                                  "length": 1000,
                                  "marketingData": false,
                                  "search": "@items('For_each')?['Name']",
                                  "searchType": "all",
                                  "sortBy": "breach",
                                  "sortType": "asc",
                                  "start": 0
                                }
                              }
                            },
                            "If_the_request_returned_any_results": {
                              "actions": {
                                "Append_to_string_variable": {
                                  "runAfter": {
                                    "Create_HTML_table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToStringVariable",
                                  "inputs": {
                                    "name": "Breaches",
                                    "value": "@body('Create_HTML_table')"
                                  }
                                },
                                "Create_HTML_table": {
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@body('Breach_Search')?['data']"
                                  }
                                }
                              },
                              "runAfter": {
                                "Breach_Search": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Breach_Search')?['success']",
                                      true
                                    ]
                                  },
                                  {
                                    "greater": [
                                      "@body('Breach_Search')?['pagination']?['count']",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(items('For_each')?['Name'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Initialize_Breaches": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_Breaches": {
                      "runAfter": {
                        "Entities_-_Get_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Breaches",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "ShadowByteAriaConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('ShadowByteAriaConnectionName'))]",
                        "connectionName": "[[variables('ShadowByteAriaConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('ShadowByteAriaConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "ShadowByte Aria",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Shadowbyte"
                },
                "support": {
                  "name": "Shadowbyte",
                  "tier": "Partner",
                  "link": "https://shadowbyte.com/products/aria/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_ShadowByte_Aria_Custom_Connector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Enrich Incidents - ShadowByte Aria",
            "description": "This playbook updates the Incident with the brach details if an account has been compromised.",
            "mainSteps": [
              "1. Fetch the breach information from ShadowByte Aria",
              "2. Enrich the incident with breach information from ShadowByte Aria"
            ],
            "prerequisites": [
              "1. ShadowByte Aria Custom Connector needs to be deployed and configured prior to the deployment of this playbook under the same resource group."
            ],
            "lastUpdateTime": "2022-07-31T00:00:00Z",
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Enrich Incidents - ShadowByte Aria",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "shadowbyte-aria-search-for-breaches playbook",
        "displayName": "shadowbyte-aria-search-for-breaches playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "shadowbyte-aria-search-for-breaches Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "shadowbyte-aria-search-for-breaches",
              "type": "String"
            },
            "ShadowByteAriaConnectorName": {
              "defaultValue": "ShadowByteAriaConnector",
              "type": "String"
            },
            "WorkspaceId": {
              "type": "String"
            },
            "WorkspaceKey": {
              "type": "String"
            },
            "Search": {
              "defaultValue": "phrase",
              "type": "String"
            },
            "SearchType": {
              "defaultValue": "search-all",
              "type": "String"
            }
          },
          "variables": {
            "AzureLogAnalyticsDataCollectorConnectionName": "[[concat('azureloganalyticsdatacollector-', parameters('PlaybookName'))]",
            "ShadowByteAriaConnectionName": "[[concat('shadowbyteariaconnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('ShadowByteAriaConnectorName'))]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azureloganalyticsdatacollector')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('ShadowByteAriaConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureLogAnalyticsDataCollectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureLogAnalyticsDataCollectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                },
                "parameterValues": {
                  "username": "[[parameters('WorkspaceId')]",
                  "password": "[[parameters('WorkspaceKey')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('ShadowByteAriaConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureLogAnalyticsDataCollectorConnectionName'))]"
              ],
              "tags": {
                "LogicAppsCategory": "security",
                "hidden-SentinelTemplateName": "SearchForBreachesShadowByteAria",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "search": {
                      "defaultValue": " ",
                      "type": "String"
                    },
                    "type": {
                      "defaultValue": "search-all",
                      "type": "String"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "Initialize_variable": {
                      "runAfter": {
                        "Set_End_Date": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nextStart",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "Set_End_Date": {
                      "runAfter": {
                        "Set_Start_Date": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "formattedEndDate",
                            "type": "string",
                            "value": "@{formatDateTime(utcNow(), 'yyyy-MM-dd')}"
                          }
                        ]
                      }
                    },
                    "Set_Start_Date": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "formattedStartDate",
                            "type": "string",
                            "value": "@{formatDateTime(addDays(utcNow(), -1), 'yyyy-MM-dd')}"
                          }
                        ]
                      }
                    },
                    "Until": {
                      "actions": {
                        "Breach_Search": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['ShadowByteAriaConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/v2/breach/search",
                            "queries": {
                              "dateFrom": "@variables('formattedStartDate')",
                              "dateTo": "@variables('formattedEndDate')",
                              "fuzzySearch": false,
                              "length": 100,
                              "marketingData": false,
                              "search": "@parameters('search')",
                              "searchType": "@parameters('type')",
                              "sortBy": "breach",
                              "sortType": "asc",
                              "start": "@variables('nextStart')"
                            }
                          }
                        },
                        "For_each": {
                          "foreach": "@body('Breach_Search')?['data']",
                          "actions": {
                            "Send_Data": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": "@{items('For_each')}",
                                "headers": {
                                  "Log-Type": "ShadowByteAriaForums"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azureloganalyticsdatacollector']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/api/logs"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Set_variable": {
                          "runAfter": {
                            "Breach_Search": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "nextStart",
                            "value": "@add(body('Breach_Search').pagination.start, body('Breach_Search').pagination.length)"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable": [
                          "Succeeded"
                        ]
                      },
                      "expression": "@greaterOrEquals(variables('nextStart'), body('Breach_Search')?['pagination']?['total'])",
                      "limit": {
                        "count": 100,
                        "timeout": "PT1H"
                      },
                      "type": "Until"
                    }
                  }
                },
                "parameters": {
                  "search": {
                    "type": "String",
                    "value": "[[parameters('Search')]"
                  },
                  "type": {
                    "type": "String",
                    "value": "[[parameters('SearchType')]"
                  },
                  "$connections": {
                    "value": {
                      "ShadowByteAriaConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('ShadowByteAriaConnectionName'))]",
                        "connectionName": "[[variables('ShadowByteAriaConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('ShadowByteAriaConnectorName'))]"
                      },
                      "azureloganalyticsdatacollector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureLogAnalyticsDataCollectorConnectionName'))]",
                        "connectionName": "[[variables('AzureLogAnalyticsDataCollectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azureloganalyticsdatacollector')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "ShadowByte Aria",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Shadowbyte"
                },
                "support": {
                  "name": "Shadowbyte",
                  "tier": "Partner",
                  "link": "https://shadowbyte.com/products/aria/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_ShadowByte_Aria_Custom_Connector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Search for Breaches - ShadowByte Aria",
            "description": "This playbook updates the Incident with the brach details if an account has been compromised.",
            "mainSteps": [
              "1. Fetch the breach information from ShadowByte Aria",
              "2. Send the breach information to the chosen Azure Log Analytics workspace"
            ],
            "prerequisites": [
              "1. ShadowByte Aria Custom Connector needs to be deployed and configured prior to the deployment of this playbook under the same resource group."
            ],
            "lastUpdateTime": "2022-07-31T00:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Search for Breaches - ShadowByte Aria",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "ShadowByte Aria",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Shadowbyte"
        },
        "support": {
          "name": "Shadowbyte",
          "tier": "Partner",
          "link": "https://shadowbyte.com/products/aria/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_ShadowByte_Aria_Custom_Connector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_ShadowByte_Aria_Enrich_Incidents')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_ShadowByte_Aria_Search_for_Breaches')]",
              "version": "[variables('playbookVersion3')]"
            }
          ]
        },
        "firstPublishDate": "2021-12-24",
        "providers": [
          "Shadowbytes"
        ],
        "categories": {
          "domains": [
            "Security - Threat Intelligence"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
