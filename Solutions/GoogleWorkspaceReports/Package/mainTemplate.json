{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for GoogleWorkspaceReports"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "GoogleWorkspaceReports",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-googleworkspacereports",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "GoogleWorkspaceWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "parserVersion1": "1.0.0",
    "parserContentId1": "GWorkspaceActivityReports-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "parserName1": "GWorkspaceActivityReports",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "analyticRuleVersion1": "1.0.1",
    "analyticRulecontentId1": "03f25156-6172-11ec-90d6-0242ac120003",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.1",
    "analyticRulecontentId2": "e369d246-5da8-11ec-bf63-0242ac130002",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.1",
    "analyticRulecontentId3": "c45a9804-5da8-11ec-bf63-0242ac130002",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
    "analyticRuleVersion4": "1.0.1",
    "analyticRulecontentId4": "92fae638-5da8-11ec-bf63-0242ac130002",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
    "analyticRuleVersion5": "1.0.1",
    "analyticRulecontentId5": "6ff0e16e-5999-11ec-bf63-0242ac130002",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5')))]",
    "analyticRuleVersion6": "1.0.1",
    "analyticRulecontentId6": "ead87cd6-5da7-11ec-bf63-0242ac130002",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6')))]",
    "analyticRuleVersion7": "1.0.1",
    "analyticRulecontentId7": "8f6cd9a4-5e57-11ec-bf63-0242ac130002",
    "_analyticRulecontentId7": "[variables('analyticRulecontentId7')]",
    "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId7'))]",
    "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId7')))]",
    "analyticRuleVersion8": "1.0.1",
    "analyticRulecontentId8": "d80d02a8-5da6-11ec-bf63-0242ac130002",
    "_analyticRulecontentId8": "[variables('analyticRulecontentId8')]",
    "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId8'))]",
    "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId8')))]",
    "analyticRuleVersion9": "1.0.0",
    "analyticRulecontentId9": "c8cc02d0-5da6-11ec-bf63-0242ac130002",
    "_analyticRulecontentId9": "[variables('analyticRulecontentId9')]",
    "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId9'))]",
    "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId9')))]",
    "analyticRuleVersion10": "1.0.1",
    "analyticRulecontentId10": "c02b0c8e-5da6-11ec-bf63-0242ac130002",
    "_analyticRulecontentId10": "[variables('analyticRulecontentId10')]",
    "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId10'))]",
    "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId10')))]",
    "uiConfigId1": "GoogleWorkspaceReportsAPI",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "GoogleWorkspaceReportsAPI",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0",
    "huntingQueryVersion1": "1.0.0",
    "huntingQuerycontentId1": "00d743e2-5dac-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId1": "[variables('huntingQuerycontentId1')]",
    "huntingQueryId1": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId1'))]",
    "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId1')))]",
    "huntingQueryVersion2": "1.0.0",
    "huntingQuerycontentId2": "e37c86ea-5dab-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId2": "[variables('huntingQuerycontentId2')]",
    "huntingQueryId2": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId2'))]",
    "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId2')))]",
    "huntingQueryVersion3": "1.0.0",
    "huntingQuerycontentId3": "c7c65c78-5dab-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId3": "[variables('huntingQuerycontentId3')]",
    "huntingQueryId3": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId3'))]",
    "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId3')))]",
    "huntingQueryVersion4": "1.0.0",
    "huntingQuerycontentId4": "bb6bf88e-5dab-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId4": "[variables('huntingQuerycontentId4')]",
    "huntingQueryId4": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId4'))]",
    "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId4')))]",
    "huntingQueryVersion5": "1.0.0",
    "huntingQuerycontentId5": "29ce9d14-5dab-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId5": "[variables('huntingQuerycontentId5')]",
    "huntingQueryId5": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId5'))]",
    "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId5')))]",
    "huntingQueryVersion6": "1.0.0",
    "huntingQuerycontentId6": "0b20d206-5dab-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId6": "[variables('huntingQuerycontentId6')]",
    "huntingQueryId6": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId6'))]",
    "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId6')))]",
    "huntingQueryVersion7": "1.0.0",
    "huntingQuerycontentId7": "2da2122e-5da9-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId7": "[variables('huntingQuerycontentId7')]",
    "huntingQueryId7": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId7'))]",
    "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId7')))]",
    "huntingQueryVersion8": "1.0.0",
    "huntingQuerycontentId8": "26cea052-5da9-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId8": "[variables('huntingQuerycontentId8')]",
    "huntingQueryId8": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId8'))]",
    "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId8')))]",
    "huntingQueryVersion9": "1.0.0",
    "huntingQuerycontentId9": "1efb71b6-5da9-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId9": "[variables('huntingQuerycontentId9')]",
    "huntingQueryId9": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId9'))]",
    "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId9')))]",
    "huntingQueryVersion10": "1.0.0",
    "huntingQuerycontentId10": "05189314-5e58-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId10": "[variables('huntingQuerycontentId10')]",
    "huntingQueryId10": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId10'))]",
    "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId10')))]",
    "huntingQueryVersion11": "1.0.0",
    "huntingQuerycontentId11": "181bda98-5da9-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId11": "[variables('huntingQuerycontentId11')]",
    "huntingQueryId11": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId11'))]",
    "huntingQueryTemplateSpecName11": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId11')))]",
    "huntingQueryVersion12": "1.0.0",
    "huntingQuerycontentId12": "1087fb40-5da9-11ec-bf63-0242ac130002",
    "_huntingQuerycontentId12": "[variables('huntingQuerycontentId12')]",
    "huntingQueryId12": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId12'))]",
    "huntingQueryTemplateSpecName12": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId12')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Workbook with template",
        "displayName": "GoogleWorkspaceReports workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "GoogleWorkspaceWorkbook Workbook with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This data connector depends on a parser based on Kusto Function **GWorkspaceActivityReports** to work as expected. [Follow steps to get this Kusto Function](https://aka.ms/sentinel-googleworkspace-parser)\"},\"name\":\"text - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cd8447d9-b096-4673-92d8-2a1e8291a125\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"description\":\"Sets the time name for analysis\",\"value\":{\"durationMs\":7776000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"GWorkspaceActivityReports\\r\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Events Over Time\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"graphSettings\":{\"type\":0}},\"customWidth\":\"55\",\"name\":\"query - 12\",\"styleSettings\":{\"maxWidth\":\"55\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  GWorkspaceActivityReports\\r\\n  | where isnotempty(AppName) \\r\\n  | summarize Applications = count() by AppName\",\"size\":3,\"title\":\"Applications\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 0\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"GWorkspaceActivityReports\\r\\n  | where IsSuspicious == \\\"true\\\" \\r\\n  | count \",\"size\":3,\"title\":\"Suspicious events\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"DstPortNumber\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"DstPortNumber\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"DstPortNumber\",\"heatmapPalette\":\"greenRed\"}},\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"GWorkspaceActivityReports \\r\\n| where EventType contains \\\"ALERT\\\"\\r\\n| count\\r\\n\",\"size\":3,\"title\":\"Alerts\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"card\",\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 12\"}]},\"customWidth\":\"15\",\"name\":\"group - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  GWorkspaceActivityReports\\r\\n  | where isnotempty(EventType) \\r\\n  | summarize Applications = count() by EventType\\r\\n  | top 20 by Applications\",\"size\":1,\"title\":\"Event types\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"33\",\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"10\",\"padding\":\"10\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"GWorkspaceActivityReports\\r\\n  | where isnotempty(LoginType) \\r\\n  | summarize login = count() by LoginType\\r\\n  | top 20 by login\",\"size\":3,\"title\":\"Login types\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"30\",\"name\":\"query - 15\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  GWorkspaceActivityReports\\r\\n  | where isnotempty(ActorCallerType) \\r\\n  | summarize UserType = count() by ActorCallerType\\r\\n  | top 20 by UserType\",\"size\":3,\"title\":\"User type\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - 9\",\"styleSettings\":{\"maxWidth\":\"33\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  GWorkspaceActivityReports\\r\\n  | where isnotempty(DocType) \\r\\n  | summarize DocumentType = count() by DocType\\r\\n  | top 20 by DocumentType\",\"size\":3,\"title\":\"Document types\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"35\",\"name\":\"query - 10\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"GWorkspaceActivityReports\\r\\n| where EventType =~ \\\"login\\\"\\r\\n| where isnotempty(LoginType)\\r\\n| sort by TimeGenerated desc \\r\\n| project User=ActorEmail, LoginType, Action=case(EventMessage =~ 'login_success', '✅ - Logged in', EventMessage =~ 'login_failure' or IsSuspicious == true, '❌ - Login failed', 'Verification')\",\"size\":0,\"title\":\"User Authentication\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"query - 13\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"GWorkspaceActivityReports\\r\\n| where isnotempty(ActorEmail)\\r\\n| where isnotempty(EventType)\\r\\n| where EventMessage != 'change_event'\\r\\n| sort by TimeGenerated desc \\r\\n| project User=ActorEmail, SourceAddress=SrcIpAddr, DocumentTitle=DocTitle, Action=EventMessage, IsSecurityEvent=strcat(iff(EventType contains \\\"alert\\\", '❌', '✅'))\\r\\n\",\"size\":0,\"title\":\"Document operations\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":100,\"filter\":true}},\"name\":\"query - 12\"}],\"fromTemplateId\":\"sentinel-GoogleWorkspaceWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=GoogleWorkspaceWorkbook; logoFileName=google_logo.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=GoogleWorkspaceReports; templateRelativePath=GoogleWorkspace.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                },
				"dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "GWorkspace_ReportsAPI_admin_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "GWorkspace_ReportsAPI_calendar_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "GWorkspace_ReportsAPI_drive_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "GWorkspace_ReportsAPI_login_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "GWorkspace_ReportsAPI_login_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "GWorkspace_ReportsAPI_mobile_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "GoogleWorkspaceReportsAPI",
                      "kind": "DataConnector"
                    }
                  ]
				}
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "GWorkspaceActivityReports Data Parser with template",
        "displayName": "GWorkspaceActivityReports Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "GWorkspaceActivityReports Data Parser with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspaceActivityReports",
                "category": "Samples",
                "functionAlias": "GWorkspaceActivityReports",
                "query": "\nlet GWorkspace_ReportsAPI_view  = view () { \r\nunion isfuzzy=true  GWorkspace_ReportsAPI_access_transparency_CL, GWorkspace_ReportsAPI_admin_CL,\r\n                    GWorkspace_ReportsAPI_calendar_CL, GWorkspace_ReportsAPI_chat_CL,\r\n                    GWorkspace_ReportsAPI_drive_CL, GWorkspace_ReportsAPI_gcp_CL,\r\n                    GWorkspace_ReportsAPI_gplus_CL, GWorkspace_ReportsAPI_groups_CL,\r\n                    GWorkspace_ReportsAPI_groups_enterprise_CL, GWorkspace_ReportsAPI_jamboard_CL,\r\n                    GWorkspace_ReportsAPI_login_CL, GWorkspace_ReportsAPI_meet_CL,\r\n                    GWorkspace_ReportsAPI_mobile_CL, GWorkspace_ReportsAPI_rules_CL,\r\n                    GWorkspace_ReportsAPI_saml_CL, GWorkspace_ReportsAPI_token_CL,\r\n                    GWorkspace_ReportsAPI_user_accounts_CL, GWorkspace_ReportsAPI_context_aware_access_CL,\r\n                    GWorkspace_ReportsAPI_chrome_CL, GWorkspace_ReportsAPI_data_studio_CL,\r\n                    GWorkspace_ReportsAPI_keep_CL\r\n| extend \r\n        AccountState=column_ifexists('ACCOUNT_STATE_s', ''),\r\n        ActorCallerType=column_ifexists('actor_callerType_s', ''),\r\n        ActorEmail=column_ifexists('actor_email_s', ''),\r\n        ActorIsCollaboratorAccount=column_ifexists('actor_is_collaborator_account_b', ''),\r\n        ActorKey=column_ifexists('actor_key_s', ''),\r\n        ActorProfileId=column_ifexists('actor_profileId_s', ''),\r\n        ApiKind=column_ifexists('api_kind_s', ''),\r\n        AppName=column_ifexists('app_name_s', ''),\r\n        ApplicationEdition=column_ifexists('APPLICATION_EDITION_s', ''),\r\n        ApplicationName=column_ifexists('APPLICATION_NAME_s', ''),\r\n        Billable=column_ifexists('billable_b', ''),\r\n        CalendarId=column_ifexists('calendar_id_s', ''),\r\n        ClientId=column_ifexists('client_id_s', ''),\r\n        ClientType=column_ifexists('client_type_s', ''),\r\n        DestinationFolderId=column_ifexists('destination_folder_id_s', ''),\r\n        DestinationFolderTitle=column_ifexists('destination_folder_title_s', ''),\r\n        DocId=column_ifexists('doc_id_s', ''),\r\n        DocTitle=column_ifexists('doc_title_s', ''),\r\n        DocType=column_ifexists('doc_type_s', ''),\r\n        DstUserUpn=column_ifexists('USER_EMAIL_s', ''),\r\n        DestUserUpn=column_ifexists('recipient_email_s', ''),\r\n        DvcGuid=column_ifexists('DEVICE_ID_g', ''),\r\n        DvcInterfaceGuid=column_ifexists('DEVICE_ID_s', ''),\r\n        DvcModelName=column_ifexists('DEVICE_MODEL_s', ''),\r\n        DvcModelNumber=column_ifexists('OS_VERSION_s', ''),\r\n        DvcType=column_ifexists('DEVICE_TYPE_s', ''),\r\n        Etag=column_ifexists('etag_s', ''),\r\n        EventCategoryType=column_ifexists('kind_s', ''),\r\n        EventEndTime=column_ifexists('end_time_s', ''),\r\n        EventGuest=column_ifexists('event_guest_s', ''),\r\n        EventId=column_ifexists('id_uniqueQualifier_s', ''),\r\n        EventMessage=column_ifexists('event_name_s', ''),\r\n        EventOriginalMessage=column_ifexists('events_s', ''),\r\n        EventProduct=\"Google Workspace Activity Reports\",\r\n        EventResponseStatus=column_ifexists('event_response_status_s', ''),\r\n        EventStartTime=column_ifexists('start_time_s', ''),\r\n        EventTitle=column_ifexists('event_title_s', ''),\r\n        EventType=column_ifexists('event_type_s', ''),\r\n        EventUid=column_ifexists('event_id_s', ''),\r\n        EventVendor=\"Google\",\r\n        GroupDomain=column_ifexists('ORG_UNIT_NAME_s', ''),\r\n        IdApplicationName=column_ifexists('id_applicationName_s', ''),\r\n        IosVendorId=column_ifexists('IOS_VENDOR_ID_s', ''),\r\n        IosVendorUID=column_ifexists('IOS_VENDOR_ID_g', ''),\r\n        IsSecondFactor=column_ifexists('is_second_factor_b', ''),\r\n        IsSuspicious=column_ifexists('is_suspicious_b', ''),\r\n        Kind=column_ifexists('kind_s', ''),\r\n        LastSyncAuditDate=column_ifexists('LAST_SYNC_AUDIT_DATE_s', ''),\r\n        LoginChallengeMethod=column_ifexists('login_challenge_method_s', ''),\r\n        LoginChallengeStatus=column_ifexists('login_challenge_status_s', ''),\r\n        LoginType=column_ifexists('login_type_s', ''),\r\n        ModuleName=column_ifexists('PRODUCT_NAME_s', ''),\r\n        NeqValue=column_ifexists('NEW_VALUE_s', ''),\r\n        Newvalue=column_ifexists('new_value_s', ''),\r\n        NotificationMessageId=column_ifexists('notification_message_id_s', ''),\r\n        NotificationMethod=column_ifexists('notification_method_s', ''),\r\n        NotificationType=column_ifexists('notification_type_s', ''),\r\n        OldEventTitle=column_ifexists('old_event_title_s', ''),\r\n        OldValue=column_ifexists('OLD_VALUE_s', ''),\r\n        Oldvalue=column_ifexists('old_value_s', ''),\r\n        OldVisibility=column_ifexists('old_visibility_s', ''),\r\n        OrganizerCalendarId=column_ifexists('organizer_calendar_id_s', ''),\r\n        OriginatingAppId=column_ifexists('originating_app_id_s', ''),\r\n        OsProperty=column_ifexists('OS_PROPERTY_s', ''),\r\n        Owner=column_ifexists('owner_s', ''),\r\n        OwnerDomain=column_ifexists('ownerDomain_s', ''),\r\n        OwnerIsSharedDrive=column_ifexists('owner_is_shared_drive_b', ''),\r\n        OwnerIsTeamDrive=column_ifexists('owner_is_team_drive_b', ''),\r\n        PrimaryEvent=column_ifexists('primary_event_b', ''),\r\n        ProcessName=column_ifexists('SETTING_NAME_s', ''),\r\n        RegisterPrivelege=column_ifexists('REGISTER_PRIVILEGE_s', ''),\r\n        ResourceId=column_ifexists('RESOURCE_ID_s', ''),\r\n        RoleName=column_ifexists('ROLE_NAME_s', ''),\r\n        Scope=column_ifexists('scope_s', ''),\r\n        ScopeData=column_ifexists('scope_data_s', ''),\r\n        SerialNumber=column_ifexists('SERIAL_NUMBER_s', ''),\r\n        SharedDriveId=column_ifexists('shared_drive_id_s', ''),\r\n        SourceFolderId=column_ifexists('source_folder_id_s', ''),\r\n        SourceFolderTitle=column_ifexists('source_folder_title_s', ''),\r\n        SrcIpAddr=column_ifexists('IPAddress', ''),\r\n        TargetCalendarId=column_ifexists('target_calendar_id_s', ''),\r\n        TargetUserDomain=column_ifexists('target_domain_s', ''),\r\n        TargetUserName=column_ifexists('target_user_s', ''),\r\n        TeamDriveId=column_ifexists('team_drive_id_s', ''),\r\n        UserAadid=column_ifexists('id_customerId_s', ''),\r\n        UserAgentOriginal=column_ifexists('user_agent_s', ''),\r\n        UserEmail=column_ifexists('USER_EMAIL_s', ''),\r\n        Visibility=column_ifexists('visibility_s', ''),\r\n        VisibilityChange=column_ifexists('visibility_change_s', '')\r\n| project \r\n        TimeGenerated,\r\n        AccountState,\r\n        ActorCallerType,\r\n        ActorEmail,\r\n        ActorIsCollaboratorAccount,\r\n        ActorKey,\r\n        ActorProfileId,\r\n        ApiKind,\r\n        AppName,\r\n        ApplicationEdition,\r\n        ApplicationName,\r\n        Billable,\r\n        CalendarId,\r\n        ClientId,\r\n        ClientType,\r\n        DestinationFolderId,\r\n        DestinationFolderTitle,\r\n        DocId,\r\n        DocTitle,\r\n        DocType,\r\n        DstUserUpn,\r\n        DestUserUpn,\r\n        DvcGuid,\r\n        DvcInterfaceGuid,\r\n        DvcModelName,\r\n        DvcModelNumber,\r\n        DvcType,\r\n        Etag,\r\n        EventCategoryType,\r\n        EventEndTime,\r\n        EventGuest,\r\n        EventId,\r\n        EventMessage,\r\n        EventOriginalMessage,\r\n        EventProduct,\r\n        EventResponseStatus,\r\n        EventStartTime,\r\n        EventTitle,\r\n        EventType,\r\n        EventUid,\r\n        EventVendor,\r\n        GroupDomain,\r\n        IdApplicationName,\r\n        IosVendorId,\r\n        IosVendorUID,\r\n        IsSecondFactor,\r\n        IsSuspicious,\r\n        Kind,\r\n        LastSyncAuditDate,\r\n        LoginChallengeMethod,\r\n        LoginChallengeStatus,\r\n        LoginType,\r\n        ModuleName,\r\n        NeqValue,\r\n        Newvalue,\r\n        NotificationMessageId,\r\n        NotificationMethod,\r\n        NotificationType,\r\n        OldEventTitle,\r\n        OldValue,\r\n        Oldvalue,\r\n        OldVisibility,\r\n        OrganizerCalendarId,\r\n        OriginatingAppId,\r\n        OsProperty,\r\n        Owner,\r\n        OwnerDomain,\r\n        OwnerIsSharedDrive,\r\n        OwnerIsTeamDrive,\r\n        PrimaryEvent,\r\n        ProcessName,\r\n        RegisterPrivelege,\r\n        ResourceId,\r\n        RoleName,\r\n        Scope,\r\n        ScopeData,\r\n        SerialNumber,\r\n        SharedDriveId,\r\n        SourceFolderId,\r\n        SourceFolderTitle,\r\n        SrcIpAddr,\r\n        TargetCalendarId,\r\n        TargetUserDomain,\r\n        TargetUserName,\r\n        TeamDriveId,\r\n        UserAadid,\r\n        UserAgentOriginal,\r\n        UserEmail,\r\n        Visibility,\r\n        VisibilityChange\r\n};\r\nGWorkspace_ReportsAPI_view",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "GWorkspaceActivityReports"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "GoogleWorkspaceReports",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2021-06-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "GWorkspaceActivityReports",
        "category": "Samples",
        "functionAlias": "GWorkspaceActivityReports",
        "query": "\nlet GWorkspace_ReportsAPI_view  = view () { \r\nunion isfuzzy=true  GWorkspace_ReportsAPI_access_transparency_CL, GWorkspace_ReportsAPI_admin_CL,\r\n                    GWorkspace_ReportsAPI_calendar_CL, GWorkspace_ReportsAPI_chat_CL,\r\n                    GWorkspace_ReportsAPI_drive_CL, GWorkspace_ReportsAPI_gcp_CL,\r\n                    GWorkspace_ReportsAPI_gplus_CL, GWorkspace_ReportsAPI_groups_CL,\r\n                    GWorkspace_ReportsAPI_groups_enterprise_CL, GWorkspace_ReportsAPI_jamboard_CL,\r\n                    GWorkspace_ReportsAPI_login_CL, GWorkspace_ReportsAPI_meet_CL,\r\n                    GWorkspace_ReportsAPI_mobile_CL, GWorkspace_ReportsAPI_rules_CL,\r\n                    GWorkspace_ReportsAPI_saml_CL, GWorkspace_ReportsAPI_token_CL,\r\n                    GWorkspace_ReportsAPI_user_accounts_CL, GWorkspace_ReportsAPI_context_aware_access_CL,\r\n                    GWorkspace_ReportsAPI_chrome_CL, GWorkspace_ReportsAPI_data_studio_CL,\r\n                    GWorkspace_ReportsAPI_keep_CL\r\n| extend \r\n        AccountState=column_ifexists('ACCOUNT_STATE_s', ''),\r\n        ActorCallerType=column_ifexists('actor_callerType_s', ''),\r\n        ActorEmail=column_ifexists('actor_email_s', ''),\r\n        ActorIsCollaboratorAccount=column_ifexists('actor_is_collaborator_account_b', ''),\r\n        ActorKey=column_ifexists('actor_key_s', ''),\r\n        ActorProfileId=column_ifexists('actor_profileId_s', ''),\r\n        ApiKind=column_ifexists('api_kind_s', ''),\r\n        AppName=column_ifexists('app_name_s', ''),\r\n        ApplicationEdition=column_ifexists('APPLICATION_EDITION_s', ''),\r\n        ApplicationName=column_ifexists('APPLICATION_NAME_s', ''),\r\n        Billable=column_ifexists('billable_b', ''),\r\n        CalendarId=column_ifexists('calendar_id_s', ''),\r\n        ClientId=column_ifexists('client_id_s', ''),\r\n        ClientType=column_ifexists('client_type_s', ''),\r\n        DestinationFolderId=column_ifexists('destination_folder_id_s', ''),\r\n        DestinationFolderTitle=column_ifexists('destination_folder_title_s', ''),\r\n        DocId=column_ifexists('doc_id_s', ''),\r\n        DocTitle=column_ifexists('doc_title_s', ''),\r\n        DocType=column_ifexists('doc_type_s', ''),\r\n        DstUserUpn=column_ifexists('USER_EMAIL_s', ''),\r\n        DestUserUpn=column_ifexists('recipient_email_s', ''),\r\n        DvcGuid=column_ifexists('DEVICE_ID_g', ''),\r\n        DvcInterfaceGuid=column_ifexists('DEVICE_ID_s', ''),\r\n        DvcModelName=column_ifexists('DEVICE_MODEL_s', ''),\r\n        DvcModelNumber=column_ifexists('OS_VERSION_s', ''),\r\n        DvcType=column_ifexists('DEVICE_TYPE_s', ''),\r\n        Etag=column_ifexists('etag_s', ''),\r\n        EventCategoryType=column_ifexists('kind_s', ''),\r\n        EventEndTime=column_ifexists('end_time_s', ''),\r\n        EventGuest=column_ifexists('event_guest_s', ''),\r\n        EventId=column_ifexists('id_uniqueQualifier_s', ''),\r\n        EventMessage=column_ifexists('event_name_s', ''),\r\n        EventOriginalMessage=column_ifexists('events_s', ''),\r\n        EventProduct=\"Google Workspace Activity Reports\",\r\n        EventResponseStatus=column_ifexists('event_response_status_s', ''),\r\n        EventStartTime=column_ifexists('start_time_s', ''),\r\n        EventTitle=column_ifexists('event_title_s', ''),\r\n        EventType=column_ifexists('event_type_s', ''),\r\n        EventUid=column_ifexists('event_id_s', ''),\r\n        EventVendor=\"Google\",\r\n        GroupDomain=column_ifexists('ORG_UNIT_NAME_s', ''),\r\n        IdApplicationName=column_ifexists('id_applicationName_s', ''),\r\n        IosVendorId=column_ifexists('IOS_VENDOR_ID_s', ''),\r\n        IosVendorUID=column_ifexists('IOS_VENDOR_ID_g', ''),\r\n        IsSecondFactor=column_ifexists('is_second_factor_b', ''),\r\n        IsSuspicious=column_ifexists('is_suspicious_b', ''),\r\n        Kind=column_ifexists('kind_s', ''),\r\n        LastSyncAuditDate=column_ifexists('LAST_SYNC_AUDIT_DATE_s', ''),\r\n        LoginChallengeMethod=column_ifexists('login_challenge_method_s', ''),\r\n        LoginChallengeStatus=column_ifexists('login_challenge_status_s', ''),\r\n        LoginType=column_ifexists('login_type_s', ''),\r\n        ModuleName=column_ifexists('PRODUCT_NAME_s', ''),\r\n        NeqValue=column_ifexists('NEW_VALUE_s', ''),\r\n        Newvalue=column_ifexists('new_value_s', ''),\r\n        NotificationMessageId=column_ifexists('notification_message_id_s', ''),\r\n        NotificationMethod=column_ifexists('notification_method_s', ''),\r\n        NotificationType=column_ifexists('notification_type_s', ''),\r\n        OldEventTitle=column_ifexists('old_event_title_s', ''),\r\n        OldValue=column_ifexists('OLD_VALUE_s', ''),\r\n        Oldvalue=column_ifexists('old_value_s', ''),\r\n        OldVisibility=column_ifexists('old_visibility_s', ''),\r\n        OrganizerCalendarId=column_ifexists('organizer_calendar_id_s', ''),\r\n        OriginatingAppId=column_ifexists('originating_app_id_s', ''),\r\n        OsProperty=column_ifexists('OS_PROPERTY_s', ''),\r\n        Owner=column_ifexists('owner_s', ''),\r\n        OwnerDomain=column_ifexists('ownerDomain_s', ''),\r\n        OwnerIsSharedDrive=column_ifexists('owner_is_shared_drive_b', ''),\r\n        OwnerIsTeamDrive=column_ifexists('owner_is_team_drive_b', ''),\r\n        PrimaryEvent=column_ifexists('primary_event_b', ''),\r\n        ProcessName=column_ifexists('SETTING_NAME_s', ''),\r\n        RegisterPrivelege=column_ifexists('REGISTER_PRIVILEGE_s', ''),\r\n        ResourceId=column_ifexists('RESOURCE_ID_s', ''),\r\n        RoleName=column_ifexists('ROLE_NAME_s', ''),\r\n        Scope=column_ifexists('scope_s', ''),\r\n        ScopeData=column_ifexists('scope_data_s', ''),\r\n        SerialNumber=column_ifexists('SERIAL_NUMBER_s', ''),\r\n        SharedDriveId=column_ifexists('shared_drive_id_s', ''),\r\n        SourceFolderId=column_ifexists('source_folder_id_s', ''),\r\n        SourceFolderTitle=column_ifexists('source_folder_title_s', ''),\r\n        SrcIpAddr=column_ifexists('IPAddress', ''),\r\n        TargetCalendarId=column_ifexists('target_calendar_id_s', ''),\r\n        TargetUserDomain=column_ifexists('target_domain_s', ''),\r\n        TargetUserName=column_ifexists('target_user_s', ''),\r\n        TeamDriveId=column_ifexists('team_drive_id_s', ''),\r\n        UserAadid=column_ifexists('id_customerId_s', ''),\r\n        UserAgentOriginal=column_ifexists('user_agent_s', ''),\r\n        UserEmail=column_ifexists('USER_EMAIL_s', ''),\r\n        Visibility=column_ifexists('visibility_s', ''),\r\n        VisibilityChange=column_ifexists('visibility_change_s', '')\r\n| project \r\n        TimeGenerated,\r\n        AccountState,\r\n        ActorCallerType,\r\n        ActorEmail,\r\n        ActorIsCollaboratorAccount,\r\n        ActorKey,\r\n        ActorProfileId,\r\n        ApiKind,\r\n        AppName,\r\n        ApplicationEdition,\r\n        ApplicationName,\r\n        Billable,\r\n        CalendarId,\r\n        ClientId,\r\n        ClientType,\r\n        DestinationFolderId,\r\n        DestinationFolderTitle,\r\n        DocId,\r\n        DocTitle,\r\n        DocType,\r\n        DstUserUpn,\r\n        DestUserUpn,\r\n        DvcGuid,\r\n        DvcInterfaceGuid,\r\n        DvcModelName,\r\n        DvcModelNumber,\r\n        DvcType,\r\n        Etag,\r\n        EventCategoryType,\r\n        EventEndTime,\r\n        EventGuest,\r\n        EventId,\r\n        EventMessage,\r\n        EventOriginalMessage,\r\n        EventProduct,\r\n        EventResponseStatus,\r\n        EventStartTime,\r\n        EventTitle,\r\n        EventType,\r\n        EventUid,\r\n        EventVendor,\r\n        GroupDomain,\r\n        IdApplicationName,\r\n        IosVendorId,\r\n        IosVendorUID,\r\n        IsSecondFactor,\r\n        IsSuspicious,\r\n        Kind,\r\n        LastSyncAuditDate,\r\n        LoginChallengeMethod,\r\n        LoginChallengeStatus,\r\n        LoginType,\r\n        ModuleName,\r\n        NeqValue,\r\n        Newvalue,\r\n        NotificationMessageId,\r\n        NotificationMethod,\r\n        NotificationType,\r\n        OldEventTitle,\r\n        OldValue,\r\n        Oldvalue,\r\n        OldVisibility,\r\n        OrganizerCalendarId,\r\n        OriginatingAppId,\r\n        OsProperty,\r\n        Owner,\r\n        OwnerDomain,\r\n        OwnerIsSharedDrive,\r\n        OwnerIsTeamDrive,\r\n        PrimaryEvent,\r\n        ProcessName,\r\n        RegisterPrivelege,\r\n        ResourceId,\r\n        RoleName,\r\n        Scope,\r\n        ScopeData,\r\n        SerialNumber,\r\n        SharedDriveId,\r\n        SourceFolderId,\r\n        SourceFolderTitle,\r\n        SrcIpAddr,\r\n        TargetCalendarId,\r\n        TargetUserDomain,\r\n        TargetUserName,\r\n        TeamDriveId,\r\n        UserAadid,\r\n        UserAgentOriginal,\r\n        UserEmail,\r\n        Visibility,\r\n        VisibilityChange\r\n};\r\nGWorkspace_ReportsAPI_view",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "GoogleWorkspaceReports",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "tier": "Microsoft",
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "link": "https://support.microsoft.com/"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 1 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "GWorkspaceAdminPermissionsGranted_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Triggers on admin permissions granted.",
                "displayName": "GWorkspace - Admin permissions granted",
                "enabled": false,
                "query": "GWorkspaceActivityReports \n| where EventMessage =~ 'grant_admin_privilege'\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 2 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "GWorkspaceAlertEvents_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects alert events.",
                "displayName": "GWorkspace - Alert events",
                "enabled": false,
                "query": "GWorkspaceActivityReports\n| where EventType has \"ALERT_CENTER\"\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 3 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "GWorkspaceApiAccessToNewClient_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Triggers when API Access has been granted to a new client.",
                "displayName": "GWorkspace - API Access Granted",
                "enabled": false,
                "query": "GWorkspaceActivityReports\n| where EventMessage has \"AUTHORIZE_API_CLIENT_ACCESS\"\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "LateralMovement"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 4 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "GWorkspaceChangedUserAccess_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects user access change.",
                "displayName": "GWorkspace - User access has been changed",
                "enabled": false,
                "query": "GWorkspaceActivityReports\n| where EventMessage has \"change_user_access\"\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 5 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName5'),'/',variables('analyticRuleVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "GWorkspaceDifferentUAsFromSingleIP_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects requests with different user agents from one source in short timeframe.",
                "displayName": "GWorkspace - Multiple user agents for single source",
                "enabled": false,
                "query": "let threshold = 5;\nGWorkspaceActivityReports\n| where isnotempty(UserAgentOriginal)\n| summarize user_ua = makeset(UserAgentOriginal) by SrcIpAddr, bin(TimeGenerated, 5m)\n| where array_length(user_ua) > threshold\n| extend IPCustomEntity = SrcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "Persistence",
                  "Collection"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 6 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName6'),'/',variables('analyticRuleVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "GWorkspaceOutboundRelayAddedToSuiteDomain_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects outbound relays may be added to collect email.",
                "displayName": "GWorkspace - An Outbound Relay has been added to a G Suite Domain",
                "enabled": false,
                "query": "GWorkspaceActivityReports\n| where EventMessage has \"TOGGLE_OUTBOUND_RELAY\"\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "Collection"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 7 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName7'),'/',variables('analyticRuleVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "GWorkspacePossibleBruteForce_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId7')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible brute force attack.",
                "displayName": "GWorkspace - Possible brute force attack",
                "enabled": false,
                "query": "let threshold = 5;\nGWorkspaceActivityReports\n| where EventMessage has \"login_failure\"\n| summarize login_attempts = count() by ActorEmail, bin(TimeGenerated, 5m)\n| where login_attempts > threshold\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId7'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 7",
                "parentId": "[variables('analyticRuleId7')]",
                "contentId": "[variables('_analyticRulecontentId7')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 8 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName8'),'/',variables('analyticRuleVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "GWorkspacePossibleMaldocFileNamesInGDRIVE_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId8')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects possible maldoc file name in Google drive.",
                "displayName": "GWorkspace - Possible maldoc file name in Google drive",
                "enabled": false,
                "query": "GWorkspaceActivityReports\n| where isnotempty(DocTitle)\n| where DocTitle contains \"invoice\" or DocTitle contains \"payment\" or DocTitle contains \"order\" or DocTitle contains \"fax\" or DocTitle contains \"scan\" or DocTitle contains \"transfer\" or DocTitle contains \"report\" or DocTitle contains \"bill\"\n| extend FileCustomEntity = DocTitle, AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "FileCustomEntity"
                      }
                    ],
                    "entityType": "File"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId8'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 8",
                "parentId": "[variables('analyticRuleId8')]",
                "contentId": "[variables('_analyticRulecontentId8')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 9 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName9'),'/',variables('analyticRuleVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "GWorkspaceTwoStepAuthenticationDisabledForUser_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId9')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Triggers on two-step authentification disabled for a user.",
                "displayName": "GWorkspace - Two-step authentification disabled for a user",
                "enabled": false,
                "query": "GWorkspaceActivityReports \n| where EventMessage =~ 'TURN_OFF_2_STEP_VERIFICATION'\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId9'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 9",
                "parentId": "[variables('analyticRuleId9')]",
                "contentId": "[variables('_analyticRulecontentId9')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Analytics Rule 10 with template",
        "displayName": "GoogleWorkspaceReports Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName10'),'/',variables('analyticRuleVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "GWorkspaceUnexpectedOSUpdate_AnalyticalRules Analytics Rule with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId10')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects unexpected OS update.",
                "displayName": "GWorkspace - Unexpected OS update",
                "enabled": false,
                "query": "GWorkspaceActivityReports\n| where EventMessage has \"os_updated\"\n| where isnotempty(NeqValue) and isnotempty(OldValue)\n| extend NewVersion1 = extract(@'([0-9]+)\\.([0-9]+)\\.?([0-9])?', 1, NeqValue)\n| extend NewVersion2 = extract(@'([0-9]+)\\.([0-9]+)\\.?([0-9])?', 2, NeqValue)\n| extend NewVersion3 = extract(@'([0-9]+)\\.([0-9]+)\\.?([0-9])?', 3, NeqValue)\n| extend OldVersion1 = extract(@'([0-9]+)\\.([0-9]+)\\.?([0-9])?', 1, OldValue)\n| extend OldVersion2 = extract(@'([0-9]+)\\.([0-9]+)\\.?([0-9])?', 2, OldValue)\n| extend OldVersion3 = extract(@'([0-9]+)\\.([0-9]+)\\.?([0-9])?', 3, OldValue)\n| extend NewVersion3Comparision = iff(isempty(NewVersion3), 0, tolong(NewVersion3))\n| extend OldVersion3Comparision = iff(isempty(OldVersion3), 0, tolong(OldVersion3))\n| extend Comparision1 = iff(tolong(NewVersion3Comparision) > tolong(OldVersion3Comparision), 'Expected version', 'Unexpected version')\n| extend Comparision2 = iff(tolong(NewVersion2) > tolong(OldVersion2), 'Expected version', Comparision1)\n| extend VersionCheck = iff(tolong(NewVersion1) > tolong(OldVersion1), 'Expected version', Comparision2)\n| project-away NewVersion1, NewVersion2, NewVersion3, NewVersion3Comparision, OldVersion1, OldVersion2, OldVersion3, OldVersion3Comparision, Comparision1, Comparision2\n| extend AccountCustomEntity = ActorEmail\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "GoogleWorkspaceReportsAPI",
                    "dataTypes": [
                      "GWorkspaceActivityReports"
                    ]
                  }
                ],
                "tactics": [
                  "PrivilegeEscalation"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "AccountCustomEntity"
                      }
                    ],
                    "entityType": "Account"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId10'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Analytics Rule 10",
                "parentId": "[variables('analyticRuleId10')]",
                "contentId": "[variables('_analyticRulecontentId10')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "GoogleWorkspaceReports data connector with template",
        "displayName": "GoogleWorkspaceReports template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "GoogleWorkspaceReports data connector with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Google Workspace (G Suite) (using Azure Function)",
                  "publisher": "Google",
                  "descriptionMarkdown": "The [Google Workspace](https://workspace.google.com/) data connector provides the capability to ingest Google Workspace Activity events into Microsoft Sentinel through the REST API. The connector provides ability to get [events](https://developers.google.com/admin-sdk/reports/v1/reference/activities) which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems, track who signs in and when, analyze administrator activity, understand how users create and share content, and more review events in your org.",
                  "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. ​Follow the steps to use this Kusto functions alias **GWorkspaceActivityReports** in queries and workbooks [Follow steps to get this Kusto functions>](https://aka.ms/sentinel-GWorkspaceReportsAPI-parser)",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_admin_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_admin_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_calendar_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_calendar_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_drive_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_drive_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_login_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_login_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_mobile_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_mobile_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_token_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_token_CL"
                    },
                    {
                      "metricName": "Total data received",
                      "legend": "GWorkspace_ReportsAPI_user_accounts_CL",
                      "baseQuery": "GWorkspace_ReportsAPI_user_accounts_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Google Workspace Events - All Activities",
                      "query": "GWorkspaceActivityReports\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - Admin Activity",
                      "query": "GWorkspace_ReportsAPI_admin_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - Calendar Activity",
                      "query": "GWorkspace_ReportsAPI_calendar_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - Drive Activity",
                      "query": "GWorkspace_ReportsAPI_drive_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - Login Activity",
                      "query": "GWorkspace_ReportsAPI_login_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - Mobile Activity",
                      "query": "GWorkspace_ReportsAPI_mobile_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - Token Activity",
                      "query": "GWorkspace_ReportsAPI_token_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Google Workspace Events - User Accounts Activity",
                      "query": "GWorkspace_ReportsAPI_user_accounts_CL\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "GWorkspace_ReportsAPI_admin_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_admin_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "GWorkspace_ReportsAPI_calendar_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_calendar_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "GWorkspace_ReportsAPI_drive_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_drive_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "GWorkspace_ReportsAPI_login_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_login_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "GWorkspace_ReportsAPI_mobile_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_mobile_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "GWorkspace_ReportsAPI_token_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_token_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "GWorkspace_ReportsAPI_user_accounts_CL",
                      "lastDataReceivedQuery": "GWorkspace_ReportsAPI_user_accounts_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "GWorkspace_ReportsAPI_admin_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "GWorkspace_ReportsAPI_calendar_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "GWorkspace_ReportsAPI_drive_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "GWorkspace_ReportsAPI_login_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "GWorkspace_ReportsAPI_mobile_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "GWorkspace_ReportsAPI_token_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "GWorkspace_ReportsAPI_user_accounts_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "REST API Credentials/permissions",
                        "description": "**GooglePickleString** is required for REST API. [See the documentation to learn more about API](https://developers.google.com/admin-sdk/reports/v1/reference/activities). Please find the instructions to obtain the credentials in the configuration section below. You can check all [requirements and follow the instructions](https://developers.google.com/admin-sdk/reports/v1/quickstart/python) from here as well."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the Google Reports API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected. [Follow these steps](https://aka.ms/sentinel-GWorkspaceReportsAPI-parser) to create the Kusto functions alias, **GWorkspaceActivityReports**"
                    },
                    {
                      "description": "**STEP 1 - Ensure the prerequisites to obtain the Google Pickel String**\n\n"
                    },
                    {
                      "description": "1. [Python 3 or above](https://www.python.org/downloads/) is installed.\n2. The [pip package management tool](https://www.geeksforgeeks.org/download-and-install-pip-latest-version/) is available.\n3. A Google Workspace domain with [API access enabled](https://support.google.com/a/answer/7281227?visit_id=637889155425319296-3895555646&rd=1).\n4. A Google account in that domain with administrator privileges."
                    },
                    {
                      "description": "**STEP 2 - Configuration steps for the Google Reports API**\n\n 1. In Google Workspace, create a project if one does not already exists.\n 2. From ***APIs & Services*** -> ***Enabled APIs & Services***, enable **Admin SDK API** for this project.\n 3. Go to ***APIs & Services*** -> ***OAuth Consent Screen***. If not already configured, create a OAuth Consent Screen with the following steps:\n\t 1. Provide App Name and other mandatory information.\n\t 2. Add authorized domains with API Access Enabled.\n\t 3. In Scopes section, add **Admin SDK API** scope.\n\t 4. In Test Users section, make sure the domain admin account is added.\n 4. Go to ***APIs & Services*** -> ***Credentials*** and create OAuth 2.0 Client ID\n\t 1. Click on Create Credentials on the top and select Oauth client Id.\n\t 2. Select Web Application from the Application Type drop down.\n\t 3. Provide a suitable name to the Web App and add http://localhost:8081/ as one of the Authorized redirect URIs.\n\t 4. Once you click Create, download the JSON from the pop-up that appears. Rename this file to \"**credentials.json**\".\n 5. To fetch Google Pickel String, run the [python script](https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/GoogleWorkspaceReports/Data%20Connectors/get_google_pickle_string.py) from the same folder where credentials.json is saved.\n\t 1. When popped up for sign-in, use the domain admin account credentials to login.\n>**Note:** This script is supported only on Windows operating system.\n 6. From the output of the previous step, copy Google Pickle String (contained within single quotation marks) and keep it handy. It will be needed on Function App deployment step."
                    },
                    {
                      "description": "**STEP 3 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Workspace data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as the Workspace GooglePickleString readily available.",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Use this method for automated deployment of the Google Workspace data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinelgworkspaceazuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace ID**, **Workspace Key**, **GooglePickleString** and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the Google Workspace data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-GWorkspaceReportsAPI-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. GWorkspaceXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.8.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                    },
                    {
                      "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select ** New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tGooglePickleString\n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tlogAnalyticsUri (optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`. \n4. Once all application settings have been entered, click **Save**."
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "GoogleWorkspaceReports",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "tier": "Microsoft",
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "link": "https://support.microsoft.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Google Workspace (G Suite) (using Azure Function)",
          "publisher": "Google",
          "descriptionMarkdown": "The [Google Workspace](https://workspace.google.com/) data connector provides the capability to ingest Google Workspace Activity events into Microsoft Sentinel through the REST API. The connector provides ability to get [events](https://developers.google.com/admin-sdk/reports/v1/reference/activities) which helps to examine potential security risks, analyze your team's use of collaboration, diagnose configuration problems, track who signs in and when, analyze administrator activity, understand how users create and share content, and more review events in your org.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_admin_CL",
              "baseQuery": "GWorkspace_ReportsAPI_admin_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_calendar_CL",
              "baseQuery": "GWorkspace_ReportsAPI_calendar_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_drive_CL",
              "baseQuery": "GWorkspace_ReportsAPI_drive_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_login_CL",
              "baseQuery": "GWorkspace_ReportsAPI_login_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_mobile_CL",
              "baseQuery": "GWorkspace_ReportsAPI_mobile_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_token_CL",
              "baseQuery": "GWorkspace_ReportsAPI_token_CL"
            },
            {
              "metricName": "Total data received",
              "legend": "GWorkspace_ReportsAPI_user_accounts_CL",
              "baseQuery": "GWorkspace_ReportsAPI_user_accounts_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "GWorkspace_ReportsAPI_admin_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_admin_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "GWorkspace_ReportsAPI_calendar_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_calendar_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "GWorkspace_ReportsAPI_drive_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_drive_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "GWorkspace_ReportsAPI_login_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_login_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "GWorkspace_ReportsAPI_mobile_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_mobile_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "GWorkspace_ReportsAPI_token_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_token_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "GWorkspace_ReportsAPI_user_accounts_CL",
              "lastDataReceivedQuery": "GWorkspace_ReportsAPI_user_accounts_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "GWorkspace_ReportsAPI_admin_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "GWorkspace_ReportsAPI_calendar_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "GWorkspace_ReportsAPI_drive_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "GWorkspace_ReportsAPI_login_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "GWorkspace_ReportsAPI_mobile_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "GWorkspace_ReportsAPI_token_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "GWorkspace_ReportsAPI_user_accounts_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Google Workspace Events - All Activities",
              "query": "GWorkspaceActivityReports\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - Admin Activity",
              "query": "GWorkspace_ReportsAPI_admin_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - Calendar Activity",
              "query": "GWorkspace_ReportsAPI_calendar_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - Drive Activity",
              "query": "GWorkspace_ReportsAPI_drive_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - Login Activity",
              "query": "GWorkspace_ReportsAPI_login_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - Mobile Activity",
              "query": "GWorkspace_ReportsAPI_mobile_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - Token Activity",
              "query": "GWorkspace_ReportsAPI_token_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "Google Workspace Events - User Accounts Activity",
              "query": "GWorkspace_ReportsAPI_user_accounts_CL\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "REST API Credentials/permissions",
                "description": "**GooglePickleString** is required for REST API. [See the documentation to learn more about API](https://developers.google.com/admin-sdk/reports/v1/reference/activities). Please find the instructions to obtain the credentials in the configuration section below. You can check all [requirements and follow the instructions](https://developers.google.com/admin-sdk/reports/v1/quickstart/python) from here as well."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the Google Reports API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected. [Follow these steps](https://aka.ms/sentinel-GWorkspaceReportsAPI-parser) to create the Kusto functions alias, **GWorkspaceActivityReports**"
            },
            {
              "description": "**STEP 1 - Ensure the prerequisites to obtain the Google Pickel String**\n\n"
            },
            {
              "description": "1. [Python 3 or above](https://www.python.org/downloads/) is installed.\n2. The [pip package management tool](https://www.geeksforgeeks.org/download-and-install-pip-latest-version/) is available.\n3. A Google Workspace domain with [API access enabled](https://support.google.com/a/answer/7281227?visit_id=637889155425319296-3895555646&rd=1).\n4. A Google account in that domain with administrator privileges."
            },
            {
              "description": "**STEP 2 - Configuration steps for the Google Reports API**\n\n 1. In Google Workspace, create a project if one does not already exists.\n 2. From ***APIs & Services*** -> ***Enabled APIs & Services***, enable **Admin SDK API** for this project.\n 3. Go to ***APIs & Services*** -> ***OAuth Consent Screen***. If not already configured, create a OAuth Consent Screen with the following steps:\n\t 1. Provide App Name and other mandatory information.\n\t 2. Add authorized domains with API Access Enabled.\n\t 3. In Scopes section, add **Admin SDK API** scope.\n\t 4. In Test Users section, make sure the domain admin account is added.\n 4. Go to ***APIs & Services*** -> ***Credentials*** and create OAuth 2.0 Client ID\n\t 1. Click on Create Credentials on the top and select Oauth client Id.\n\t 2. Select Web Application from the Application Type drop down.\n\t 3. Provide a suitable name to the Web App and add http://localhost:8081/ as one of the Authorized redirect URIs.\n\t 4. Once you click Create, download the JSON from the pop-up that appears. Rename this file to \"**credentials.json**\".\n 5. To fetch Google Pickel String, run the [python script](https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/GoogleWorkspaceReports/Data%20Connectors/get_google_pickle_string.py) from the same folder where credentials.json is saved.\n\t 1. When popped up for sign-in, use the domain admin account credentials to login.\n>**Note:** This script is supported only on Windows operating system.\n 6. From the output of the previous step, copy Google Pickle String (contained within single quotation marks) and keep it handy. It will be needed on Function App deployment step."
            },
            {
              "description": "**STEP 3 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the Workspace data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following), as well as the Workspace GooglePickleString readily available.",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Use this method for automated deployment of the Google Workspace data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinelgworkspaceazuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace ID**, **Workspace Key**, **GooglePickleString** and deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the Google Workspace data connector manually with Azure Functions (Deployment via Visual Studio Code).",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-GWorkspaceReportsAPI-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. GWorkspaceXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.8.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
            },
            {
              "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select ** New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tGooglePickleString\n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tlogAnalyticsUri (optional)\n - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`. \n4. Once all application settings have been entered, click **Save**."
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. ​Follow the steps to use this Kusto functions alias **GWorkspaceActivityReports** in queries and workbooks [Follow steps to get this Kusto functions>](https://aka.ms/sentinel-GWorkspaceReportsAPI-parser)"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 1 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName1'),'/',variables('huntingQueryVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "GWorkspaceDocumentSharedExternally_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Document shared externally",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports \n| where TimeGenerated > ago(24h)\n| where EventType =~ 'acl_change'\n| where Visibility =~ 'shared_externally'\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches document shared externally."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1048,T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId1'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 1",
                "parentId": "[variables('huntingQueryId1')]",
                "contentId": "[variables('_huntingQuerycontentId1')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 2 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName2'),'/',variables('huntingQueryVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "GWorkspaceDocumentSharedPublicily_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Document shared publicy in web",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where Visibility has \"public_on_the_web\"\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches document shared publicy  in web."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1048,T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId2'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 2",
                "parentId": "[variables('huntingQueryId2')]",
                "contentId": "[variables('_huntingQuerycontentId2')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 3 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName3'),'/',variables('huntingQueryVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "GWorkspaceDocumentSharedPublicilyWithLink_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Document shared publicy with link",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports \n| where TimeGenerated > ago(24h)\n| where EventType =~ 'acl_change'\n| where Visibility =~ 'people_with_link'\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches document shared publicy with link."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1048,T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId3'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 3",
                "parentId": "[variables('huntingQueryId3')]",
                "contentId": "[variables('_huntingQuerycontentId3')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 4 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName4'),'/',variables('huntingQueryVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "GWorkspaceMultiIPAddresses_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Multi IP addresses by user",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where isnotempty(SrcIpAddr)\n| summarize UserIP = make_set(SrcIpAddr) by ActorEmail\n| where array_length(UserIP) > 3\n| extend IPCustomEntity = UserIP\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches users with multi IP addresses."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId4'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 4",
                "parentId": "[variables('huntingQueryId4')]",
                "contentId": "[variables('_huntingQuerycontentId4')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 5 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName5'),'/',variables('huntingQueryVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "GWorkspacePossibleSCAMSPAMorPhishingCalendar_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Possible SCAM/SPAM or Phishing via Calendar",
                "category": "Hunting Queries",
                "query": "let OwnDomains = \nGWorkspaceActivityReports\n| where TimeGenerated > ago(30d)\n| where isnotempty(OwnerDomain) \n| summarize domain_lst = make_set(OwnerDomain);\nGWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where isnotempty(OrganizerCalendarId) \n| extend UserDomain = extract(@\"([a-zA-Z0-9.-_]+)@([a-zA-Z0-9.-]+)\",2,OrganizerCalendarId)\n| where UserDomain !in~ (OwnDomains)\n| where ActorCallerType has \"EXTERNAL_USER\"\n| extend AccountCustomEntity = OrganizerCalendarId\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches possible SCAM/SPAM or phishing via calendar."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1566"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId5'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 5",
                "parentId": "[variables('huntingQueryId5')]",
                "contentId": "[variables('_huntingQuerycontentId5')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 6 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName6'),'/',variables('huntingQueryVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "GWorkspaceRareDocType_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Rare document types by users",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where isnotempty(DocType)\n| summarize users = makeset(ActorEmail), count() by DocType\n| top 20 by count_ asc \n| extend AccountCustomEntity = Users\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches rare document types by users."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1566"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId6'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 6",
                "parentId": "[variables('huntingQueryId6')]",
                "contentId": "[variables('_huntingQuerycontentId6')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 7 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName7'),'/',variables('huntingQueryVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "GWorkspaceSharedPrivateDocument_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Shared private document",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where OldVisibility has \"private\" and Visibility has \"shared\"\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches shared private document."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration,Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1048,T1565"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId7'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 7",
                "parentId": "[variables('huntingQueryId7')]",
                "contentId": "[variables('_huntingQuerycontentId7')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 8 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName8'),'/',variables('huntingQueryVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "GWorkspaceSuspendedUsers_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Suspended users",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where EventMessage has \"suspend\"\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches suspended users."
                  },
                  {
                    "name": "tactics",
                    "value": "Impact"
                  },
                  {
                    "name": "techniques",
                    "value": "T1531"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId8'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 8",
                "parentId": "[variables('huntingQueryId8')]",
                "contentId": "[variables('_huntingQuerycontentId8')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 9 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName9'),'/',variables('huntingQueryVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "GWorkspaceUncommonUAsString_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Uncommon user agent strings",
                "category": "Hunting Queries",
                "query": "let length = 10;\nGWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where isnotempty(UserAgentOriginal)\n| where strlen(UserAgentOriginal) < length\n| extend UrlCustomEntity = UserAgentOriginal, AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches uncommon user agent strings."
                  },
                  {
                    "name": "tactics",
                    "value": "Persistence,Collection"
                  },
                  {
                    "name": "techniques",
                    "value": "T1185,T1176"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId9'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 9",
                "parentId": "[variables('huntingQueryId9')]",
                "contentId": "[variables('_huntingQuerycontentId9')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 10 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName10'),'/',variables('huntingQueryVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "GWorkspaceUnknownLoginType_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Unknown login type",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where EventType =~ \"login\"\n| where LoginType has \"unknown\"\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches unknown login type."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,DefenseEvasion,LateralMovement"
                  },
                  {
                    "name": "techniques",
                    "value": "T1550,T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId10'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 10",
                "parentId": "[variables('huntingQueryId10')]",
                "contentId": "[variables('_huntingQuerycontentId10')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 11 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName11'),'/',variables('huntingQueryVersion11'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName11'))]"
      ],
      "properties": {
        "description": "GWorkspaceUserReportedCalendarInviteAsSpam_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion11')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_11",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - User reported calendar invite as spam",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where EventResponseStatus has \"spam\"\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches calendar invites used to deliver spam. This query shows results when user reports a calander invite as spam."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1566"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId11'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 11",
                "parentId": "[variables('huntingQueryId11')]",
                "contentId": "[variables('_huntingQuerycontentId11')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion11')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName12')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "GoogleWorkspaceReports Hunting Query 12 with template",
        "displayName": "GoogleWorkspaceReports Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName12'),'/',variables('huntingQueryVersion12'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName12'))]"
      ],
      "properties": {
        "description": "GWorkspaceUserWithSeveralDevices_HuntingQueries Hunting Query with template version 2.0.2",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion12')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "GoogleWorkspaceReports_Hunting_Query_12",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "GWorkspace - Users with several devices",
                "category": "Hunting Queries",
                "query": "GWorkspaceActivityReports\n| where TimeGenerated > ago(24h)\n| where isnotempty(DvcModelName)\n| summarize UserDevices = make_set(DvcModelName) by ActorEmail\n| where array_length(UserDevices) >= 5\n| extend AccountCustomEntity = ActorEmail\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches users with several devices."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAcces"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId12'),'/'))))]",
              "properties": {
                "description": "GoogleWorkspaceReports Hunting Query 12",
                "parentId": "[variables('huntingQueryId12')]",
                "contentId": "[variables('_huntingQuerycontentId12')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion12')]",
                "source": {
                  "kind": "Solution",
                  "name": "GoogleWorkspaceReports",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.2",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "GoogleWorkspaceReports",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId7')]",
              "version": "[variables('analyticRuleVersion7')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId8')]",
              "version": "[variables('analyticRuleVersion8')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId9')]",
              "version": "[variables('analyticRuleVersion9')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId10')]",
              "version": "[variables('analyticRuleVersion10')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId1')]",
              "version": "[variables('huntingQueryVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId2')]",
              "version": "[variables('huntingQueryVersion2')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId3')]",
              "version": "[variables('huntingQueryVersion3')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId4')]",
              "version": "[variables('huntingQueryVersion4')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId5')]",
              "version": "[variables('huntingQueryVersion5')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId6')]",
              "version": "[variables('huntingQueryVersion6')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId7')]",
              "version": "[variables('huntingQueryVersion7')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId8')]",
              "version": "[variables('huntingQueryVersion8')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId9')]",
              "version": "[variables('huntingQueryVersion9')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId10')]",
              "version": "[variables('huntingQueryVersion10')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId11')]",
              "version": "[variables('huntingQueryVersion11')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId12')]",
              "version": "[variables('huntingQueryVersion12')]"
            }
          ]
        },
        "firstPublishDate": "2022-01-24",
        "providers": [
          "Google"
        ],
        "categories": {
          "domains": [
            "IT Operations",
            "Cloud Provider"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
