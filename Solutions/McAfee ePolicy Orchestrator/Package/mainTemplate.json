{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for McAfee ePolicy Orchestrator"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "McAfee ePolicy Orchestrator",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-mcafeeepo",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "parserVersion1": "1.0.0",
    "parserContentId1": "McAfeeEPOEvent-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "parserName1": "McAfeeePO Data Parser",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "analyticRuleVersion1": "1.0.0",
    "analyticRulecontentId1": "3c1425d3-93d4-4eaf-8aa0-370dbac94c82",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.0",
    "analyticRulecontentId2": "1e3bcd0f-10b2-4fbd-854f-1c6f33acc36a",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.0",
    "analyticRulecontentId3": "2eff5809-bf84-48e0-8288-768689672c37",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
    "analyticRuleVersion4": "1.0.0",
    "analyticRulecontentId4": "155243f4-d962-4717-8a7b-b15b6d112660",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
    "analyticRuleVersion5": "1.0.0",
    "analyticRulecontentId5": "b9d9fdfe-bc17-45ce-a70d-67a5cfd119f4",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5')))]",
    "analyticRuleVersion6": "1.0.0",
    "analyticRulecontentId6": "bd3cedc3-efba-455a-85bd-0cf9ac1b0727",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6')))]",
    "analyticRuleVersion7": "1.0.0",
    "analyticRulecontentId7": "0c9243d6-d2ec-48e1-8593-e713859c8f3c",
    "_analyticRulecontentId7": "[variables('analyticRulecontentId7')]",
    "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId7'))]",
    "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId7')))]",
    "analyticRuleVersion8": "1.0.0",
    "analyticRulecontentId8": "f53e5168-afdb-4fad-b29a-bb9cb71ec460",
    "_analyticRulecontentId8": "[variables('analyticRulecontentId8')]",
    "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId8'))]",
    "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId8')))]",
    "analyticRuleVersion9": "1.0.0",
    "analyticRulecontentId9": "5223c1b8-75ef-4019-9076-a19b1ef3e5d1",
    "_analyticRulecontentId9": "[variables('analyticRulecontentId9')]",
    "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId9'))]",
    "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId9')))]",
    "analyticRuleVersion10": "1.0.0",
    "analyticRulecontentId10": "ffc9052b-3658-4ad4-9003-0151515fde15",
    "_analyticRulecontentId10": "[variables('analyticRulecontentId10')]",
    "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId10'))]",
    "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId10')))]",
    "analyticRuleVersion11": "1.0.0",
    "analyticRulecontentId11": "3e397e31-7964-417e-a3e0-0acfaa2056f4",
    "_analyticRulecontentId11": "[variables('analyticRulecontentId11')]",
    "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId11'))]",
    "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId11')))]",
    "analyticRuleVersion12": "1.0.0",
    "analyticRulecontentId12": "6d70a26a-c119-45b7-b4c6-44ac4fd1bcb7",
    "_analyticRulecontentId12": "[variables('analyticRulecontentId12')]",
    "analyticRuleId12": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId12'))]",
    "analyticRuleTemplateSpecName12": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId12')))]",
    "analyticRuleVersion13": "1.0.0",
    "analyticRulecontentId13": "9860e89f-72c8-425e-bac9-4a170798d3ea",
    "_analyticRulecontentId13": "[variables('analyticRulecontentId13')]",
    "analyticRuleId13": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId13'))]",
    "analyticRuleTemplateSpecName13": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId13')))]",
    "analyticRuleVersion14": "1.0.0",
    "analyticRulecontentId14": "4f0c91c3-1690-48f0-b538-4282dd5417a4",
    "_analyticRulecontentId14": "[variables('analyticRulecontentId14')]",
    "analyticRuleId14": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId14'))]",
    "analyticRuleTemplateSpecName14": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId14')))]",
    "uiConfigId1": "McAfeeePO",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "McAfeeePO",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0",
    "huntingQueryVersion1": "1.0.0",
    "huntingQuerycontentId1": "dff3c841-6e3e-432e-ad68-3ddd7326bc01",
    "_huntingQuerycontentId1": "[variables('huntingQuerycontentId1')]",
    "huntingQueryId1": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId1'))]",
    "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId1')))]",
    "huntingQueryVersion2": "1.0.0",
    "huntingQuerycontentId2": "e838519b-1f03-417f-863b-6c1a141677ee",
    "_huntingQuerycontentId2": "[variables('huntingQuerycontentId2')]",
    "huntingQueryId2": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId2'))]",
    "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId2')))]",
    "huntingQueryVersion3": "1.0.0",
    "huntingQuerycontentId3": "851b63f1-cc5d-44d5-b505-9444a5e87076",
    "_huntingQuerycontentId3": "[variables('huntingQuerycontentId3')]",
    "huntingQueryId3": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId3'))]",
    "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId3')))]",
    "huntingQueryVersion4": "1.0.0",
    "huntingQuerycontentId4": "e83b72a0-60dd-4d65-b1c2-582766f2f181",
    "_huntingQuerycontentId4": "[variables('huntingQuerycontentId4')]",
    "huntingQueryId4": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId4'))]",
    "huntingQueryTemplateSpecName4": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId4')))]",
    "huntingQueryVersion5": "1.0.0",
    "huntingQuerycontentId5": "2e7a56fb-ffff-491c-bdee-e772f83c47e2",
    "_huntingQuerycontentId5": "[variables('huntingQuerycontentId5')]",
    "huntingQueryId5": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId5'))]",
    "huntingQueryTemplateSpecName5": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId5')))]",
    "huntingQueryVersion6": "1.0.0",
    "huntingQuerycontentId6": "a65e4129-d936-4165-bc08-699f9151aa26",
    "_huntingQuerycontentId6": "[variables('huntingQuerycontentId6')]",
    "huntingQueryId6": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId6'))]",
    "huntingQueryTemplateSpecName6": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId6')))]",
    "huntingQueryVersion7": "1.0.0",
    "huntingQuerycontentId7": "1ef23489-a840-4b43-b33d-a921da24c85c",
    "_huntingQuerycontentId7": "[variables('huntingQuerycontentId7')]",
    "huntingQueryId7": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId7'))]",
    "huntingQueryTemplateSpecName7": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId7')))]",
    "huntingQueryVersion8": "1.0.0",
    "huntingQuerycontentId8": "5be4adb7-52ee-4416-b39d-0c03cf0fb661",
    "_huntingQuerycontentId8": "[variables('huntingQuerycontentId8')]",
    "huntingQueryId8": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId8'))]",
    "huntingQueryTemplateSpecName8": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId8')))]",
    "huntingQueryVersion9": "1.0.0",
    "huntingQuerycontentId9": "901e6982-39ed-4759-9451-de1a3826182f",
    "_huntingQuerycontentId9": "[variables('huntingQuerycontentId9')]",
    "huntingQueryId9": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId9'))]",
    "huntingQueryTemplateSpecName9": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId9')))]",
    "huntingQueryVersion10": "1.0.0",
    "huntingQuerycontentId10": "80c5904d-6a36-4b7c-82d4-180023a1f8b4",
    "_huntingQuerycontentId10": "[variables('huntingQuerycontentId10')]",
    "huntingQueryId10": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId10'))]",
    "huntingQueryTemplateSpecName10": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId10')))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "McAfeeePOWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "McAfeeEPOEvent Data Parser with template",
        "displayName": "McAfeeEPOEvent Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "McAfeeEPOEvent Data Parser with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfeeePO Data Parser",
                "category": "Samples",
                "functionAlias": "McAfeeEPOEvent",
                "query": "\nlet mcafee_epoevent =() {\r\nSyslog\r\n| where SyslogMessage contains '<EPOevent>'\r\n    or ProcessName contains 'EPOEvents' //for EPO verion 5.10 at least, this is the format now\r\n| extend EventVendor = 'McAfee'\r\n| extend EventProduct = 'McAfee ePO'\r\n| extend DvcHostname = extract(@'\\<MachineName\\>(.*?)\\<\\/MachineName\\>', 1, SyslogMessage)\r\n| extend AgentGuid = extract(@'\\<AgentGUID\\>(.*?)\\<\\/AgentGUID\\>', 1, SyslogMessage)\r\n| extend DvcIpAddr = extract(@'\\<IPAddress\\>(.*?)\\<\\/IPAddress\\>', 1, SyslogMessage)\r\n| extend SrcDvcOs = extract(@'\\<OSName\\>(.*?)\\<\\/OSName\\>', 1, SyslogMessage)\r\n| extend DvcMacAddr = extract(@'\\<RawMACAddress\\>(.*?)\\<\\/RawMACAddress\\>', 1, SyslogMessage)\r\n| extend SrcUserName = extract(@'\\<UserName\\>(.*?)\\<\\/UserName\\>', 1, SyslogMessage)\r\n| extend TimeZoneBias = extract(@'\\<TimeZoneBias\\>(.*?)\\<\\/TimeZoneBias\\>', 1, SyslogMessage)\r\n| extend ProductName = extract(@'ProductName=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductFamily = extract(@'ProductFamily=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductVersion = extract(@'ProductVersion=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend Analyzer = extract(@'\\<Analyzer\\>(.*?)\\<\\/Analyzer\\>', 1, SyslogMessage)\r\n| extend AnalyzerName = extract(@'\\<AnalyzerName\\>(.*?)\\<\\/AnalyzerName\\>', 1, SyslogMessage)\r\n| extend AnalyzerVersion = extract(@'\\<AnalyzerVersion\\>(.*?)\\<\\/AnalyzerVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerHostName = extract(@'\\<AnalyzerHostName\\>(.*?)\\<\\/AnalyzerHostName\\>', 1, SyslogMessage)\r\n| extend AnalyzerDatVersion = extract(@'\\<AnalyzerDATVersion\\>(.*?)\\<\\/AnalyzerDATVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerEngineVersion = extract(@'\\<AnalyzerEngineVersion\\>(.*?)\\<\\/AnalyzerEngineVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerDetectionMethod = extract(@'\\<AnalyzerDetectionMethod\\>(.*?)\\<\\/AnalyzerDetectionMethod\\>', 1, SyslogMessage)\r\n| extend EventId = extract(@'\\<EventID\\>(.*?)\\<\\/EventID\\>', 1, SyslogMessage)\r\n| extend EventSeverity = extract(@'\\<Severity\\>(.*?)\\<\\/Severity\\>', 1, SyslogMessage)\r\n| extend EventSeverity = case(EventSeverity == 1, \"Warning\",\r\n                              EventSeverity == 2, \"Notice\",\r\n                              EventSeverity == 3, \"Alert\",\r\n                              EventSeverity == 4, \"Critical\",\r\n                              \"Information\")\r\n| extend GmtTime = todatetime(extract(@'\\<GMTTime\\>(.*?)\\<\\/GMTTime\\>', 1, SyslogMessage))\r\n| extend DetectedUtc = todatetime(extract(@'\\<DetectedUTC\\>(.*?)\\<\\/DetectedUTC\\>', 1, SyslogMessage))\r\n| extend ThreatName = extract(@'\\<ThreatName\\>(.*?)\\<\\/ThreatName\\>', 1, SyslogMessage)\r\n| extend ThreatType = extract(@'\\<ThreatType\\>(.*?)\\<\\/ThreatType\\>', 1, SyslogMessage)\r\n| extend ThreatCategory = extract(@'\\<ThreatCategory\\>(.*?)\\<\\/ThreatCategory\\>', 1, SyslogMessage)\r\n| extend ThreatId = extract(@'\\<ThreatEventID\\>(.*?)\\<\\/ThreatEventID\\>', 1, SyslogMessage)\r\n| extend ThreatHandled = extract(@'\\<ThreatHandled\\>(.*?)\\<\\/ThreatHandled\\>', 1, SyslogMessage)\r\n| extend ThreatActionTaken = extract(@'\\<ThreatActionTaken\\>(.*?)\\<\\/ThreatActionTaken\\>', 1, SyslogMessage)\r\n| extend ThreatSeverity = extract(@'\\<ThreatSeverity\\>(.*?)\\<\\/ThreatSeverity\\>', 1, SyslogMessage)\r\n| extend SrcUserUpn = extract(@'\\<SourceUserName\\>(.*?)\\<\\/SourceUserName\\>', 1, SyslogMessage)\r\n| extend SrcProcessName = extract(@'\\<SourceProcessName\\>(.*?)\\<\\/SourceProcessName\\>', 1, SyslogMessage)\r\n| extend DstDvcHostname = extract(@'\\<TargetHostName\\>(.*?)\\<\\/TargetHostName\\>', 1, SyslogMessage)\r\n| extend DstUserName = extract(@'\\<TargetUserName\\>(.*?)\\<\\/TargetUserName\\>', 1, SyslogMessage)\r\n| extend TargetProcessName = extract(@'\\<TargetProcessName\\>(.*?)\\<\\/TargetProcessName\\>', 1, SyslogMessage)\r\n| extend DstFileName = extract(@'\\<TargetFileName\\>(.*?)\\<\\/TargetFileName\\>', 1, SyslogMessage)\r\n| extend Target = extract(@'\\<CustomFields target=\\\"(.*?)\\\"\\>', 1, SyslogMessage)\r\n| extend BladeName = extract(@'\\<BladeName\\>(.*?)\\<\\/BladeName\\>', 1, SyslogMessage)\r\n| extend AnalyzerContentVersion = extract(@'\\<AnalyzerContentVersion\\>(.*?)\\<\\/AnalyzerContentVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerContentCreationDate = todatetime(extract(@'\\<AnalyzerContentCreationDate\\>(.*?)\\<\\/AnalyzerContentCreationDate\\>', 1, SyslogMessage))\r\n| extend AnalyzerRuleName = extract(@'\\<AnalyzerRuleName\\>(.*?)\\<\\/AnalyzerRuleName\\>', 1, SyslogMessage)\r\n| extend AnalyzerRuleId = extract(@'\\<AnalyzerRuleID\\>(.*?)\\<\\/AnalyzerRuleID\\>', 1, SyslogMessage)\r\n| extend AnalyzerGtiQuery = extract(@'\\<AnalyzerGTIQuery\\>(.*?)\\<\\/AnalyzerGTIQuery\\>', 1, SyslogMessage)\r\n| extend ThreatDetectedOnCreation = extract(@'\\<ThreatDetectedOnCreation\\>(.*?)\\<\\/ThreatDetectedOnCreation\\>', 1, SyslogMessage)\r\n| extend DstFileSize = extract(@'\\<TargetFileSize\\>(.*?)\\<\\/TargetFileSize\\>', 1, SyslogMessage)\r\n| extend DstFileModifiedTime = extract(@'\\<TargetModifyTime\\>(.*?)\\<\\/TargetModifyTime\\>', 1, SyslogMessage)\r\n| extend DstFileAccessedTime = extract(@'\\<TargetAccessTime\\>(.*?)\\<\\/TargetAccessTime\\>', 1, SyslogMessage)\r\n| extend DstFileCreationTime = extract(@'\\<TargetCreateTime\\>(.*?)\\<\\/TargetCreateTime\\>', 1, SyslogMessage)\r\n| extend Cleanable = extract(@'\\<Cleanable\\>(.*?)\\<\\/Cleanable\\>', 1, SyslogMessage)\r\n| extend TaskName = extract(@'\\<TaskName\\>(.*?)\\<\\/TaskName\\>', 1, SyslogMessage)\r\n| extend FirstAttemptedAction = extract(@'\\<FirstAttemptedAction\\>(.*?)\\<\\/FirstAttemptedAction\\>', 1, SyslogMessage)\r\n| extend FirstActionStatus = extract(@'\\<FirstActionStatus\\>(.*?)\\<\\/FirstActionStatus\\>', 1, SyslogMessage)\r\n| extend SecondAttemptedAction = extract(@'\\<SecondAttemptedAction\\>(.*?)\\<\\/SecondAttemptedAction\\>', 1, SyslogMessage)\r\n| extend SecondActionStatus = extract(@'\\<SecondActionStatus\\>(.*?)\\<\\/SecondActionStatus\\>', 1, SyslogMessage)\r\n| extend ApiName = extract(@'\\<APIName\\>(.*?)\\<\\/APIName\\>', 1, SyslogMessage)\r\n| extend SourceDescription = extract(@'\\<SourceDescription\\>(.*?)\\<\\/SourceDescription\\>', 1, SyslogMessage)\r\n| extend SrcProcessId = extract(@'\\<SourceProcessID\\>(.*?)\\<\\/SourceProcessID\\>', 1, SyslogMessage)\r\n| extend SrcProcessHashMd5 = extract(@'\\<SourceProcessHash\\>([a-fA-F0-9]{32})\\<', 1, SyslogMessage)\r\n| extend AttackVectorType = extract(@'\\<AttackVectorType\\>(.*?)\\<\\/AttackVectorType\\>', 1, SyslogMessage)\r\n| extend DurationBeforeDetection = extract(@'\\<DurationBeforeDetection\\>(.*?)\\<\\/DurationBeforeDetection\\>', 1, SyslogMessage)\r\n| extend NaturalLangDescription = extract(@'\\<NaturalLangDescription\\>(.*?)\\<\\/NaturalLangDescription\\>', 1, SyslogMessage)\r\n| extend AccessRequested = extract(@'\\<AccessRequested\\>(.*?)\\</\\AccessRequested\\>', 1, SyslogMessage)\r\n| extend DetectionMessage = extract(@'\\<DetectionMessage\\>(.*?)\\</\\DetectionMessage\\>', 1, SyslogMessage)\r\n| extend AmCoreContentVersion = extract(@'\\<AMCoreContentVersion\\>(.*?)\\</\\AMCoreContentVersion\\>', 1, SyslogMessage)\r\n| extend SrcIpAddr = extract(@'\\<SourceIPV4\\>(.*?)\\<\\/SourceIPV4\\>', 1, SyslogMessage)\r\n| extend SrcMacAddr = extract(@'\\<SourceMAC\\>(.*?)\\<\\/SourceMAC\\>', 1, SyslogMessage)\r\n| extend DstIpAddr = extract(@'\\<TargetIPV4\\>(.*?)\\<\\/TargetIPV4\\>', 1, SyslogMessage)\r\n| extend DstMacAddr = extract(@'\\<TargetMAC\\>(.*?)\\<\\/TargetMAC\\>', 1, SyslogMessage)\r\n};\r\nlet mcafee_updateevent =() {\r\nSyslog\r\n| where SyslogMessage contains '<UpdateEvents>'\r\n| extend EventVendor = 'McAfee'\r\n| extend EventProduct = 'McAfee ePO'\r\n| extend AgentGuid = extract(@'\\<AgentGUID\\>(.*?)\\<\\/AgentGUID\\>', 1, SyslogMessage)\r\n| extend DvcHostname = extract(@'\\<MachineName\\>(.*?)\\<\\/MachineName\\>', 1, SyslogMessage)\r\n| extend DvcMacAddr = extract(@'\\<RawMACAddress\\>(.*?)\\<\\/RawMACAddress\\>', 1, SyslogMessage)\r\n| extend DvcIpAddr = extract(@'\\<IPAddress\\>(.*?)\\<\\/IPAddress\\>', 1, SyslogMessage)\r\n| extend AgentVersion = extract(@'\\<AgentVersion\\>(.*?)\\<\\/AgentVersion\\>', 1, SyslogMessage)\r\n| extend SrcUserName = extract(@'\\<UserName\\>(.*?)\\<\\/UserName\\>', 1, SyslogMessage)\r\n| extend TimeZoneBias = extract(@'\\<TimeZoneBias\\>(.*?)\\<\\/TimeZoneBias\\>', 1, SyslogMessage)\r\n| extend ProductName = extract(@'ProductName=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductFamily = extract(@'ProductFamily=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductVersion = extract(@'ProductVersion=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend EventId = extract(@'\\<EventID\\>(.*?)\\<\\/EventID\\>', 1, SyslogMessage)\r\n| extend EventSeverity = extract(@'\\<Severity\\>(.*?)\\<\\/Severity\\>', 1, SyslogMessage)\r\n| extend EventSeverity = case(EventSeverity == 1, \"Warning\",\r\n                              EventSeverity == 2, \"Notice\",\r\n                              EventSeverity == 3, \"Alert\",\r\n                              EventSeverity == 4, \"Critical\",\r\n                              \"Information\")\r\n| extend GmtTime = todatetime(extract(@'\\<GMTTime\\>(.*?)\\<\\/GMTTime\\>', 1, SyslogMessage))\r\n| extend ProductId = extract(@'\\<ProductID\\>(.*?)\\<\\/ProductID\\>', 1, SyslogMessage)\r\n| extend Locale = extract(@'\\<Locale\\>(.*?)\\<\\/Locale\\>', 1, SyslogMessage)\r\n| extend Error = extract(@'\\<Error\\>(.*?)\\<\\/Error\\>', 1, SyslogMessage)\r\n| extend Type = extract(@'\\<Type\\>(.*?)\\<\\/Type\\>', 1, SyslogMessage)\r\n| extend Version = extract(@'\\<Version\\>(.*?)\\<\\/Version\\>', 1, SyslogMessage)\r\n| extend InitiatorId = extract(@'\\<InitiatorID\\>(.*?)\\<\\/InitiatorID\\>', 1, SyslogMessage)\r\n| extend InitiatorType = extract(@'\\<InitiatorType\\>(.*?)\\<\\/InitiatorType\\>', 1, SyslogMessage)\r\n| extend SiteName = extract(@'\\<SiteName\\>(.*?)\\<\\/SiteName\\>', 1, SyslogMessage)\r\n| extend Description = extract(@'\\<Description\\>(.*?)\\<\\/Description\\>', 1, SyslogMessage)\r\n};\r\nunion isfuzzy=true mcafee_epoevent, mcafee_updateevent\r\n| project TimeGenerated\r\n        , GmtTime\r\n        , EventVendor\r\n        , EventProduct\r\n        , EventId\r\n        , EventSeverity\r\n        , AgentGuid\r\n        , DvcHostname\r\n        , DvcIpAddr\r\n        , DvcMacAddr\r\n        , AgentVersion\r\n        , SrcDvcOs\r\n        , SrcUserName\r\n        , TimeZoneBias\r\n        , ProductName\r\n        , ProductFamily\r\n        , ProductVersion\r\n        , Analyzer\r\n        , AnalyzerName\r\n        , AnalyzerVersion\r\n        , AnalyzerHostName\r\n        , AnalyzerDatVersion\r\n        , AnalyzerEngineVersion\r\n        , AnalyzerDetectionMethod\r\n        , ThreatName\r\n        , ThreatType\r\n        , ThreatCategory\r\n        , ThreatId\r\n        , ThreatHandled\r\n        , ThreatActionTaken\r\n        , ThreatSeverity\r\n        , SrcUserUpn\r\n        , SrcProcessName\r\n        , DstDvcHostname\r\n        , DstUserName\r\n        , TargetProcessName\r\n        , DstFileName\r\n        , Target\r\n        , BladeName\r\n        , AnalyzerContentVersion\r\n        , AnalyzerContentCreationDate\r\n        , AnalyzerRuleName\r\n        , AnalyzerRuleId\r\n        , AnalyzerGtiQuery\r\n        , ThreatDetectedOnCreation\r\n        , DstFileSize\r\n        , DstFileModifiedTime\r\n        , DstFileAccessedTime\r\n        , DstFileCreationTime\r\n        , Cleanable\r\n        , TaskName\r\n        , FirstAttemptedAction\r\n        , FirstActionStatus\r\n        , SecondAttemptedAction\r\n        , SecondActionStatus\r\n        , ApiName\r\n        , SourceDescription\r\n        , SrcProcessId\r\n        , SrcProcessHashMd5\r\n        , AttackVectorType\r\n        , DurationBeforeDetection\r\n        , AccessRequested\r\n        , DetectionMessage\r\n        , AmCoreContentVersion\r\n        , SrcIpAddr\r\n        , SrcMacAddr\r\n        , DstIpAddr\r\n        , DstMacAddr\r\n        , ProductId\r\n        , Locale\r\n        , Error\r\n        , Type\r\n        , Version\r\n        , InitiatorId\r\n        , InitiatorType\r\n        , SiteName\r\n        , Description\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "McAfeeePO Data Parser"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "McAfee ePolicy Orchestrator",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2021-06-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "McAfeeePO Data Parser",
        "category": "Samples",
        "functionAlias": "McAfeeEPOEvent",
        "query": "\nlet mcafee_epoevent =() {\r\nSyslog\r\n| where SyslogMessage contains '<EPOevent>'\r\n    or ProcessName contains 'EPOEvents' //for EPO verion 5.10 at least, this is the format now\r\n| extend EventVendor = 'McAfee'\r\n| extend EventProduct = 'McAfee ePO'\r\n| extend DvcHostname = extract(@'\\<MachineName\\>(.*?)\\<\\/MachineName\\>', 1, SyslogMessage)\r\n| extend AgentGuid = extract(@'\\<AgentGUID\\>(.*?)\\<\\/AgentGUID\\>', 1, SyslogMessage)\r\n| extend DvcIpAddr = extract(@'\\<IPAddress\\>(.*?)\\<\\/IPAddress\\>', 1, SyslogMessage)\r\n| extend SrcDvcOs = extract(@'\\<OSName\\>(.*?)\\<\\/OSName\\>', 1, SyslogMessage)\r\n| extend DvcMacAddr = extract(@'\\<RawMACAddress\\>(.*?)\\<\\/RawMACAddress\\>', 1, SyslogMessage)\r\n| extend SrcUserName = extract(@'\\<UserName\\>(.*?)\\<\\/UserName\\>', 1, SyslogMessage)\r\n| extend TimeZoneBias = extract(@'\\<TimeZoneBias\\>(.*?)\\<\\/TimeZoneBias\\>', 1, SyslogMessage)\r\n| extend ProductName = extract(@'ProductName=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductFamily = extract(@'ProductFamily=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductVersion = extract(@'ProductVersion=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend Analyzer = extract(@'\\<Analyzer\\>(.*?)\\<\\/Analyzer\\>', 1, SyslogMessage)\r\n| extend AnalyzerName = extract(@'\\<AnalyzerName\\>(.*?)\\<\\/AnalyzerName\\>', 1, SyslogMessage)\r\n| extend AnalyzerVersion = extract(@'\\<AnalyzerVersion\\>(.*?)\\<\\/AnalyzerVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerHostName = extract(@'\\<AnalyzerHostName\\>(.*?)\\<\\/AnalyzerHostName\\>', 1, SyslogMessage)\r\n| extend AnalyzerDatVersion = extract(@'\\<AnalyzerDATVersion\\>(.*?)\\<\\/AnalyzerDATVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerEngineVersion = extract(@'\\<AnalyzerEngineVersion\\>(.*?)\\<\\/AnalyzerEngineVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerDetectionMethod = extract(@'\\<AnalyzerDetectionMethod\\>(.*?)\\<\\/AnalyzerDetectionMethod\\>', 1, SyslogMessage)\r\n| extend EventId = extract(@'\\<EventID\\>(.*?)\\<\\/EventID\\>', 1, SyslogMessage)\r\n| extend EventSeverity = extract(@'\\<Severity\\>(.*?)\\<\\/Severity\\>', 1, SyslogMessage)\r\n| extend EventSeverity = case(EventSeverity == 1, \"Warning\",\r\n                              EventSeverity == 2, \"Notice\",\r\n                              EventSeverity == 3, \"Alert\",\r\n                              EventSeverity == 4, \"Critical\",\r\n                              \"Information\")\r\n| extend GmtTime = todatetime(extract(@'\\<GMTTime\\>(.*?)\\<\\/GMTTime\\>', 1, SyslogMessage))\r\n| extend DetectedUtc = todatetime(extract(@'\\<DetectedUTC\\>(.*?)\\<\\/DetectedUTC\\>', 1, SyslogMessage))\r\n| extend ThreatName = extract(@'\\<ThreatName\\>(.*?)\\<\\/ThreatName\\>', 1, SyslogMessage)\r\n| extend ThreatType = extract(@'\\<ThreatType\\>(.*?)\\<\\/ThreatType\\>', 1, SyslogMessage)\r\n| extend ThreatCategory = extract(@'\\<ThreatCategory\\>(.*?)\\<\\/ThreatCategory\\>', 1, SyslogMessage)\r\n| extend ThreatId = extract(@'\\<ThreatEventID\\>(.*?)\\<\\/ThreatEventID\\>', 1, SyslogMessage)\r\n| extend ThreatHandled = extract(@'\\<ThreatHandled\\>(.*?)\\<\\/ThreatHandled\\>', 1, SyslogMessage)\r\n| extend ThreatActionTaken = extract(@'\\<ThreatActionTaken\\>(.*?)\\<\\/ThreatActionTaken\\>', 1, SyslogMessage)\r\n| extend ThreatSeverity = extract(@'\\<ThreatSeverity\\>(.*?)\\<\\/ThreatSeverity\\>', 1, SyslogMessage)\r\n| extend SrcUserUpn = extract(@'\\<SourceUserName\\>(.*?)\\<\\/SourceUserName\\>', 1, SyslogMessage)\r\n| extend SrcProcessName = extract(@'\\<SourceProcessName\\>(.*?)\\<\\/SourceProcessName\\>', 1, SyslogMessage)\r\n| extend DstDvcHostname = extract(@'\\<TargetHostName\\>(.*?)\\<\\/TargetHostName\\>', 1, SyslogMessage)\r\n| extend DstUserName = extract(@'\\<TargetUserName\\>(.*?)\\<\\/TargetUserName\\>', 1, SyslogMessage)\r\n| extend TargetProcessName = extract(@'\\<TargetProcessName\\>(.*?)\\<\\/TargetProcessName\\>', 1, SyslogMessage)\r\n| extend DstFileName = extract(@'\\<TargetFileName\\>(.*?)\\<\\/TargetFileName\\>', 1, SyslogMessage)\r\n| extend Target = extract(@'\\<CustomFields target=\\\"(.*?)\\\"\\>', 1, SyslogMessage)\r\n| extend BladeName = extract(@'\\<BladeName\\>(.*?)\\<\\/BladeName\\>', 1, SyslogMessage)\r\n| extend AnalyzerContentVersion = extract(@'\\<AnalyzerContentVersion\\>(.*?)\\<\\/AnalyzerContentVersion\\>', 1, SyslogMessage)\r\n| extend AnalyzerContentCreationDate = todatetime(extract(@'\\<AnalyzerContentCreationDate\\>(.*?)\\<\\/AnalyzerContentCreationDate\\>', 1, SyslogMessage))\r\n| extend AnalyzerRuleName = extract(@'\\<AnalyzerRuleName\\>(.*?)\\<\\/AnalyzerRuleName\\>', 1, SyslogMessage)\r\n| extend AnalyzerRuleId = extract(@'\\<AnalyzerRuleID\\>(.*?)\\<\\/AnalyzerRuleID\\>', 1, SyslogMessage)\r\n| extend AnalyzerGtiQuery = extract(@'\\<AnalyzerGTIQuery\\>(.*?)\\<\\/AnalyzerGTIQuery\\>', 1, SyslogMessage)\r\n| extend ThreatDetectedOnCreation = extract(@'\\<ThreatDetectedOnCreation\\>(.*?)\\<\\/ThreatDetectedOnCreation\\>', 1, SyslogMessage)\r\n| extend DstFileSize = extract(@'\\<TargetFileSize\\>(.*?)\\<\\/TargetFileSize\\>', 1, SyslogMessage)\r\n| extend DstFileModifiedTime = extract(@'\\<TargetModifyTime\\>(.*?)\\<\\/TargetModifyTime\\>', 1, SyslogMessage)\r\n| extend DstFileAccessedTime = extract(@'\\<TargetAccessTime\\>(.*?)\\<\\/TargetAccessTime\\>', 1, SyslogMessage)\r\n| extend DstFileCreationTime = extract(@'\\<TargetCreateTime\\>(.*?)\\<\\/TargetCreateTime\\>', 1, SyslogMessage)\r\n| extend Cleanable = extract(@'\\<Cleanable\\>(.*?)\\<\\/Cleanable\\>', 1, SyslogMessage)\r\n| extend TaskName = extract(@'\\<TaskName\\>(.*?)\\<\\/TaskName\\>', 1, SyslogMessage)\r\n| extend FirstAttemptedAction = extract(@'\\<FirstAttemptedAction\\>(.*?)\\<\\/FirstAttemptedAction\\>', 1, SyslogMessage)\r\n| extend FirstActionStatus = extract(@'\\<FirstActionStatus\\>(.*?)\\<\\/FirstActionStatus\\>', 1, SyslogMessage)\r\n| extend SecondAttemptedAction = extract(@'\\<SecondAttemptedAction\\>(.*?)\\<\\/SecondAttemptedAction\\>', 1, SyslogMessage)\r\n| extend SecondActionStatus = extract(@'\\<SecondActionStatus\\>(.*?)\\<\\/SecondActionStatus\\>', 1, SyslogMessage)\r\n| extend ApiName = extract(@'\\<APIName\\>(.*?)\\<\\/APIName\\>', 1, SyslogMessage)\r\n| extend SourceDescription = extract(@'\\<SourceDescription\\>(.*?)\\<\\/SourceDescription\\>', 1, SyslogMessage)\r\n| extend SrcProcessId = extract(@'\\<SourceProcessID\\>(.*?)\\<\\/SourceProcessID\\>', 1, SyslogMessage)\r\n| extend SrcProcessHashMd5 = extract(@'\\<SourceProcessHash\\>([a-fA-F0-9]{32})\\<', 1, SyslogMessage)\r\n| extend AttackVectorType = extract(@'\\<AttackVectorType\\>(.*?)\\<\\/AttackVectorType\\>', 1, SyslogMessage)\r\n| extend DurationBeforeDetection = extract(@'\\<DurationBeforeDetection\\>(.*?)\\<\\/DurationBeforeDetection\\>', 1, SyslogMessage)\r\n| extend NaturalLangDescription = extract(@'\\<NaturalLangDescription\\>(.*?)\\<\\/NaturalLangDescription\\>', 1, SyslogMessage)\r\n| extend AccessRequested = extract(@'\\<AccessRequested\\>(.*?)\\</\\AccessRequested\\>', 1, SyslogMessage)\r\n| extend DetectionMessage = extract(@'\\<DetectionMessage\\>(.*?)\\</\\DetectionMessage\\>', 1, SyslogMessage)\r\n| extend AmCoreContentVersion = extract(@'\\<AMCoreContentVersion\\>(.*?)\\</\\AMCoreContentVersion\\>', 1, SyslogMessage)\r\n| extend SrcIpAddr = extract(@'\\<SourceIPV4\\>(.*?)\\<\\/SourceIPV4\\>', 1, SyslogMessage)\r\n| extend SrcMacAddr = extract(@'\\<SourceMAC\\>(.*?)\\<\\/SourceMAC\\>', 1, SyslogMessage)\r\n| extend DstIpAddr = extract(@'\\<TargetIPV4\\>(.*?)\\<\\/TargetIPV4\\>', 1, SyslogMessage)\r\n| extend DstMacAddr = extract(@'\\<TargetMAC\\>(.*?)\\<\\/TargetMAC\\>', 1, SyslogMessage)\r\n};\r\nlet mcafee_updateevent =() {\r\nSyslog\r\n| where SyslogMessage contains '<UpdateEvents>'\r\n| extend EventVendor = 'McAfee'\r\n| extend EventProduct = 'McAfee ePO'\r\n| extend AgentGuid = extract(@'\\<AgentGUID\\>(.*?)\\<\\/AgentGUID\\>', 1, SyslogMessage)\r\n| extend DvcHostname = extract(@'\\<MachineName\\>(.*?)\\<\\/MachineName\\>', 1, SyslogMessage)\r\n| extend DvcMacAddr = extract(@'\\<RawMACAddress\\>(.*?)\\<\\/RawMACAddress\\>', 1, SyslogMessage)\r\n| extend DvcIpAddr = extract(@'\\<IPAddress\\>(.*?)\\<\\/IPAddress\\>', 1, SyslogMessage)\r\n| extend AgentVersion = extract(@'\\<AgentVersion\\>(.*?)\\<\\/AgentVersion\\>', 1, SyslogMessage)\r\n| extend SrcUserName = extract(@'\\<UserName\\>(.*?)\\<\\/UserName\\>', 1, SyslogMessage)\r\n| extend TimeZoneBias = extract(@'\\<TimeZoneBias\\>(.*?)\\<\\/TimeZoneBias\\>', 1, SyslogMessage)\r\n| extend ProductName = extract(@'ProductName=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductFamily = extract(@'ProductFamily=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend ProductVersion = extract(@'ProductVersion=\\\"(.*?)\\\"', 1, SyslogMessage)\r\n| extend EventId = extract(@'\\<EventID\\>(.*?)\\<\\/EventID\\>', 1, SyslogMessage)\r\n| extend EventSeverity = extract(@'\\<Severity\\>(.*?)\\<\\/Severity\\>', 1, SyslogMessage)\r\n| extend EventSeverity = case(EventSeverity == 1, \"Warning\",\r\n                              EventSeverity == 2, \"Notice\",\r\n                              EventSeverity == 3, \"Alert\",\r\n                              EventSeverity == 4, \"Critical\",\r\n                              \"Information\")\r\n| extend GmtTime = todatetime(extract(@'\\<GMTTime\\>(.*?)\\<\\/GMTTime\\>', 1, SyslogMessage))\r\n| extend ProductId = extract(@'\\<ProductID\\>(.*?)\\<\\/ProductID\\>', 1, SyslogMessage)\r\n| extend Locale = extract(@'\\<Locale\\>(.*?)\\<\\/Locale\\>', 1, SyslogMessage)\r\n| extend Error = extract(@'\\<Error\\>(.*?)\\<\\/Error\\>', 1, SyslogMessage)\r\n| extend Type = extract(@'\\<Type\\>(.*?)\\<\\/Type\\>', 1, SyslogMessage)\r\n| extend Version = extract(@'\\<Version\\>(.*?)\\<\\/Version\\>', 1, SyslogMessage)\r\n| extend InitiatorId = extract(@'\\<InitiatorID\\>(.*?)\\<\\/InitiatorID\\>', 1, SyslogMessage)\r\n| extend InitiatorType = extract(@'\\<InitiatorType\\>(.*?)\\<\\/InitiatorType\\>', 1, SyslogMessage)\r\n| extend SiteName = extract(@'\\<SiteName\\>(.*?)\\<\\/SiteName\\>', 1, SyslogMessage)\r\n| extend Description = extract(@'\\<Description\\>(.*?)\\<\\/Description\\>', 1, SyslogMessage)\r\n};\r\nunion isfuzzy=true mcafee_epoevent, mcafee_updateevent\r\n| project TimeGenerated\r\n        , GmtTime\r\n        , EventVendor\r\n        , EventProduct\r\n        , EventId\r\n        , EventSeverity\r\n        , AgentGuid\r\n        , DvcHostname\r\n        , DvcIpAddr\r\n        , DvcMacAddr\r\n        , AgentVersion\r\n        , SrcDvcOs\r\n        , SrcUserName\r\n        , TimeZoneBias\r\n        , ProductName\r\n        , ProductFamily\r\n        , ProductVersion\r\n        , Analyzer\r\n        , AnalyzerName\r\n        , AnalyzerVersion\r\n        , AnalyzerHostName\r\n        , AnalyzerDatVersion\r\n        , AnalyzerEngineVersion\r\n        , AnalyzerDetectionMethod\r\n        , ThreatName\r\n        , ThreatType\r\n        , ThreatCategory\r\n        , ThreatId\r\n        , ThreatHandled\r\n        , ThreatActionTaken\r\n        , ThreatSeverity\r\n        , SrcUserUpn\r\n        , SrcProcessName\r\n        , DstDvcHostname\r\n        , DstUserName\r\n        , TargetProcessName\r\n        , DstFileName\r\n        , Target\r\n        , BladeName\r\n        , AnalyzerContentVersion\r\n        , AnalyzerContentCreationDate\r\n        , AnalyzerRuleName\r\n        , AnalyzerRuleId\r\n        , AnalyzerGtiQuery\r\n        , ThreatDetectedOnCreation\r\n        , DstFileSize\r\n        , DstFileModifiedTime\r\n        , DstFileAccessedTime\r\n        , DstFileCreationTime\r\n        , Cleanable\r\n        , TaskName\r\n        , FirstAttemptedAction\r\n        , FirstActionStatus\r\n        , SecondAttemptedAction\r\n        , SecondActionStatus\r\n        , ApiName\r\n        , SourceDescription\r\n        , SrcProcessId\r\n        , SrcProcessHashMd5\r\n        , AttackVectorType\r\n        , DurationBeforeDetection\r\n        , AccessRequested\r\n        , DetectionMessage\r\n        , AmCoreContentVersion\r\n        , SrcIpAddr\r\n        , SrcMacAddr\r\n        , DstIpAddr\r\n        , DstMacAddr\r\n        , ProductId\r\n        , Locale\r\n        , Error\r\n        , Type\r\n        , Version\r\n        , InitiatorId\r\n        , InitiatorType\r\n        , SiteName\r\n        , Description\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "McAfee ePolicy Orchestrator",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "tier": "Microsoft",
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "link": "https://support.microsoft.com/"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 1 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "McAfeeEPOAgentHandlerDown_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when AgentHandler is down.",
                "displayName": "McAfee ePO - Agent Handler down",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId == '16025'\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 2 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "McAfeeEPOAlertError_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when error sending alert occurs.",
                "displayName": "McAfee ePO - Error sending alert",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId == '1062'\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 3 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "McAfeeEPOAttemptUninstallAgent_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects attempts uninstalling McAfee agent on host.",
                "displayName": "McAfee ePO - Attempt uninstall McAfee agent",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId == '2413'\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 4 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "McAfeeEPODeploymentFailed_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when errors occur during deployment new changes/policies.",
                "displayName": "McAfee ePO - Deployment failed",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId == '2412'\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT6H",
                "queryPeriod": "PT6H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 5 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName5'),'/',variables('analyticRuleVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "McAfeeEPOExceptionAdded_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when file was added to exception list on a host.",
                "displayName": "McAfee ePO - File added to exceptions",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId in ('1029', '2005', '2015')\n| project DvcIpAddr, DstFileName\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 6 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName6'),'/',variables('analyticRuleVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "McAfeeEPOFirewallDisabled_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when firewall was disabled from Mctray.",
                "displayName": "McAfee ePO - Firewall disabled",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId in ('35009')\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 7 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName7'),'/',variables('analyticRuleVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "McAfeeEPOLoggingError_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId7')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when logging errors on agent.",
                "displayName": "McAfee ePO - Logging error occurred",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId in ('1040', '1076', '3032', '3033', '3034', '3036', '3038')\n| extend EventMessage = case(EventId == '1040', 'Activity Log error',\n                              EventId == '1076', 'Error logging information',\n                              EventId == '3032', 'Error while trying to open/create activity log file',\n                              EventId == '3033', 'Activity log file maximum size reached',\n                              EventId == '3034', 'Unable to write the activity log file',\n                              EventId == '3036', 'Error during initialization of the activity log file',\n                              'Error writing to log')\n| project DvcIpAddr, EventId, EventMessage\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId7'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 7",
                "parentId": "[variables('analyticRuleId7')]",
                "contentId": "[variables('_analyticRulecontentId7')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 8 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName8'),'/',variables('analyticRuleVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "McAfeeEPOMultipleThreatsSameHost_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId8')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule fires when multiple threat events were detected on the same host.",
                "displayName": "McAfee ePO - Multiple threats on same host",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where isnotempty(ThreatName)\n| where ThreatName != '_'\n| summarize th_cnt = dcount(ThreatName), th_list = makeset(ThreatName) by DvcIpAddr\n| where th_cnt > 1\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Persistence",
                  "DefenseEvasion",
                  "PrivilegeEscalation"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId8'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 8",
                "parentId": "[variables('analyticRuleId8')]",
                "contentId": "[variables('_analyticRulecontentId8')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 9 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName9'),'/',variables('analyticRuleVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "McAfeeEPOScanningEngineDisabled_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId9')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when OAS scanning engine was disabled.",
                "displayName": "McAfee ePO - Scanning engine disabled",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId == '1127'\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId9'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 9",
                "parentId": "[variables('analyticRuleId9')]",
                "contentId": "[variables('_analyticRulecontentId9')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 10 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName10'),'/',variables('analyticRuleVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "McAfeeEPOSpamEmail_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId10')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when email was marked as spam.",
                "displayName": "McAfee ePO - Spam Email detected",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId == '4650'\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId10'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 10",
                "parentId": "[variables('analyticRuleId10')]",
                "contentId": "[variables('_analyticRulecontentId10')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 11 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName11'),'/',variables('analyticRuleVersion11'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName11'))]"
      ],
      "properties": {
        "description": "McAfeeEPOTaskError_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion11')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId11')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when task error occurs.",
                "displayName": "McAfee ePO - Task error",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId in ('1003', '1067')\n| extend EventMessage = case(EventId == '1003', 'Error starting Task',\n                              'Unable to start scheduled task')\n| project DvcIpAddr, EventId, EventMessage\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId11'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 11",
                "parentId": "[variables('analyticRuleId11')]",
                "contentId": "[variables('_analyticRulecontentId11')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion11')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName12')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 12 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName12'),'/',variables('analyticRuleVersion12'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName12'))]"
      ],
      "properties": {
        "description": "McAfeeEPOThreatNotBlocked_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion12')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId12')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when a threat was not blocked on a host.",
                "displayName": "McAfee ePO - Threat was not blocked",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where ThreatActionTaken in~ ('none', 'IDS_ACTION_WOULD_BLOCK')\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "PrivilegeEscalation",
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId12'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 12",
                "parentId": "[variables('analyticRuleId12')]",
                "contentId": "[variables('_analyticRulecontentId12')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion12')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName13')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 13 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName13'),'/',variables('analyticRuleVersion13'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName13'))]"
      ],
      "properties": {
        "description": "McAfeeEPOUnableCleanDeleteInfectedFile_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion13')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId13')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when McAfee failed to clean or delete infected file.",
                "displayName": "McAfee ePO - Unable to clean or delete infected file",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId in ('1026', '1028', '1298', '1310', '1055', '2002', '2004', '2009')\n| extend EventMessage = case(EventId == '1026', 'Unable to clean infected file',\n                              EventId == '1028', 'Unable to delete infected file',\n                              EventId == '1298', 'File infected. Delete failed, quarantine failed',\n                              EventId == '1310', 'Multiple extension heuristic detection - delete failed, quarantine failed',\n                              EventId == '1055', 'Unable to delete infected file',\n                              EventId == '2002', 'Unable to clean infected file',\n                              EventId == '2004', 'Unable to delete infected file',\n                              'Unable to move infected file to quarantine')\n| project DvcIpAddr, EventId, EventMessage, DstFileName\n| extend IPCustomEntity = DvcIpAddr\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId13'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 13",
                "parentId": "[variables('analyticRuleId13')]",
                "contentId": "[variables('_analyticRulecontentId13')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion13')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('analyticRuleTemplateSpecName14')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Analytics Rule 14 with template",
        "displayName": "McAfee ePolicy Orchestrator Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName14'),'/',variables('analyticRuleVersion14'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName14'))]"
      ],
      "properties": {
        "description": "McAfeeEPOUpdateFailed_AnalyticalRules Analytics Rule with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion14')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId14')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects when update failed event occurs on agent.",
                "displayName": "McAfee ePO - Update failed",
                "enabled": false,
                "query": "McAfeeEPOEvent\n| where EventId in ('2402', '1119', '1123')\n| extend IPCustomEntity = DvcIpAddr, HostCustomEntity = DvcHostname\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "McAfeeePO",
                    "dataTypes": [
                      "Syslog"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPCustomEntity"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "HostCustomEntity"
                      }
                    ],
                    "entityType": "Host"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId14'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Analytics Rule 14",
                "parentId": "[variables('analyticRuleId14')]",
                "contentId": "[variables('_analyticRulecontentId14')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion14')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator data connector with template",
        "displayName": "McAfee ePolicy Orchestrator template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "McAfee ePolicy Orchestrator data connector with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "McAfee ePolicy Orchestrator (ePO)",
                  "publisher": "McAfee",
                  "descriptionMarkdown": "The McAfee ePolicy Orchestrator data connector provides the capability to ingest [McAfee ePO](https://www.mcafee.com/enterprise/en-us/products/epolicy-orchestrator.html) events into Microsoft Sentinel through the syslog. Refer to [documentation](https://docs.mcafee.com/bundle/epolicy-orchestrator-landing/page/GUID-0C40020F-5B7F-4549-B9CC-0E017BC8797F.html) for more information.",
                  "additionalRequirementBanner": "This data connector depends on a parser based on Kusto Function to work as expected. Follow the steps to use this Kusto Function alias **McAfeeEPOEvent** in queries and workbooks. [Follow steps to get this Kusto Function>](https://aka.ms/sentinel-McAfeeePO-parser)\nNote: This data connector has been developed using McAfee ePolicy Orchestrator 5.10.x (Syslog)",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "McAfeeePO",
                      "baseQuery": "McAfeeEPOEvent"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Top 10 Sources",
                      "query": "McAfeeEPOEvent\n | summarize count() by DvcHostname\n | top 10 by count_"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Syslog(McAfeeePO)",
                      "lastDataReceivedQuery": "McAfeeEPOEvent\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "McAfeeEPOEvent \n      | where TimeGenerated > ago(3d)\n            | take 1\n            | project IsConnected = true"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "write permission is required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "delete": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">This data connector depends on a parser based on a Kusto Function to work as expected [**McAfeeEPOEvent**](https://aka.ms/sentinel-McAfeeePO-parser) which is deployed with the Microsoft Sentinel Solution."
                    },
                    {
                      "description": "Typically, you should install the agent on a different computer from the one on which the logs are generated.\n\n>  Syslog logs are collected only from **Linux** agents.",
                      "instructions": [
                        {
                          "parameters": {
                            "title": "Choose where to install the agent:",
                            "instructionSteps": [
                              {
                                "title": "Install agent on Azure Linux Virtual Machine",
                                "description": "Select the machine to install the agent on and then click **Connect**.",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "linkType": "InstallAgentOnLinuxVirtualMachine"
                                    },
                                    "type": "InstallAgent"
                                  }
                                ]
                              },
                              {
                                "title": "Install agent on a non-Azure Linux Machine",
                                "description": "Download the agent on the relevant machine and follow the instructions.",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "linkType": "InstallAgentOnLinuxNonAzure"
                                    },
                                    "type": "InstallAgent"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ],
                      "title": "1. Install and onboard the agent for Linux"
                    },
                    {
                      "description": "Configure the facilities you want to collect and their severities.\n\n1.  Under workspace advanced settings **Configuration**, select **Data** and then **Syslog**.\n2.  Select **Apply below configuration to my machines** and select the facilities and severities.\n3.  Click **Save**.",
                      "instructions": [
                        {
                          "parameters": {
                            "linkType": "OpenSyslogSettings"
                          },
                          "type": "InstallAgent"
                        }
                      ],
                      "title": "2. Configure the logs to be collected"
                    },
                    {
                      "description": "[Follow these instructions](https://docs.mcafee.com/bundle/epolicy-orchestrator-5.10.0-product-guide/page/GUID-5C5332B3-837A-4DDA-BE5C-1513A230D90A.html) to add register syslog server.",
                      "title": "3. Configure McAfee ePolicy Orchestrator event forwarding to Syslog server"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "McAfee ePolicy Orchestrator",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "tier": "Microsoft",
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "link": "https://support.microsoft.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "McAfee ePolicy Orchestrator (ePO)",
          "publisher": "McAfee",
          "descriptionMarkdown": "The McAfee ePolicy Orchestrator data connector provides the capability to ingest [McAfee ePO](https://www.mcafee.com/enterprise/en-us/products/epolicy-orchestrator.html) events into Microsoft Sentinel through the syslog. Refer to [documentation](https://docs.mcafee.com/bundle/epolicy-orchestrator-landing/page/GUID-0C40020F-5B7F-4549-B9CC-0E017BC8797F.html) for more information.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "McAfeeePO",
              "baseQuery": "McAfeeEPOEvent"
            }
          ],
          "dataTypes": [
            {
              "name": "Syslog(McAfeeePO)",
              "lastDataReceivedQuery": "McAfeeEPOEvent\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "McAfeeEPOEvent \n      | where TimeGenerated > ago(3d)\n            | take 1\n            | project IsConnected = true"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Top 10 Sources",
              "query": "McAfeeEPOEvent\n | summarize count() by DvcHostname\n | top 10 by count_"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "write permission is required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "delete": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">This data connector depends on a parser based on a Kusto Function to work as expected [**McAfeeEPOEvent**](https://aka.ms/sentinel-McAfeeePO-parser) which is deployed with the Microsoft Sentinel Solution."
            },
            {
              "description": "Typically, you should install the agent on a different computer from the one on which the logs are generated.\n\n>  Syslog logs are collected only from **Linux** agents.",
              "instructions": [
                {
                  "parameters": {
                    "title": "Choose where to install the agent:",
                    "instructionSteps": [
                      {
                        "title": "Install agent on Azure Linux Virtual Machine",
                        "description": "Select the machine to install the agent on and then click **Connect**.",
                        "instructions": [
                          {
                            "parameters": {
                              "linkType": "InstallAgentOnLinuxVirtualMachine"
                            },
                            "type": "InstallAgent"
                          }
                        ]
                      },
                      {
                        "title": "Install agent on a non-Azure Linux Machine",
                        "description": "Download the agent on the relevant machine and follow the instructions.",
                        "instructions": [
                          {
                            "parameters": {
                              "linkType": "InstallAgentOnLinuxNonAzure"
                            },
                            "type": "InstallAgent"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ],
              "title": "1. Install and onboard the agent for Linux"
            },
            {
              "description": "Configure the facilities you want to collect and their severities.\n\n1.  Under workspace advanced settings **Configuration**, select **Data** and then **Syslog**.\n2.  Select **Apply below configuration to my machines** and select the facilities and severities.\n3.  Click **Save**.",
              "instructions": [
                {
                  "parameters": {
                    "linkType": "OpenSyslogSettings"
                  },
                  "type": "InstallAgent"
                }
              ],
              "title": "2. Configure the logs to be collected"
            },
            {
              "description": "[Follow these instructions](https://docs.mcafee.com/bundle/epolicy-orchestrator-5.10.0-product-guide/page/GUID-5C5332B3-837A-4DDA-BE5C-1513A230D90A.html) to add register syslog server.",
              "title": "3. Configure McAfee ePolicy Orchestrator event forwarding to Syslog server"
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "This data connector depends on a parser based on Kusto Function to work as expected. Follow the steps to use this Kusto Function alias **McAfeeEPOEvent** in queries and workbooks. [Follow steps to get this Kusto Function>](https://aka.ms/sentinel-McAfeeePO-parser)\nNote: This data connector has been developed using McAfee ePolicy Orchestrator 5.10.x (Syslog)"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 1 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName1'),'/',variables('huntingQueryVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "McAfeeEPOAgentErrors_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Agent Errors",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('2402', '2412', '1119', '1123', '2201', '2202', '2204', '2208', '3020', '3021')\n| extend EventMessage = case(EventId == '2402', \"Update Failed\",\n                              EventId == '2412', \"Deployment Failed\",\n                              EventId == '1119', \n                              \"The update failed; see event log\",\n                              EventId == '1123', \"The upgrade failed; see event log\",\n                              EventId == '2201', \"McAfee Agent: Failed to install software package\",\n                              EventId == '2202', \"McAfee Agent: Install retry limit reached for software package\",\n                              EventId == '2204', \"McAfee Agent: Insufficient disk space to install software\", \n                              EventId == '2208', \"McAfee Agent: Insufficient disk space to download software\",\n                              EventId == '3020', \"Invalid virus signature files\",\n                              \"Scan engine error\")\n| project DvcIpAddr, EventId, EventMessage\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for error events from McAfee agents."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion"
                  },
                  {
                    "name": "techniques",
                    "value": "T1070"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId1'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 1",
                "parentId": "[variables('huntingQueryId1')]",
                "contentId": "[variables('_huntingQuerycontentId1')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 2 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName2'),'/',variables('huntingQueryVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "McAfeeEPOApplicationsBlocked_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_2",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Applications blocked or contained",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('18002', '37275')\n| extend Reason = case(EventId == '18002', \"Application blocked\",\n                      \"Application contained\")\n| project DvcIpAddr, DstFileName\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for blocked or contained applications."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Execution"
                  },
                  {
                    "name": "techniques",
                    "value": "T1204,T1189"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId2'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 2",
                "parentId": "[variables('huntingQueryId2')]",
                "contentId": "[variables('_huntingQuerycontentId2')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 3 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName3'),'/',variables('huntingQueryVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "McAfeeEPOEmailThreats_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_3",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Email Treats",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('1417', '1418', '1419', '1420', '1500', '1501', '1502', '1503', '1504', '1505', '1506', '1507', '1513', '1514')\n| extend EventMessage = case(EventId == '1417', \"Email message deleted (user defined detection)\",\n                              EventId == '1418', \"Email message deleted (user defined detection), Clean failed\",\n                              EventId == '1419', \n                              \"Email message deleted (user defined detection), Move failed\",\n                              EventId == '1420', \"Email message deleted (user defined detection), Delete failed\",\n                              EventId == '1500', \"Infected email cleaned (Medium)\",\n                              EventId == '1501', \"Infected email quarantined\",\n                              EventId == '1502', \"Unable to clean infected mail\", \n                              EventId == '1503', \"Infected email detected\",\n                              EventId == '1504', \"Infected mail item deleted\",\n                              EventId == '1505', \"Email content filtered\",\n                              EventId == '1506', \"Email content blocked\",\n                              EventId == '1507', \"Inbound email suspended for low disk\",\n                              EventId == '1513', \"Mail virus quarantined and cleaned\",\n                              \"Mail virus quarantined (not cleaned)\")\n| project DvcIpAddr, EventId, EventMessage\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for email related threat events."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1566"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId3'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 3",
                "parentId": "[variables('huntingQueryId3')]",
                "contentId": "[variables('_huntingQuerycontentId3')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 4 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName4'),'/',variables('huntingQueryVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "McAfeeEPOInfectedFiles_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_4",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Infected files by source",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('1024', '1053', '2000', '3004')\n| summarize ['Infected Files List'] = makeset(DstFileName) by DvcIpAddr\n| project DvcIpAddr, ['Infected Files List']\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for infected files which were detected."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId4'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 4",
                "parentId": "[variables('huntingQueryId4')]",
                "contentId": "[variables('_huntingQuerycontentId4')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 5 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName5'),'/',variables('huntingQueryVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "McAfeeEPOInfectedSystems_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_5",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Infected Systems",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('1038', '3043')\n| project DvcIpAddr, DvcHostname\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for infected systems based on scan results."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189,T1195"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId5'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 5",
                "parentId": "[variables('huntingQueryId5')]",
                "contentId": "[variables('_huntingQuerycontentId5')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 6 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName6'),'/',variables('huntingQueryVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "McAfeeEPOLongTermInfectedSystems_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_6",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Long term infected systems",
                "category": "Hunting Queries",
                "query": "let lbperiod_30d = 30d;\nlet infected_systems = McAfeeEPOEvent\n| where TimeGenerated > ago(lbperiod_30d)\n| where EventId in ('1038', '3043')\n| summarize LastScanTimeInfected = max(TimeGenerated) by DvcIpAddr\n| extend SystemStatus = 'Infected';\nlet clean_systems = McAfeeEPOEvent\n| where TimeGenerated > ago(lbperiod_30d - 1h)\n| where EventId in ('1034', '3039')\n| summarize LastScanTimeClean = max(TimeGenerated) by DvcIpAddr\n| extend SystemStatus = 'Clean';\nlet clean_systems2 = McAfeeEPOEvent\n| where TimeGenerated > ago(lbperiod_30d - 1h)\n| where EventId in ('1034', '3039')\n| summarize makeset(DvcIpAddr);\ninfected_systems\n| extend tmp_key = 1\n| join (clean_systems\n          | extend tmp_key = 1) on tmp_key\n| where  LastScanTimeInfected > LastScanTimeClean or DvcIpAddr !in (clean_systems2)\n| project LastScanTimeInfected, DvcIpAddr\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for infected systems which were not cleaned for long term."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Persistence"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId6'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 6",
                "parentId": "[variables('huntingQueryId6')]",
                "contentId": "[variables('_huntingQuerycontentId6')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 7 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName7'),'/',variables('huntingQueryVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "McAfeeEPOMultipleThreats_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_7",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Sources with multiple threats",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nlet threshold = 1;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where isnotempty(ThreatName)\n| where ThreatName != '_'\n| summarize ThreatList = makeset(ThreatName) by DvcIpAddr\n| where array_length(ThreatList) > threshold\n| project DvcIpAddr, ThreatList\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for sources with several different threats."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1189,T1195"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId7'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 7",
                "parentId": "[variables('huntingQueryId7')]",
                "contentId": "[variables('_huntingQuerycontentId7')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 8 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName8'),'/',variables('huntingQueryVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "McAfeeEPOObjectsNotScanned_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_8",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Objects not scanned",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('1051', '34925', '34926')\n| extend Reason = case(EventId == '1051', \"Unable to scan password protected\",\n                              EventId == '34925', \"The object was not scanned because the scanner does not have enough rights to read it\",\n                              \"The object was not scanned because the file size exceeds the configured maximum file size to scan\")\n| project DvcIpAddr, EventId, Reason, DstFileName\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for unscanned objects."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion"
                  },
                  {
                    "name": "techniques",
                    "value": "T1562"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId8'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 8",
                "parentId": "[variables('huntingQueryId8')]",
                "contentId": "[variables('_huntingQuerycontentId8')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 9 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName9'),'/',variables('huntingQueryVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "McAfeeEPOScanErrors_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_9",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Scan Errors",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('3021', '1086', '1059', '1128', '1035', '1051', '1048', '1049', '3053', '3054', '3046')\n| extend Reason = case(EventId == '3021', \"Scan engine error\",\n                              EventId == '1086', \"Scan Process Error\",\n                              EventId == '1059', \"Scan Timed Out\",\n                              EventId == '1128', \"Scan time exceeded\",\n                              EventId == '1035', \"Scan was canceled\",\n                              EventId == '1051', \"Unable to scan password protected\",\n                              EventId == '1048', \"Scan reports general system error\",\n                              EventId == '1049', \"Scan reported an internal application error\",\n                              EventId == '3053', \"Centralized Alerting - Scan reports general system error\",\n                              EventId == '3054', \"Centralized Alerting - Scan reported an internal application error\",\n                              \"Centralized Alerting - Scan reports memory allocation error\")\n| project DvcIpAddr, EventId, Reason\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for scan error events."
                  },
                  {
                    "name": "tactics",
                    "value": "DefenseEvasion"
                  },
                  {
                    "name": "techniques",
                    "value": "T1562"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId9'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 9",
                "parentId": "[variables('huntingQueryId9')]",
                "contentId": "[variables('_huntingQuerycontentId9')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('huntingQueryTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Hunting Query 10 with template",
        "displayName": "McAfee ePolicy Orchestrator Hunting Query template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('huntingQueryTemplateSpecName10'),'/',variables('huntingQueryVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "HuntingQuery"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "McAfeeEPOThreatNotBlocked_HuntingQueries Hunting Query with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2020-08-01",
              "name": "McAfee_ePolicy_Orchestrator_Hunting_Query_10",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "McAfee ePO - Threats detected and not blocked, cleaned or deleted",
                "category": "Hunting Queries",
                "query": "let lbtime = 24h;\nMcAfeeEPOEvent\n| where TimeGenerated > ago(lbtime)\n| where EventId in ('1095', '1096', '1099', '34937', '35102', '34938', '35106', '35111', '35117')\n| extend EventMessage = case(EventId == '1095', \"Access Protection rule violation detected and NOT blocked\",\n                              EventId == '1096', \"Port blocking rule violation detected and NOT blocked\",\n                              EventId == '1099', \n                              \"Buffer Overflow detected and NOT blocked\",\n                              EventId == '34937', \"Script security violation detected, AMSI would block\",\n                              EventId == '35102', \"Adaptive Threat Protection Would Block\",\n                              EventId == '34938', \"Script security violation detected, AMSI would delete\",\n                              EventId == '35106', \"Adaptive Threat Protection Would Clean\", \n                              EventId == '35111', \"Adaptive Threat Protection Would Contain\",\n                              \"Adaptive Threat Protection Would Block Source\")\n| project DvcIpAddr, EventId, EventMessage\n| extend IPCustomEntity = DvcIpAddr\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Query searches for events where threats were detected and not blocked, cleaned or deleted."
                  },
                  {
                    "name": "tactics",
                    "value": "Persistence,PrivilegeEscalation"
                  },
                  {
                    "name": "techniques",
                    "value": "T1574,T1055"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId10'),'/'))))]",
              "properties": {
                "description": "McAfee ePolicy Orchestrator Hunting Query 10",
                "parentId": "[variables('huntingQueryId10')]",
                "contentId": "[variables('_huntingQuerycontentId10')]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "McAfee ePolicy Orchestrator Workbook with template",
        "displayName": "McAfee ePolicy Orchestrator workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "McAfeeePOOverviewWorkbook Workbook with template version 2.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This workbook depends on a parser based on a Kusto Function to work as expected [**McAfeeEPOEvent**](https://aka.ms/sentinel-McAfeeePO-parser) which is deployed with the Microsoft Sentinel Solution.\"},\"name\":\"text - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"24d0a087-55d0-4205-b17f-59866e20d7d4\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Event Overview\",\"subTarget\":\"ma_events\",\"style\":\"link\"},{\"id\":\"b8caadb4-a5ef-4e30-9611-45fd2ac1fa46\",\"cellValue\":\"Tab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Threats\",\"subTarget\":\"ma_threats\",\"style\":\"link\"}]},\"customWidth\":\"100\",\"name\":\"links - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"3b79a6c4-43ca-48f8-8010-18ab3056bec3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":43200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"100\",\"name\":\"parameters - 3\",\"styleSettings\":{\"margin\":\"0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\",\"size\":0,\"title\":\"Events Over Time\",\"color\":\"turquoise\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"chartSettings\":{\"showMetrics\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_events\"},\"customWidth\":\"45\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| summarize Count = count() by EventSeverity\\r\\n| join kind = inner (McAfeeEPOEvent\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by EventSeverity)\\r\\n on EventSeverity\",\"size\":3,\"title\":\"Event Distribution by Severity\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"EventSeverity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":10,\"formatOptions\":{\"palette\":\"purpleDark\"}},\"showBorder\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_events\"},\"customWidth\":\"30\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| summarize TotalEvents = count() by EventSeverity\",\"size\":3,\"title\":\"EventSeverity Distribution\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"showMetrics\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_events\"},\"customWidth\":\"25\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| summarize TotalEvents = count() by DvcIpAddr\\r\\n| top 10 by TotalEvents\\r\\n\",\"size\":0,\"title\":\"Top 10 Sources\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_events\"},\"customWidth\":\"33\",\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(SrcDvcOs)\\r\\n| summarize TotalEvents = count() by SrcDvcOs\\r\\n| top 10 by TotalEvents\",\"size\":3,\"title\":\"Events Distribution by OS\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_events\"},\"customWidth\":\"33\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(AgentVersion)\\r\\n| summarize Agents = dcount(DvcIpAddr) by AgentVersion\",\"size\":0,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_events\"},\"customWidth\":\"33\",\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(ThreatName)\\r\\n| make-series TotalEvents = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain};\",\"size\":0,\"title\":\"Threats over Time\",\"color\":\"redBright\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"50\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| summarize Count = count() by ThreatCategory\\r\\n| join kind = inner (McAfeeEPOEvent\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ThreatCategory)\\r\\n on ThreatCategory\",\"size\":0,\"title\":\"Threats by Category\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ThreatCategory\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"redDark\"}},\"showBorder\":false}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"50\",\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(ThreatName)\\r\\n| where ThreatName != '_'\\r\\n| summarize TotalEvents = count() by ThreatName\\r\\n| order by TotalEvents desc\\r\\n| top 10 by TotalEvents\\r\\n\",\"size\":0,\"title\":\"Top 10 Threats\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"60\",\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(ThreatName)\\r\\n| where ThreatName != '_'\\r\\n| summarize TotalEvents = count() by ThreatName\\r\\n| sort by TotalEvents desc\\r\\n\",\"size\":0,\"title\":\"Top Threats\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":50,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"40\",\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(ThreatName)\\r\\n| where ThreatName != '_'\\r\\n| order by TimeGenerated desc\\r\\n| summarize EventTime = max(TimeGenerated) by ThreatName, DvcIpAddr\",\"size\":0,\"title\":\"Latest Threats by Source\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":50,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"40\",\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(AnalyzerRuleName)\\r\\n| summarize TotalEvents = count() by AnalyzerRuleName\\r\\n\",\"size\":3,\"title\":\"Rules Fired\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"25\",\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"McAfeeEPOEvent\\r\\n| where isnotempty(AnalyzerRuleName)\\r\\n| order by TimeGenerated\\r\\n| summarize by AnalyzerRuleName, DvcIpAddr\",\"size\":0,\"title\":\"Latest Rules Fired\",\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Tab\",\"comparison\":\"isEqualTo\",\"value\":\"ma_threats\"},\"customWidth\":\"33\",\"name\":\"query - 15\"}],\"fromTemplateId\":\"sentinel-McAfeeePO\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=McAfeeePOWorkbook; logoFileName=mcafee_logo.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=McAfee ePolicy Orchestrator; templateRelativePath=McAfeeePOOverview.json; subtitle=; provider=Microsoft}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "McAfee ePolicy Orchestrator",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Microsoft",
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.1",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "McAfee ePolicy Orchestrator",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId7')]",
              "version": "[variables('analyticRuleVersion7')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId8')]",
              "version": "[variables('analyticRuleVersion8')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId9')]",
              "version": "[variables('analyticRuleVersion9')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId10')]",
              "version": "[variables('analyticRuleVersion10')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId11')]",
              "version": "[variables('analyticRuleVersion11')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId12')]",
              "version": "[variables('analyticRuleVersion12')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId13')]",
              "version": "[variables('analyticRuleVersion13')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId14')]",
              "version": "[variables('analyticRuleVersion14')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId1')]",
              "version": "[variables('huntingQueryVersion1')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId2')]",
              "version": "[variables('huntingQueryVersion2')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId3')]",
              "version": "[variables('huntingQueryVersion3')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId4')]",
              "version": "[variables('huntingQueryVersion4')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId5')]",
              "version": "[variables('huntingQueryVersion5')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId6')]",
              "version": "[variables('huntingQueryVersion6')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId7')]",
              "version": "[variables('huntingQueryVersion7')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId8')]",
              "version": "[variables('huntingQueryVersion8')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId9')]",
              "version": "[variables('huntingQueryVersion9')]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('_huntingQuerycontentId10')]",
              "version": "[variables('huntingQueryVersion10')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2021-03-25",
        "providers": [
          "McAfee"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
