{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for EclecticIQ"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-eclecticiqtip",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "EclecticIQCustomConnector": "EclecticIQCustomConnector",
    "_EclecticIQCustomConnector": "[variables('EclecticIQCustomConnector')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "EclecticIQCustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "EclecticIQ-EnrichIncident": "EclecticIQ-EnrichIncident",
    "_EclecticIQ-EnrichIncident": "[variables('EclecticIQ-EnrichIncident')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "EclecticIQ-EnrichIncident",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "blanks": "[replace('b', 'b', '')]",
    "EclecticIQ-CreateObservable": "EclecticIQ-CreateObservable",
    "_EclecticIQ-CreateObservable": "[variables('EclecticIQ-CreateObservable')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "EclecticIQ-CreateObservable",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
    "operationId-GetObservablebyId": "GetObservablebyId",
    "_operationId-GetObservablebyId": "[variables('operationId-GetObservablebyId')]",
    "operationId-DeleteObservablesbyID": "DeleteObservablesbyID",
    "_operationId-DeleteObservablesbyID": "[variables('operationId-DeleteObservablesbyID')]",
    "operationId-UpdateObservablesbyID": "UpdateObservablesbyID",
    "_operationId-UpdateObservablesbyID": "[variables('operationId-UpdateObservablesbyID')]",
    "operationId-GetSourcesbyID": "GetSourcesbyID",
    "_operationId-GetSourcesbyID": "[variables('operationId-GetSourcesbyID')]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "properties": {
        "description": "EclecticIQCustomConnector",
        "displayName": "EclecticIQCustomConnector"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "EclecticIQCustomConnector Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "EclecticIQCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all EclecticIQ automation playbooks as well"
              }
            },
            "EclecticIQ Host": {
              "defaultValue": "ic-playground.eclecticiq.com",
              "type": "String",
              "metadata": {
                "description": "Enter your EclecticIQ platform url for example: ic-playground.eclecticiq.com. Do NOT prefix with https:// or http:// etc"
              }
            }
          },
          "variables": {
            "api_host": "[[replace(replace(parameters('EclecticIQ Host'),'https://',''),'http://','')]",
            "ServiceName": "[[concat('https://', variables('api_host'))]",
            "operationId-GetObservables": "GetObservables",
            "_operationId-GetObservables": "[[variables('operationId-GetObservables')]",
            "operationId-CreateObservables": "CreateObservables",
            "_operationId-CreateObservables": "[[variables('operationId-CreateObservables')]",
            "operationId-CreateorUpdateObservables": "CreateorUpdateObservables",
            "_operationId-CreateorUpdateObservables": "[[variables('operationId-CreateorUpdateObservables')]",
            "operationId-GetSourcesList": "GetSourcesList",
            "_operationId-GetSourcesList": "[[variables('operationId-GetSourcesList')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId": "EclecticIQCustomConnector",
            "playbookId": "[[resourceId('Microsoft.Web/customApis', parameters('CustomConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('CustomConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "API Key",
                      "description": "The API Key for EclecticIQ api access",
                      "tooltip": "Provide your API Key starts with Bearer <<Key Value>>",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "brandColor": "#FFFFFF",
                "description": "This logic app custom connectors helps to interact with EclecticIQ Threat Intelligence platform to perform actions like (Fetch, Add, Edit and Delete) threat intelligence.",
                "displayName": "[[parameters('CustomConnectorName')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASIAAACuCAMAAAClZfCTAAABI1BMVEX///8dHRv/8W8AAAAXFxU8PDswMC8ZGRb/8Wz/84b/84D/8Wr/+9v//3vOzs0RERU9OiC+ul6Hh4b5+fnt7e18fHvz8/OqqqrDw8P/724NDQv//33MzMxISEf/9nETExFGRkZQUE/l5eW0tLNYWFfY2Nj//4RsZjNycnInJyVhYWCRkZCfn58JCQT17nB1dXStrlSXjkQAAAf//48AABDRzGR2cDpaUy/s6XL//4tNSSnw8IMyLhy5ubgAABXd1GRkXjP//ev/+cP/9p//97HZ2dD//7/X165HRTvIx4TDwGmIfz8aFRvV1HCNhEC4rVTw42o1MRejnE5BOx2sq2Pg4IEgHROSk1FubkTIvVuMjFLVzWDMy24kJRsnJRXk1GJLSjHbKRv8AAAMD0lEQVR4nO2bCXfaSBKADS2OmYwwN1gCCQTCHELGxIDMMdLO7M7uhuEIydghxEn+/6/Y6pbEjbGTdTx+r77n2Fi0jv6oruqW4pMTBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBPk7k0xH8/6/P8W0fbn/+O33n35+Cn45JCiu+Uld5gJ/d2RfgV7uL78HX70KPgWvDikKFQnneQlw2QFc7h/eV94n4pCidLb+3H1/IIEcKPrnq+BTGTqkSC2+FEOeAAy0354shA4qikfJc/f8wXC59C8/n/1wRemXkYYYQvFff0hPaGi/onjt5QSR5zT/79c/XpGal5+74w/n9D//LT2lof2KQpXAc3f84ZyG34jPoOjFlDMPVRR5BkWZF5SKqCL+xysKoaIXpyhwT27cVHS259WPUhQQ6nXiUBd25k3wZl14bM/l/bvIdbJ+MME+6e45dxWdSe7LM6+0nAlIvOSFL+kbg+2himTiz67wbZe8gA+2+h9ZB2Xi85HdfbhKjh6McwV5iolaLVr1k/3r6nVFQcPw2vHjKKIvJX1uelumNI/o9Pezx0baAxVxJBpaoQ62lnCckFZDIW1Pf+81lAqFLnY/DXIBB1M12T6vv5ZRlWQyrma0PNkXdGuKJP7y3OABUZKkYasUDMJrSWp1Gnr7Uh9ahiSJvMTzZ14efkLI0bfpbvZv9Pu3KyLV5HoDtbrZQiYKbB08RJEMBBwVMZjIV3bPFaXnKggBetyyGndPGlNru423FJ3/aeimHonw/Jy0R15eb8x1sRVu6OdjPTLReXhLak0l3my0eGlqGvMWyJRaDVOS+AVs2xdXD1U02GiwrYgjIehC6gGKAjSh2XN3otFDZXfPlaBWUqCIIwll/bRJzb87Y9tQ1L7rRaz2zdtZqUNOLa9hyf2Z8YkquhQv2z1jeHPX7s6uI10u3BAX3fN38JY+C592I6VI9+bdjN9zT+VhigIkwy4x4wy0Qn5roD1UkeDTMplMmUaIh+QhilRhZ/CsFG3FLpyiVtnJR5tR1O9NIHy6Tb7VbI+Mc6v3vt8YvWOK2uHesDkfWWRS6g//mvcXC/Ih0u6M3gRm5rjV6k7+urwx+d0weqiiNLtAX44B6dp1I7DSs61I2ClAsiDQ2KnnoeFJzU68pJzS1oLIabJU5CGybUitXZSj6RhztJu7NhXd9WbN6esJOePJ7bXx69fbD1e3ZtdW1NG7569LEplPSfvjkFyaXKPUCC9mkL+M0ux0+LFNLvcs9x6lqEoEB9sFK860HgfWFXGwxVMR3PHEeu00lAWmKEH38VTgm+Ceie7EZhWBVRTZoztW8MnQ0l9jSSmT2466zYHWp4quQZFEZq+Nq05jMjGXiowuBy7IYkqGjcncbN1ESpOvi5nVK4mlWfMS2i723DN4pKKNwCCVxEBR1FTRI9RXiqCUa2o8rhSqxG4OtirRtKKEtDwMLjpiM5qWysukqAFO5BBfLaMomVoWzuUoIhV2MRmOwNQRcpjG4iixPZo3o+jX3ox8uZ7RKOq+Max3rch49KlP07UI+lrc2264OSuRrjG/lFrN96XJzZv3N8NIe2KGrdFsyH+nomTWnTvST1IgUcUO/phGVooETos7mwesAEGw1JL2lrhmK4L3ThICqcXgJ6FZjVRSbhOIMFdRlOU/v3MxQoU9DCr45XsUQb6Z/DotTZpTsU263pF1ylmjEYsiCaJI9E5aCzK7Nk/vPG2pdRcRJ+FP4sxzdToptfp3V+fS90ZR6iLKSORlCJZVkfOtFHGytjqOSrsn0EHo/J53FNFosBUkqSLiU90maZ+wVGSfc3kt9nY1KxxU5KXzRUn3sn/iVIdp0HQqSkFd8sIX1PVZ+Pb2cxPmQ/oX2M42QiPe+GLwQV78oovfXvRtRXDBToMUEUhq2Ryyr5uLAvZHryaqBdo2BWmZFNx2EG1riuqOIsEj+9NukySMo6UiWvBj5eW11PNUZLxIDis6o4okex0i2bNC+B5kW+E9yWzf/WlJULVgO/Vpt7ab2tv28DhFbkdqhBTZB1/IVaownlxFHtk3YKFA6OiCVzniZJSUz1/WfHWBKapV/LCEWSoiVfugfn80CsNoqYj+iK2MCDm6b7J6j6IjnPGiKJb21PV7+SZFJwViJ0+NFiIiV2Q3ikgVPnqlzBKWU7s0J37YlLHOFEXZa1dRoELjLB5lTQKror8bRaFjUbSSsfq5lV4ef5v7cbmoHE0AkIuIQDcoedowsJoXyXa304N0ejCgHS0weSCCVFhDJ4rYvMhVJPtVdk43x2zkIvg0nArG2UP7/lzkeBFZpNBF2FnwwPB5GkXJ3LKiCZ40G1Cce/mOonpt80hQsRV2QNmNhB1FdcGnMBVupVoqYsdaVrSArfe+iuYizacsWPTFlDfOh7tlameZcd+z3G+cF9mKMj5hS5HdrZjLieohNERUN0QEZ6CtR5GtKL2ryM8uRiXuWQmpqvfOi7xevlQqwfKdjF8HYTk/an58Pepeitd0IS/CO2wABqGRGKRNIdhg6S/qdMvhWHukouV/x2B1CjZwAQ8sQVxFsO6EFKVcZKvFYjXnz1ezsr1nDo7I1eWlInljoNFtqo/Qm2ncShHnJMC0XyZL8juLtPV5kTS3wm29NCZ3H854rz5u3t2a7fNxGNb4UPAtg2ejcN7vwwaj3R8a/OJyMp6IkU5/vm/W+HhFRTcNcFCOaD9CRVmQc36Zq0OsxAbELnS04NHe0LtgFXLBQsEvCx6f31mApCogxlZ0AusOjoZebADvVnwVeX2NZl9OUrsoO1R98vZSefN+UffDTb80bvYtnZf09tXd2BxzX8PNCD/8/CHcN0CDeEk6nbdm73O/c9cx3zTJaSQS7ljNyaHnKI+qaOmaZlPLEnsuo2jRWhzSCEvK8UTWU0mxPuX8vnL8JFTmAgJhk6l4LaEpKVhnMNdaNZGzU/tJKu9jS366Wo0WlOhqXgSrtXJs+9LWKtyuIsjPpjkkukgu2UAzrmApa7V/HnUjrbeT3qfPM9HL68S65k19+M64Nq9uR2HL1NvWp5LFGQfC6NuKPlsmrG7lwGrMnh/Gy6TMVptKxn4XRs9aP2E2wLkzzhpnT4doFuJqyyYQl+v3i2pbd0PY9PuQojPIzd0Pnasp5KKSlyr69bZkdsaiaU3m/c75eXeme/kFmV9LohG2RL5nXbbuGiXTClvnHet7FWU2GtC+koTqdiwGidReYhWcFZZjMspx9J7uUmbIT8rOWiMD00v7ZcxPKtpyJxiEUVcRLF7KyupwrlvugCKvOCPz3i0BRcO/4FeIoo890xrqo07D7AxbrYkOGvWbbs9YGLO3rV4j8P7Tnw1eH4Yj5tyUDpS1hyoKJeMrkiqEO0eyBTUOZSuuDqAvNSUZiyUHAbCVVuCzjyWVdJGlZZnk0wo0TCoqzK/JRSiejCXjSlYgWZVtpvdYymm2v6JGQZECp0ixpAOr/ERaVZS1cytbt/PWFPEtq9P+2pyWOqSrQ7UyuqRttkGRNZMa/Q9fLZ3mosbbfrhvlqzTrzdj4w0o4lsd6zw8/7507alXa9E1Lnwy9UZy0VRKS/gJXdUWtZQWzdNeyVVtkC5oxbpTn6FhljYsV6AhR/wXtGWxArnGA5trVShSMhGKNfraQzg5l4hGa0VnDgB5318sJ1bnrmU3J0brRZ9vjceN2VQ0h7ewKPNKi2FDn0e8xmSu85HhsKXbFa09jEi8fjucGbw5W0h0t/bs0Dh78EMisol9lW4xtj9v9oRtffOqK/L6ozBhtZOwvLWybLLcutp5+fzOZqvqb86L2EONM/jGHgbRX+Al/Auyxx3sIZHz4MNuCSvYMzoD5w/W/O9+GstxyyIcWH8pbxfntYbrLdcTC/dN//Frc3btdNTNK+v9Xnv2yB6xBaXVrY9994n+X4qeH3ymfxRUdBRUdBRUdBRUdBRUdBRUdBRUdBRUdBRUdBRUdBRUdBRUdJTnUZQh3Ish0ARFT/Jnw/f++XDI73s5+L++ef3TU3L4j9ARBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQ5Hn5H9Nt3+bn3rWBAAAAAElFTkSuQmCC",
                "backendService": {
                  "serviceUrl": "[[variables('ServiceName')]"
                },
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "version": "1.0.0",
                    "title": "EclecticIQ",
                    "description": "This logic app custom connectors helps to interact with EclecticIQ Threat Intelligence platform to perform actions like (Fetch, Add, Edit and Delete) threat intelligence."
                  },
                  "host": "[[variables('api_host')]",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "produces": [
                    "application/json"
                  ],
                  "paths": {
                    "/api/v1/observables": {
                      "get": {
                        "summary": "Get Observables",
                        "description": "Get Observables",
                        "operationId": "[[variables('_operationId-GetObservables')]",
                        "parameters": [
                          {
                            "name": "limit",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "description": "Maximum number of items to be returned",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "offset",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "description": "Return results starting from the specified (zero-based) index",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "sort",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Comma-separated list of fields to sort on. Prefix a field with the minus \"-\" sign if you intend to apply descending sorting to it",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "data",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "description": "Set this parameter to false if you want to only retrieve the number of objects matching the query",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "attributes",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Comma-separated list of attributes to be returned. Nested attributes are separated by dots - e.g. data.title",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "filter[type]",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Filter by observable type",
                            "x-ms-visibility": "advanced",
                            "enum": [
                              "ja3s-hash",
                              "country",
                              "cve",
                              "hash-rich-pe-header",
                              "forum-thread",
                              "bank-account",
                              "geo",
                              "malware",
                              "uri",
                              "card",
                              "asn",
                              "city",
                              "street",
                              "person",
                              "handle",
                              "hash-sha256",
                              "ja3-hash",
                              "hash-ssdeep",
                              "ipv4-cidr",
                              "rule",
                              "hash-vhash",
                              "uri-hash-sha256",
                              "geo-long",
                              "hash-sha512",
                              "hash-md5",
                              "postcode",
                              "cce",
                              "inetnum",
                              "name",
                              "netname",
                              "host",
                              "hash-imphash",
                              "mac-48",
                              "card-owner",
                              "ja3s-full",
                              "domain",
                              "company",
                              "product",
                              "nationality",
                              "fox-it-portal-uri",
                              "ipv4",
                              "email-subject",
                              "registrar",
                              "address",
                              "ipv6",
                              "yara",
                              "forum-name",
                              "country-code",
                              "industry",
                              "ja3-full",
                              "snort",
                              "hash-sha1",
                              "ipv6-cidr",
                              "file",
                              "eui-64",
                              "winregistry",
                              "organization",
                              "hash-authentihash",
                              "telephone",
                              "process",
                              "cwe",
                              "port",
                              "forum-room",
                              "geo-lat",
                              "email",
                              "mutex",
                              "actor-id"
                            ]
                          },
                          {
                            "name": "filter[value]",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Filter by observable value",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/api/v1/observables/": {
                      "post": {
                        "summary": "Create Observables",
                        "description": "Create Observables",
                        "operationId": "[[variables('_operationId-CreateObservables')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "meta": {
                                      "type": "object",
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string",
                                          "description": "Maliciousness of an observable",
                                          "title": "maliciousness",
                                          "x-ms-visibility": "advanced",
                                          "enum": [
                                            "unknown",
                                            "safe",
                                            "low",
                                            "medium",
                                            "high"
                                          ]
                                        }
                                      },
                                      "description": "meta"
                                    },
                                    "entities": {
                                      "type": "string",
                                      "description": "Entities associated with this observable",
                                      "title": "entities",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "sources": {
                                      "type": "string",
                                      "description": "Sources associated with this observable (currently only one source is allowed)",
                                      "title": "sources",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "value": {
                                      "type": "string",
                                      "description": "observable value",
                                      "title": "value",
                                      "x-ms-visibility": "important"
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "Observable type likeja3s-hash,country,cve etc",
                                      "title": "type",
                                      "x-ms-visibility": "important",
                                      "enum": [
                                        "ja3s-hash",
                                        "country",
                                        "cve",
                                        "hash-rich-pe-header",
                                        "forum-thread",
                                        "bank-account",
                                        "geo",
                                        "malware",
                                        "uri",
                                        "card",
                                        "asn",
                                        "city",
                                        "street",
                                        "person",
                                        "handle",
                                        "hash-sha256",
                                        "ja3-hash",
                                        "hash-ssdeep",
                                        "ipv4-cidr",
                                        "rule",
                                        "hash-vhash",
                                        "uri-hash-sha256",
                                        "geo-long",
                                        "hash-sha512",
                                        "hash-md5",
                                        "postcode",
                                        "cce",
                                        "inetnum",
                                        "name",
                                        "netname",
                                        "host",
                                        "hash-imphash",
                                        "mac-48",
                                        "card-owner",
                                        "ja3s-full",
                                        "domain",
                                        "company",
                                        "product",
                                        "nationality",
                                        "fox-it-portal-uri",
                                        "ipv4",
                                        "email-subject",
                                        "registrar",
                                        "address",
                                        "ipv6",
                                        "yara",
                                        "forum-name",
                                        "country-code",
                                        "industry",
                                        "ja3-full",
                                        "snort",
                                        "hash-sha1",
                                        "ipv6-cidr",
                                        "file",
                                        "eui-64",
                                        "winregistry",
                                        "organization",
                                        "hash-authentihash",
                                        "telephone",
                                        "process",
                                        "cwe",
                                        "port",
                                        "forum-room",
                                        "geo-lat",
                                        "email",
                                        "mutex",
                                        "actor-id"
                                      ]
                                    }
                                  },
                                  "description": "data",
                                  "required": [
                                    "type",
                                    "value"
                                  ]
                                }
                              },
                              "required": [
                                "data"
                              ]
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      },
                      "put": {
                        "summary": "Create or Update Observables",
                        "description": "Create or Update Observables",
                        "operationId": "[[variables('_operationId-CreateorUpdateObservables')]",
                        "parameters": [
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "meta": {
                                      "type": "object",
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string",
                                          "description": "maliciousness",
                                          "title": "maliciousness",
                                          "x-ms-visibility": "advanced",
                                          "enum": [
                                            "unknown",
                                            "safe",
                                            "low",
                                            "medium",
                                            "high"
                                          ]
                                        }
                                      },
                                      "description": "meta"
                                    },
                                    "entities": {
                                      "type": "string",
                                      "description": "Entities associated with this observable",
                                      "title": "entities",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "Observable type",
                                      "title": "type",
                                      "x-ms-visibility": "important",
                                      "enum": [
                                        "ja3s-hash",
                                        "country",
                                        "cve",
                                        "hash-rich-pe-header",
                                        "forum-thread",
                                        "bank-account",
                                        "geo",
                                        "malware",
                                        "uri",
                                        "card",
                                        "asn",
                                        "city",
                                        "street",
                                        "person",
                                        "handle",
                                        "hash-sha256",
                                        "ja3-hash",
                                        "hash-ssdeep",
                                        "ipv4-cidr",
                                        "rule",
                                        "hash-vhash",
                                        "uri-hash-sha256",
                                        "geo-long",
                                        "hash-sha512",
                                        "hash-md5",
                                        "postcode",
                                        "cce",
                                        "inetnum",
                                        "name",
                                        "netname",
                                        "host",
                                        "hash-imphash",
                                        "mac-48",
                                        "card-owner",
                                        "ja3s-full",
                                        "domain",
                                        "company",
                                        "product",
                                        "nationality",
                                        "fox-it-portal-uri",
                                        "ipv4",
                                        "email-subject",
                                        "registrar",
                                        "address",
                                        "ipv6",
                                        "yara",
                                        "forum-name",
                                        "country-code",
                                        "industry",
                                        "ja3-full",
                                        "snort",
                                        "hash-sha1",
                                        "ipv6-cidr",
                                        "file",
                                        "eui-64",
                                        "winregistry",
                                        "organization",
                                        "hash-authentihash",
                                        "telephone",
                                        "process",
                                        "cwe",
                                        "port",
                                        "forum-room",
                                        "geo-lat",
                                        "email",
                                        "mutex",
                                        "actor-id"
                                      ]
                                    },
                                    "sources": {
                                      "type": "string",
                                      "description": "Sources associated with this observable (currently only one source is allowed)",
                                      "title": "sources",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "value": {
                                      "type": "string",
                                      "description": "Observable value",
                                      "title": "value",
                                      "x-ms-visibility": "important"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "value"
                                  ],
                                  "description": "data"
                                }
                              },
                              "required": [
                                "data"
                              ]
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      }
                    },
                    "/api/v1/observables/{ID}": {
                      "get": {
                        "summary": "Get Observable (by ID)",
                        "description": "Get Observable (by ID)",
                        "operationId": "[variables('_operationId-GetObservablebyId')]",
                        "parameters": [
                          {
                            "name": "ID",
                            "in": "path",
                            "required": true,
                            "type": "integer",
                            "x-ms-visibility": "important",
                            "format": "int64"
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        }
                      },
                      "delete": {
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "summary": "Delete Observables (by ID)",
                        "description": "Delete Observables (by ID)",
                        "operationId": "[variables('_operationId-DeleteObservablesbyID')]",
                        "parameters": [
                          {
                            "name": "ID",
                            "in": "path",
                            "required": true,
                            "type": "integer",
                            "x-ms-visibility": "important",
                            "format": "int64"
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          }
                        ]
                      },
                      "patch": {
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "summary": "UpdateObservables (by ID)",
                        "description": "Observable will be identified using ID and it updates the observable",
                        "operationId": "[variables('_operationId-UpdateObservablesbyID')]",
                        "parameters": [
                          {
                            "name": "ID",
                            "in": "path",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "content-type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": false,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "meta": {
                                      "type": "object",
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string",
                                          "description": "maliciousness",
                                          "title": "maliciousness",
                                          "x-ms-visibility": "advanced",
                                          "enum": [
                                            "unknown",
                                            "safe",
                                            "low",
                                            "medium",
                                            "high"
                                          ]
                                        }
                                      },
                                      "description": "meta"
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "Observable type",
                                      "title": "type",
                                      "x-ms-visibility": "advanced",
                                      "enum": [
                                        "ja3s-hash",
                                        "country",
                                        "cve",
                                        "hash-rich-pe-header",
                                        "forum-thread",
                                        "bank-account",
                                        "geo",
                                        "malware",
                                        "uri",
                                        "card",
                                        "asn",
                                        "city",
                                        "street",
                                        "person",
                                        "handle",
                                        "hash-sha256",
                                        "ja3-hash",
                                        "hash-ssdeep",
                                        "ipv4-cidr",
                                        "rule",
                                        "hash-vhash",
                                        "uri-hash-sha256",
                                        "geo-long",
                                        "hash-sha512",
                                        "hash-md5",
                                        "postcode",
                                        "cce",
                                        "inetnum",
                                        "name",
                                        "netname",
                                        "host",
                                        "hash-imphash",
                                        "mac-48",
                                        "card-owner",
                                        "ja3s-full",
                                        "domain",
                                        "company",
                                        "product",
                                        "nationality",
                                        "fox-it-portal-uri",
                                        "ipv4",
                                        "email-subject",
                                        "registrar",
                                        "address",
                                        "ipv6",
                                        "yara",
                                        "forum-name",
                                        "country-code",
                                        "industry",
                                        "ja3-full",
                                        "snort",
                                        "hash-sha1",
                                        "ipv6-cidr",
                                        "file",
                                        "eui-64",
                                        "winregistry",
                                        "organization",
                                        "hash-authentihash",
                                        "telephone",
                                        "process",
                                        "cwe",
                                        "port",
                                        "forum-room",
                                        "geo-lat",
                                        "email",
                                        "mutex",
                                        "actor-id"
                                      ]
                                    },
                                    "value": {
                                      "type": "string",
                                      "description": "Observable value",
                                      "title": "value",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "sources": {
                                      "type": "string",
                                      "description": "Sources associated with this observable (currently only one source is allowed)",
                                      "title": "sources",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "entities": {
                                      "type": "string",
                                      "description": "Entities associated with this observable",
                                      "title": "entities"
                                    }
                                  },
                                  "description": "data"
                                }
                              },
                              "x-ms-visibility": "advanced"
                            },
                            "x-ms-visibility": "advanced"
                          }
                        ]
                      }
                    },
                    "/api/v1/sources": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "summary": "Get Sources List",
                        "description": "read sources",
                        "operationId": "[[variables('_operationId-GetSourcesList')]",
                        "parameters": [
                          {
                            "name": "offset",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "description": "Return results starting from the specified (zero-based) index",
                            "x-ms-visibility": "advanced",
                            "format": "int32"
                          },
                          {
                            "name": "limit",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "description": "Maximum number of items to be returned",
                            "x-ms-visibility": "advanced",
                            "format": "int32"
                          },
                          {
                            "name": "sort",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Comma-separated list of fields to sort on. Prefix a field with the minus \"-\" sign if you intend to apply descending sorting to it",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          }
                        ]
                      }
                    },
                    "/api/v1/sources/{ID}": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "summary": "Get Sources (by ID)",
                        "operationId": "[variables('_operationId-GetSourcesbyID')]",
                        "description": "read sources by id",
                        "parameters": [
                          {
                            "name": "ID",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important"
                          },
                          {
                            "name": "accept",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "x-ms-visibility": "internal"
                          }
                        ]
                      }
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "Authorization"
                    }
                  },
                  "security": [
                    {}
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "EclecticIQ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "EclecticIQ-EnrichIncident playbook",
        "displayName": "EclecticIQ-EnrichIncident playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "EclecticIQ-EnrichIncident Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "EclecticIQ-EnrichIncident",
              "type": "string",
              "metadata": {
                "description": "Enter Name of the playbook. If you are fine with the default name EclecticIQ-EnrichIncident then leave the default value as it is"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "EclecticIQCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Enter your EclecticIQ Search custom connector name. Make sure you have installed custom connector already. Default name is EclecticIQCustomConnector. If you are fine with the default value, then leave the value as it is"
              }
            }
          },
          "variables": {
            "EclecticIQCustomConnectorConnectionName": "[[concat('EclecticIQCustomConnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "For_each_Account_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_FileHash_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_Host_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_IP_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_URL_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>@{variables('Incident_Comment')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Entities_-_Get_Accounts": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/account"
                      }
                    },
                    "Entities_-_Get_FileHashes": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/filehash"
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "Entities_-_Get_URLs": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each_Account_in_Entity": {
                      "foreach": "@body('Entities_-_Get_Accounts')?['Accounts']",
                      "actions": {
                        "Condition_check_if_empty_indicator_info_-_Account": {
                          "actions": {
                            "Append_message_to_Comment_-_Accounts": {
                              "runAfter": {
                                "Compose_comment_message-_No_results_-_Accounts": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "Incident_Comment",
                                "value": "@outputs('Compose_comment_message-_No_results_-_Accounts')"
                              }
                            },
                            "Compose_comment_message-_No_results_-_Accounts": {
                              "type": "Compose",
                              "inputs": "\n<b>Account: </b> @{items('For_each_Account_in_Entity')?['Name']}\nNo match found from EclecticIQ\n----------------------------------------------------------------------"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_response_-_Account": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "For_each_indictor_info_on_Account": {
                                "foreach": "@body('Parse_JSON_response_-_Account')?['data']",
                                "actions": {
                                  "Append_indicator_info_to_comment_string_-_accounts": {
                                    "runAfter": {
                                      "Compose_Comment_message_-_Results_-_Accounts": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "Incident_Comment",
                                      "value": "@outputs('Compose_Comment_message_-_Results_-_Accounts')"
                                    }
                                  },
                                  "Compose_Comment_message_-_Results_-_Accounts": {
                                    "type": "Compose",
                                    "inputs": "\nFound below information from EclecticIQ for @{items('For_each_Account_in_Entity')?['Name']} (Account)\n----------------------------------------------------------------------\nObservable Type: @{items('For_each_indictor_info_on_Account')?['type']}\nObservable Value: @{items('For_each_indictor_info_on_Account')?['value']}\nMaliciousness: @{items('For_each_indictor_info_on_Account')?['meta']?['maliciousness']}\nCreared at: @{items('For_each_indictor_info_on_Account')?['created_at']}\nLast updated at: @{items('For_each_indictor_info_on_Account')?['last_updated_at']}\n----------------------------------------------------------------------\n"
                                  }
                                },
                                "type": "Foreach"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@string(body('Parse_JSON_response_-_Account')?['data'])",
                                  "@variables('empty_result_accounts')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Observables": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "Content-Type": "application/json",
                              "accept": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/api/v1/observables",
                            "queries": {
                              "filter[type]": "name",
                              "filter[value]": "hddsjd@hfjdjf.com"
                            }
                          }
                        },
                        "Parse_JSON_response_-_Account": {
                          "runAfter": {
                            "Get_Observables": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_Observables')",
                            "schema": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "data": {
                                  "items": {
                                    "properties": {
                                      "created_at": {
                                        "type": "string"
                                      },
                                      "entities": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "last_updated_at": {
                                        "type": "string"
                                      },
                                      "meta": {
                                        "properties": {
                                          "maliciousness": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "sources": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "created_at",
                                      "entities",
                                      "id",
                                      "last_updated_at",
                                      "meta",
                                      "sources",
                                      "type",
                                      "value"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "limit": {
                                  "type": "integer"
                                },
                                "offset": {
                                  "type": "integer"
                                },
                                "total_count": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_FileHash_in_Entity": {
                      "foreach": "@body('Entities_-_Get_FileHashes')?['Filehashes']",
                      "actions": {
                        "Condition_check_if_empty_indicator_info_-_FileHash": {
                          "actions": {
                            "Append_message_to_Comment_-_FileHash": {
                              "runAfter": {
                                "Compose_comment_message-_No_results_-_FileHash": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "Incident_Comment",
                                "value": "@outputs('Compose_comment_message-_No_results_-_FileHash')"
                              }
                            },
                            "Compose_comment_message-_No_results_-_FileHash": {
                              "type": "Compose",
                              "inputs": "\n<b>File Hash: </b>  @{items('For_each_FileHash_in_Entity')?['Value']}\nNo match found from EclecticIQ\n----------------------------------------------------------------------"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_response_-_FileHash": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "For_each_indictor_info_on_FileHash": {
                                "foreach": "@body('Parse_JSON_response_-_FileHash')?['data']",
                                "actions": {
                                  "Append_indicator_info_to_comment_string_-_FileHash": {
                                    "runAfter": {
                                      "Compose_Comment_message_-_Results_-_FileHash": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "Incident_Comment",
                                      "value": "@outputs('Compose_Comment_message_-_Results_-_FileHash')"
                                    }
                                  },
                                  "Compose_Comment_message_-_Results_-_FileHash": {
                                    "type": "Compose",
                                    "inputs": "\nFound below information from EclecticIQ for  @{items('For_each_FileHash_in_Entity')?['Value']} (FileHash) \n----------------------------------------------------------------------\nObservable Type: @{items('For_each_indictor_info_on_FileHash')?['type']}\nObservable Value: @{items('For_each_indictor_info_on_FileHash')?['value']}\nMaliciousness: @{items('For_each_indictor_info_on_FileHash')?['meta']?['maliciousness']}\nCreared at: @{items('For_each_indictor_info_on_FileHash')?['created_at']}\nLast updated at: @{items('For_each_indictor_info_on_FileHash')?['last_updated_at']}\n----------------------------------------------------------------------"
                                  }
                                },
                                "type": "Foreach"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@string(body('Parse_JSON_response_-_FileHash')?['data'])",
                                  "@variables('empty_result_hash')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Observables_FileHash": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "Content-Type": "application/json",
                              "accept": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/api/v1/observables",
                            "queries": {
                              "filter[type]": "hash-sha256",
                              "filter[value]": "@items('For_each_FileHash_in_Entity')?['Value']"
                            }
                          }
                        },
                        "Parse_JSON_response_-_FileHash": {
                          "runAfter": {
                            "Get_Observables_FileHash": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_Observables_FileHash')",
                            "schema": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "data": {
                                  "items": {
                                    "properties": {
                                      "created_at": {
                                        "type": "string"
                                      },
                                      "entities": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "last_updated_at": {
                                        "type": "string"
                                      },
                                      "meta": {
                                        "properties": {
                                          "maliciousness": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "sources": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "created_at",
                                      "entities",
                                      "id",
                                      "last_updated_at",
                                      "meta",
                                      "sources",
                                      "type",
                                      "value"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "limit": {
                                  "type": "integer"
                                },
                                "offset": {
                                  "type": "integer"
                                },
                                "total_count": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_FileHash": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_Host_in_Entity": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Condition_check_if_empty_indicator_info_-_Host": {
                          "actions": {
                            "Append_message_to_Comment_-_Host": {
                              "runAfter": {
                                "Compose_comment_message-_No_results_-_Host": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "Incident_Comment",
                                "value": "@outputs('Compose_comment_message-_No_results_-_Host')"
                              }
                            },
                            "Compose_comment_message-_No_results_-_Host": {
                              "type": "Compose",
                              "inputs": "\n<b>Host Name: </b>   @{items('For_each_Host_in_Entity')?['HostName']}\nNo match found from EclecticIQ\n----------------------------------------------------------------------"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_response_-_Host": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "For_each_indictor_info_on_Host": {
                                "foreach": "@body('Parse_JSON_response_-_Host')?['data']",
                                "actions": {
                                  "Append_indicator_info_to_comment_string_-_Host": {
                                    "runAfter": {
                                      "Compose_Comment_message_-_Results_-_Host": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "Incident_Comment",
                                      "value": "@outputs('Compose_Comment_message_-_Results_-_Host')"
                                    }
                                  },
                                  "Compose_Comment_message_-_Results_-_Host": {
                                    "type": "Compose",
                                    "inputs": "\nFound below information from EclecticIQ for  @{items('For_each_Host_in_Entity')?['HostName']} (Host) \n----------------------------------------------------------------------\nObservable Type: @{items('For_each_indictor_info_on_Host')?['type']}\nObservable Value: @{items('For_each_indictor_info_on_Host')?['value']}\nMaliciousness: @{items('For_each_indictor_info_on_Host')?['meta']?['maliciousness']}\nCreared at: @{items('For_each_indictor_info_on_Host')?['created_at']}\nLast updated at: @{items('For_each_indictor_info_on_Host')?['last_updated_at']}\n----------------------------------------------------------------------"
                                  }
                                },
                                "type": "Foreach"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@string(body('Parse_JSON_response_-_Host')?['data'])",
                                  "@variables('empty_result')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Observables_-_Hosts": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "Content-Type": "application/json",
                              "accept": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/api/v1/observables",
                            "queries": {
                              "filter[type]": "host",
                              "filter[value]": "@items('For_each_Host_in_Entity')?['HostName']"
                            }
                          }
                        },
                        "Parse_JSON_response_-_Host": {
                          "runAfter": {
                            "Get_Observables_-_Hosts": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_Observables_-_Hosts')",
                            "schema": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "data": {
                                  "items": {
                                    "properties": {
                                      "created_at": {
                                        "type": "string"
                                      },
                                      "entities": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "last_updated_at": {
                                        "type": "string"
                                      },
                                      "meta": {
                                        "properties": {
                                          "maliciousness": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "sources": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "created_at",
                                      "entities",
                                      "id",
                                      "last_updated_at",
                                      "meta",
                                      "sources",
                                      "type",
                                      "value"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "limit": {
                                  "type": "integer"
                                },
                                "offset": {
                                  "type": "integer"
                                },
                                "total_count": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_IP_in_Entity": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Condition_check_if_empty_indicator_info_-_IP": {
                          "actions": {
                            "Append_message_to_Comment_-_IP": {
                              "runAfter": {
                                "Compose_comment_message-_No_results_-_IP": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "Incident_Comment",
                                "value": "@{outputs('Compose_comment_message-_No_results_-_IP')}\n"
                              }
                            },
                            "Compose_comment_message-_No_results_-_IP": {
                              "type": "Compose",
                              "inputs": "\n<b>IP Address: </b>   @{items('For_each_IP_in_Entity')?['Address']}\nNo match found from EclecticIQ\n----------------------------------------------------------------------"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_response_-_IP": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "For_each_indictor_info_on_IP": {
                                "foreach": "@body('Parse_JSON_response_-_IP')?['data']",
                                "actions": {
                                  "Append_indicator_info_to_comment_string_-_IP": {
                                    "runAfter": {
                                      "Compose_Comment_message_-_Results_-_IP": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "Incident_Comment",
                                      "value": "@outputs('Compose_Comment_message_-_Results_-_IP')"
                                    }
                                  },
                                  "Compose_Comment_message_-_Results_-_IP": {
                                    "type": "Compose",
                                    "inputs": "\nFound below information from EclecticIQ for @{items('For_each_IP_in_Entity')?['Address']}   (IP Address)  \n----------------------------------------------------------------------\nObservable Type: @{items('For_each_indictor_info_on_IP')?['type']}\nObservable Value: @{items('For_each_indictor_info_on_IP')?['value']}\nMaliciousness: @{items('For_each_indictor_info_on_IP')?['meta']?['maliciousness']}\nCreared at: @{items('For_each_indictor_info_on_IP')?['created_at']}\nLast updated at: @{items('For_each_indictor_info_on_IP')?['last_updated_at']}\n----------------------------------------------------------------------"
                                  }
                                },
                                "type": "Foreach"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@string(body('Parse_JSON_response_-_IP')?['data'])",
                                  "@variables('empty_result_ips')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Observables_-_IP": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "Content-Type": "application/json",
                              "accept": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/api/v1/observables",
                            "queries": {
                              "filter[type]": "ipv4",
                              "filter[value]": "@items('For_each_IP_in_Entity')?['Address']"
                            }
                          }
                        },
                        "Parse_JSON_response_-_IP": {
                          "runAfter": {
                            "Get_Observables_-_IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_Observables_-_IP')",
                            "schema": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "data": {
                                  "items": {
                                    "properties": {
                                      "created_at": {
                                        "type": "string"
                                      },
                                      "entities": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "last_updated_at": {
                                        "type": "string"
                                      },
                                      "meta": {
                                        "properties": {
                                          "maliciousness": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "sources": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "created_at",
                                      "entities",
                                      "id",
                                      "last_updated_at",
                                      "meta",
                                      "sources",
                                      "type",
                                      "value"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "limit": {
                                  "type": "integer"
                                },
                                "offset": {
                                  "type": "integer"
                                },
                                "total_count": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_URL_in_Entity": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Condition_check_if_empty_indicator_info_-_URLs": {
                          "actions": {
                            "Append_message_to_Comment_-_URL": {
                              "runAfter": {
                                "Compose_comment_message-_No_results_-_URLs": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "Incident_Comment",
                                "value": "@{outputs('Compose_comment_message-_No_results_-_URLs')}\n"
                              }
                            },
                            "Compose_comment_message-_No_results_-_URLs": {
                              "type": "Compose",
                              "inputs": "\n<b>URL: </b>   @{items('For_each_URL_in_Entity')?['Url']}\nNo match found from EclecticIQ\n----------------------------------------------------------------------"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON_response_-_URL": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "For_each_indictor_info_on_URL": {
                                "foreach": "@body('Parse_JSON_response_-_URL')?['data']",
                                "actions": {
                                  "Append_indicator_info_to_comment_string_-_URL": {
                                    "runAfter": {
                                      "Compose_Comment_message_-_Results_-_URLs": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToStringVariable",
                                    "inputs": {
                                      "name": "Incident_Comment",
                                      "value": "@outputs('Compose_Comment_message_-_Results_-_URLs')"
                                    }
                                  },
                                  "Compose_Comment_message_-_Results_-_URLs": {
                                    "type": "Compose",
                                    "inputs": "\nFound below information from EclecticIQ for  @{items('For_each_URL_in_Entity')?['Url']}   (URL)  \n----------------------------------------------------------------------\nObservable Type: @{items('For_each_indictor_info_on_URL')?['type']}\nObservable Value: @{items('For_each_indictor_info_on_URL')?['value']}\nMaliciousness: @{items('For_each_indictor_info_on_URL')?['meta']?['maliciousness']}\nCreared at: @{items('For_each_indictor_info_on_URL')?['created_at']}\nLast updated at: @{items('For_each_indictor_info_on_URL')?['last_updated_at']}\n----------------------------------------------------------------------"
                                  }
                                },
                                "type": "Foreach"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@string(body('Parse_JSON_response_-_URL')?['data'])",
                                  "@variables('empty_result_urls')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Observables_-_URL": {
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "Content-Type": "application/json",
                              "accept": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/api/v1/observables",
                            "queries": {
                              "filter[type]": "uri",
                              "filter[value]": "@items('For_each_URL_in_Entity')?['Url']"
                            }
                          }
                        },
                        "Parse_JSON_response_-_URL": {
                          "runAfter": {
                            "Get_Observables_-_URL": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_Observables_-_URL')",
                            "schema": {
                              "properties": {
                                "count": {
                                  "type": "integer"
                                },
                                "data": {
                                  "items": {
                                    "properties": {
                                      "created_at": {
                                        "type": "string"
                                      },
                                      "entities": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "id": {
                                        "type": "integer"
                                      },
                                      "last_updated_at": {
                                        "type": "string"
                                      },
                                      "meta": {
                                        "properties": {
                                          "maliciousness": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "sources": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "type": {
                                        "type": "string"
                                      },
                                      "value": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "created_at",
                                      "entities",
                                      "id",
                                      "last_updated_at",
                                      "meta",
                                      "sources",
                                      "type",
                                      "value"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "limit": {
                                  "type": "integer"
                                },
                                "offset": {
                                  "type": "integer"
                                },
                                "total_count": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable_-_Incident_Comment": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Incident_Comment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_Accounts": {
                      "runAfter": {
                        "Entities_-_Get_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_accounts",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_FileHash": {
                      "runAfter": {
                        "Entities_-_Get_FileHashes": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_hash",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_Hosts": {
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_IPs": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_ips",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_URLs": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_urls",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "EclecticIQCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('EclecticIQCustomConnectorConnectionName'))]",
                        "connectionName": "[[variables('EclecticIQCustomConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "EclecticIQ-EnrichIncident",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('EclecticIQCustomConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('EclecticIQCustomConnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('EclecticIQCustomConnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "EclecticIQ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_EclecticIQCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Enrich Incident - EclecticIQ",
            "description": "This playbook perform look up into EclecticIQ for the entities (Account, Host, IP, FileHash, URL) present result to Microsoft Sentinel incident",
            "prerequisites": [
              "1. EclecticIQ Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API key. To get API Key, find the instructions here https://developers.eclecticiq.com/docs/authenticate#generate-api-token "
            ],
            "postDeployment": [
              "1. Once deployment is complete, you will need to authorize each connection.",
              "2. Navigate to playbook --> API Connections --> Select connections one by one --> Edit API Connection --> (if required) Enter API key or credentials --> Save"
            ],
            "lastUpdateTime": "2022-11-30T00:00:00Z",
            "entities": [
              "account",
              "ip",
              "filehash",
              "url",
              "host"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "EclecticIQ",
              "ThreatIntelligence"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "EclecticIQ-CreateObservable playbook",
        "displayName": "EclecticIQ-CreateObservable playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "EclecticIQ-CreateObservable Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "EclecticIQ-CreateObservable",
              "type": "string",
              "metadata": {
                "description": "Name of the Playbook (default:EclecticIQ-CreateObservable ), You can change the name of this playbook if you want"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "EclecticIQCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same when you were installing EclecticIQ custom connector"
              }
            }
          },
          "variables": {
            "EclecticIQcustomconnectorConnectionName": "[[concat('EclecticIQCustomConnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "runAfter": {
                        "For_each_Account_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_FileHash_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_Host_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_IP_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ],
                        "For_each_URL_in_Entity": [
                          "Succeeded",
                          "TimedOut",
                          "Skipped",
                          "Failed"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p>@{variables('Incident_Comment')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      }
                    },
                    "Entities_-_Get_Accounts": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/account"
                      },
                      "description": "You can remove below entire branch if you don't want to create account observables"
                    },
                    "Entities_-_Get_FileHashes": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/filehash"
                      },
                      "description": "You can remove below entire branch if you don't want to create observables for File Hash"
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "Entities_-_Get_URLs": {
                      "runAfter": {
                        "Initialize_variable_-_Incident_Comment": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each_Account_in_Entity": {
                      "foreach": "@body('Entities_-_Get_Accounts')?['Accounts']",
                      "actions": {
                        "Append_message_to_Comment_-_Accounts": {
                          "runAfter": {
                            "Compose_comment_message-Accounts": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Incident_Comment",
                            "value": "@outputs('Compose_comment_message-Accounts')"
                          }
                        },
                        "Compose_comment_message-Accounts": {
                          "runAfter": {
                            "Parse_JSON_Response-Account": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "\nCreated/Updated below in EclecticIQ for @{items('For_each_Account_in_Entity')?['Name']} (Account)\n----------------------------------------------------------------------\nObservable Type: @{body('Parse_JSON_Response-Account')?['data']?['type']}\nObservable Value: @{body('Parse_JSON_Response-Account')?['data']?['value']}\nMaliciousness: @{body('Parse_JSON_Response-Account')?['data']?['meta']?['maliciousness']}\nCreared at: @{body('Parse_JSON_Response-Account')?['data']?['created_at']}\nLast updated at: @{body('Parse_JSON_Response-Account')?['data']?['last_updated_at']}\n----------------------------------------------------------------------\n"
                        },
                        "Create_or_Update_Observables_-_Accounts": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "data": {
                                "type": "name",
                                "value": "@items('For_each_Account_in_Entity')?['Name']"
                              }
                            },
                            "headers": {
                              "accept": "application/json",
                              "content-type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/api/v1/observables/"
                          },
                          "description": "Modify type below if you are seeing different type (default = name)"
                        },
                        "Parse_JSON_Response-Account": {
                          "runAfter": {
                            "Create_or_Update_Observables_-_Accounts": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Create_or_Update_Observables_-_Accounts')",
                            "schema": {
                              "properties": {
                                "data": {
                                  "properties": {
                                    "created_at": {
                                      "type": "string"
                                    },
                                    "entities": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "last_updated_at": {
                                      "type": "string"
                                    },
                                    "meta": {
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "sources": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_FileHash_in_Entity": {
                      "foreach": "@body('Entities_-_Get_FileHashes')?['Filehashes']",
                      "actions": {
                        "Append_message_to_Comment_-_FileHash": {
                          "runAfter": {
                            "Compose_comment_message-FileHash": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Incident_Comment",
                            "value": "@outputs('Compose_comment_message-FileHash')"
                          }
                        },
                        "Compose_comment_message-FileHash": {
                          "runAfter": {
                            "Parse_JSON_Response-FileHash": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "\nCreated/Updated below in EclecticIQ for @{items('For_each_FileHash_in_Entity')?['Value']} (File Hash)\n----------------------------------------------------------------------\nObservable Type: @{body('Parse_JSON_Response-FileHash')?['data']?['type']}\nObservable Value: @{body('Parse_JSON_Response-FileHash')?['data']?['value']}\nMaliciousness: @{body('Parse_JSON_Response-FileHash')?['data']?['meta']?['maliciousness']}\nCreared at: @{body('Parse_JSON_Response-FileHash')?['data']?['created_at']}\nLast updated at: @{body('Parse_JSON_Response-FileHash')?['data']?['last_updated_at']}\n----------------------------------------------------------------------\n"
                        },
                        "Create_or_Update_Observables-FileHash": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "data": {
                                "type": "hash-md5",
                                "value": "@items('For_each_FileHash_in_Entity')?['Value']"
                              }
                            },
                            "headers": {
                              "accept": "application/json",
                              "content-type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/api/v1/observables/"
                          }
                        },
                        "Parse_JSON_Response-FileHash": {
                          "runAfter": {
                            "Create_or_Update_Observables-FileHash": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Create_or_Update_Observables-FileHash')",
                            "schema": {
                              "properties": {
                                "data": {
                                  "properties": {
                                    "created_at": {
                                      "type": "string"
                                    },
                                    "entities": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "last_updated_at": {
                                      "type": "string"
                                    },
                                    "meta": {
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "sources": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_FileHash": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_Host_in_Entity": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Append_message_to_Comment_-_Host": {
                          "runAfter": {
                            "Compose_comment_message-Host": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Incident_Comment",
                            "value": "@outputs('Compose_comment_message-Host')"
                          }
                        },
                        "Compose_comment_message-Host": {
                          "runAfter": {
                            "Parse_JSON_Response-Host": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "\nCreated/Updated below in EclecticIQ for @{items('For_each_Host_in_Entity')?['HostName']} (Host)\n----------------------------------------------------------------------\nObservable Type: @{body('Parse_JSON_Response-Host')?['data']?['type']}\nObservable Value: @{body('Parse_JSON_Response-Host')?['data']?['value']}\nMaliciousness: @{body('Parse_JSON_Response-Host')?['data']?['meta']?['maliciousness']}\nCreared at: @{body('Parse_JSON_Response-Host')?['data']?['created_at']}\nLast updated at: @{body('Parse_JSON_Response-Host')?['data']?['last_updated_at']}\n----------------------------------------------------------------------\n"
                        },
                        "Create_or_Update_Observables-Host": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "data": {
                                "type": "host",
                                "value": "@items('For_each_Host_in_Entity')?['HostName']"
                              }
                            },
                            "headers": {
                              "accept": "application/json",
                              "content-type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/api/v1/observables/"
                          }
                        },
                        "Parse_JSON_Response-Host": {
                          "runAfter": {
                            "Create_or_Update_Observables-Host": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Create_or_Update_Observables-Host')",
                            "schema": {
                              "properties": {
                                "data": {
                                  "properties": {
                                    "created_at": {
                                      "type": "string"
                                    },
                                    "entities": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "last_updated_at": {
                                      "type": "string"
                                    },
                                    "meta": {
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "sources": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_IP_in_Entity": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Append_message_to_Comment_-_IP": {
                          "runAfter": {
                            "Compose_comment_message-IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Incident_Comment",
                            "value": "@{outputs('Compose_comment_message-IP')}\n"
                          }
                        },
                        "Compose_comment_message-IP": {
                          "runAfter": {
                            "Parse_JSON_Response-IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "\nCreated/Updated below in EclecticIQ for @{items('For_each_IP_in_Entity')?['Address']} (IP Address)\n----------------------------------------------------------------------\nObservable Type: @{body('Parse_JSON_Response-IP')?['data']?['type']}\nObservable Value: @{body('Parse_JSON_Response-IP')?['data']?['value']}\nMaliciousness: @{body('Parse_JSON_Response-IP')?['data']?['meta']?['maliciousness']}\nCreared at: @{body('Parse_JSON_Response-IP')?['data']?['created_at']}\nLast updated at: @{body('Parse_JSON_Response-IP')?['data']?['last_updated_at']}\n----------------------------------------------------------------------\n"
                        },
                        "Create_or_Update_Observables-IP": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "data": {
                                "type": "ipv4",
                                "value": "@items('For_each_IP_in_Entity')?['Address']"
                              }
                            },
                            "headers": {
                              "accept": "application/json",
                              "content-type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/api/v1/observables/"
                          }
                        },
                        "Parse_JSON_Response-IP": {
                          "runAfter": {
                            "Create_or_Update_Observables-IP": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Create_or_Update_Observables-IP')",
                            "schema": {
                              "properties": {
                                "data": {
                                  "properties": {
                                    "created_at": {
                                      "type": "string"
                                    },
                                    "entities": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "last_updated_at": {
                                      "type": "string"
                                    },
                                    "meta": {
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "sources": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_URL_in_Entity": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Append_message_to_Comment_-_URL": {
                          "runAfter": {
                            "Compose_comment_message-URLs": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "Incident_Comment",
                            "value": "@{outputs('Compose_comment_message-URLs')}\n"
                          }
                        },
                        "Compose_comment_message-URLs": {
                          "runAfter": {
                            "Parse_JSON_Response-URLs": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "\nCreated/Updated below in EclecticIQ for @{items('For_each_URL_in_Entity')?['Url']} (URL)\n----------------------------------------------------------------------\nObservable Type: @{body('Parse_JSON_Response-URLs')?['data']?['type']}\nObservable Value: @{body('Parse_JSON_Response-URLs')?['data']?['value']}\nMaliciousness: @{body('Parse_JSON_Response-URLs')?['data']?['meta']?['maliciousness']}\nCreared at: @{body('Parse_JSON_Response-URLs')?['data']?['created_at']}\nLast updated at: @{body('Parse_JSON_Response-URLs')?['data']?['last_updated_at']}\n----------------------------------------------------------------------\n"
                        },
                        "Create_or_Update_Observables-URI": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "data": {
                                "type": "uri",
                                "value": "@items('For_each_URL_in_Entity')?['Url']"
                              }
                            },
                            "headers": {
                              "accept": "application/json",
                              "content-type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['EclecticIQCustomConnector']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/api/v1/observables/"
                          }
                        },
                        "Parse_JSON_Response-URLs": {
                          "runAfter": {
                            "Create_or_Update_Observables-URI": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Create_or_Update_Observables-URI')",
                            "schema": {
                              "properties": {
                                "data": {
                                  "properties": {
                                    "created_at": {
                                      "type": "string"
                                    },
                                    "entities": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "id": {
                                      "type": "integer"
                                    },
                                    "last_updated_at": {
                                      "type": "string"
                                    },
                                    "meta": {
                                      "properties": {
                                        "maliciousness": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "sources": {
                                      "items": {
                                        "type": "string"
                                      },
                                      "type": "array"
                                    },
                                    "type": {
                                      "type": "string"
                                    },
                                    "value": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_to_indicate_empty_result_sting_-_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable_-_Incident_Comment": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Incident_Comment",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_Accounts": {
                      "runAfter": {
                        "Entities_-_Get_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_accounts",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_FileHash": {
                      "runAfter": {
                        "Entities_-_Get_FileHashes": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_hash",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_Hosts": {
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_IPs": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_ips",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_to_indicate_empty_result_sting_-_URLs": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "empty_result_urls",
                            "type": "string",
                            "value": "[[[]"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "EclecticIQCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('EclecticIQcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('EclecticIQcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "EclecticIQ-CreateObservable",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('EclecticIQcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('EclecticIQcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('EclecticIQcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "EclecticIQ",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_EclecticIQCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Create Observable - EclecticIQ",
            "description": "This playbook adds new observable in EclecticIQ based on the entities info present in Sentinel incident. If same type and value exists already, then it will update the observable and comment will be added to Sentinel's incident",
            "prerequisites": [
              "1. EclecticIQ Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API key. To get API Key, find the instructions here https://developers.eclecticiq.com/docs/authenticate#generate-api-token "
            ],
            "postDeployment": [
              "1. Once deployment is complete, you will need to authorize each connection.",
              "2. Navigate to playbook --> API Connections --> Select connections one by one --> Edit API Connection --> (if required) Enter API key or credentials --> Save"
            ],
            "lastUpdateTime": "2022-11-30T00:00:00Z",
            "entities": [
              "account",
              "ip",
              "filehash",
              "url",
              "host"
            ],
            "tags": [
              "Remediation",
              "Notification",
              "EclecticIQ",
              "ThreatIntelligence"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "EclecticIQ",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_EclecticIQCustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_EclecticIQ-EnrichIncident')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_EclecticIQ-CreateObservable')]",
              "version": "[variables('playbookVersion3')]"
            }
          ]
        },
        "firstPublishDate": "2022-09-30",
        "providers": [
          "EclecticIQ"
        ],
        "categories": {
          "domains": [
            "Security - Threat Intelligence",
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
